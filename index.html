
<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç¥æ€</title>

<!-- æ·»åŠ åˆ°ä¸»ç•«é¢è¨­å®š -->
<meta name="application-name" content="ç¥æ€">
<meta name="apple-mobile-web-app-title" content="ç¥æ€">
<link rel="manifest" href="manifest.json">

<link rel="apple-touch-icon" href="https://i.ibb.co/tpYQMG6z/SANSI.png">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">


<!-- Android åœ–ç¤º -->
<link rel="icon" sizes="192x192" href="https://i.ibb.co/tpYQMG6z/SANSI.png">

<link rel="icon" sizes="144x144" href="https://i.ibb.co/tpYQMG6z/SANSI.png">

<link rel="icon" sizes="96x96" href="https://i.ibb.co/tpYQMG6z/SANSI.png">

<!-- iOS åœ–ç¤º -->
<link rel="apple-touch-icon" sizes="180x180" href="https://i.ibb.co/tpYQMG6z/SANSI.png">

<link rel="apple-touch-icon" sizes="152x152" href="https://i.ibb.co/tpYQMG6z/SANSI.png">

<link rel="apple-touch-icon" sizes="120x120" href="https://i.ibb.co/tpYQMG6z/SANSI.png">


<style>
body {
font-family: 'Noto Serif TC', 'cwTeXHei', 'cwTeXFangSong', 'cwTeXKai', 'cwTeXMing', 'PingFang TC', 'Microsoft JhengHei', serif;
max-width: 800px;
margin: 0 auto;
padding: 20px;
background: url('https://i.ibb.co/nNMDqGJt/4.png') center/cover fixed;
padding-bottom: 60px; /* ç‚ºé é¢å…§å®¹è¨­ç½®åº•éƒ¨å…§é‚Šè·ï¼Œé¿å…è¢«éŸ³æ¨‚æ’­æ”¾å™¨é®æ“‹ */
}
h1 {
text-align: center;
color: #333;
}

.category {
margin-bottom: 20px;
}

.category h3 {
font-size: 18px;
margin-bottom: 10px;
color: #fff; /* ç™½è‰²æ–‡å­—ï¼Œé©é…æ·±è‰²èƒŒæ™¯ */
text-align: left;
}

/* æ‰‹æ©Ÿè¨­å‚™èª¿æ•´ */
@media (max-width: 600px) {
.category {
padding-left: 25px; /* å¢åŠ å·¦å…§é‚Šè·ï¼Œè®“æŒ‰éµé é›¢å·¦é‚Šç·£ */
}
#toolsList button {
width: auto; /* å¯¬åº¦è‡ªé©æ‡‰æ–‡å­—å…§å®¹ */
display: inline-block; /* æŒ‰éˆ•ä»¥è¡Œå…§å¡Šå…ƒç´ é¡¯ç¤ºï¼Œé…åˆç½®ä¸­ */
margin: 10px 0; /* èª¿æ•´ç‚ºä¸Šä¸‹ 10pxï¼Œå·¦å³ 0pxï¼Œé¿å…é¡å¤–æ°´å¹³é–“è· */
font-size: 14px; /* ä¿ç•™å­—é«”å¤§å° */
padding: 8px 16px; /* ä¿ç•™å…§é‚Šè·ï¼Œæä¾›é©ç•¶ç©ºé–“ */
}
.category h3 {
font-size: 16px; /* ä¿ç•™æ¨™é¡Œå­—é«”å¤§å° */
}
}


.copyright-footer {
position: fixed;
bottom: 0;
right: 0;
padding: 5px 10px;
background-color: #f1f1f1;
}

.copyright-footer p {
margin: 0;
font-size: 14px;
}

@media (max-width: 600px) {
.copyright-footer p {
font-size: 12px;
}
}

/* æ™´å¤©æ•ˆæœï¼šå¤ªé™½ */
.sun {
position: absolute;
top: 10%;
left: 5%; /* èª¿æ•´ç‚ºé å·¦ */
width: 100px;
height: 100px;
background-color: yellow;
border-radius: 50%;
box-shadow: 0 0 20px yellow;
animation: sunGlow 2s infinite alternate;
z-index: -1; /* ç¢ºä¿å¤ªé™½åœ¨å…¶ä»–å…ƒç´ ä¸‹æ–¹ï¼Œé¿å…é®æ“‹æŒ‰éµ */
}

/* å¹³æ¿è¨­å‚™èª¿æ•´ */
@media (max-width: 768px) {
.sun {
left: 5%;
top: 5%;
width: 100px;
height: 100px;
}
}

/* æ‰‹æ©Ÿè¨­å‚™èª¿æ•´ */
@media (max-width: 480px) {
.sun {
left: 2%;
top: 2%;
width: 80px;
height: 80px;
}
}

/* å¤ªé™½å…‰èŠ’å‹•ç•«ï¼ˆä¿æŒä¸è®Šï¼‰ */
@keyframes sunGlow {
0% { box-shadow: 0 0 20px yellow; }
100% { box-shadow: 0 0 40px yellow; }
}


/* å¤šé›²æ•ˆæœï¼šé›²æœµ */
.cloud {
position: absolute;
background-color: white;
border-radius: 50%;
opacity: 0.8;
animation: cloudMove linear infinite;
}

@keyframes cloudMove {
0% { transform: translateX(-100vw); }
100% { transform: translateX(100vw); }
}

/* ä¸‹é›¨æ•ˆæœï¼šé›¨æ»´ */
.raindrop {
position: absolute;
width: 2px;
height: 10px;
background-color: #ADD8E6; /* æ·ºè—è‰²ï¼Œæ›´è‡ªç„¶ */
opacity: 0.7; /* å¢åŠ é€æ˜åº¦ */
animation: rainFall linear infinite;
}
@keyframes rainFall {
0% { transform: translateY(-10px); }
100% { transform: translateY(100vh); }
}

/* ä¸‹é›ªæ•ˆæœï¼šé›ªèŠ±ï¼ˆä¿ç•™ä¸¦èª¿æ•´ï¼‰ */
.snowflake {
position: absolute;
background-color: #e0f7fa;
border-radius: 50%;
opacity: 0.7;
animation: snowfall linear infinite;
}

@keyframes snowfall {
0% { top: -10px; transform: translateX(0); }
50% { transform: translateX(20px); }
100% { top: 100vh; transform: translateX(0); }
}




/* ç¢ºä¿æ¨™é¡Œä¸è¢«èƒŒæ™¯å½±éŸ¿ */
.title-container {
background: none;
padding: 0;
}

.title-container {
position: relative;
margin-bottom: 3rem;
text-align: center;
}
.title-text {
display: block;
font-size: 3rem;
color: #d1f2eb;
text-shadow: 3px 3px 0 #7f8c8d;
letter-spacing: 4px;
animation: titleFloat 3s ease-in-out infinite;
}


.box {
background: rgba(220, 220, 220, 0.96);
border-radius: 8px;
box-shadow: 0 2px 4px rgba(0,0,0,0.1);
padding: 20px;
margin: 15px 0;
}
button {
background: #007bff;
color: white;
padding: 10px 20px;
border: none;
border-radius: 4px;
cursor: pointer;
transition: background 0.3s;
margin: 5px;
}
button:hover {
background: #0056b3;
}
.save-btn {
background: #28a745;
}
.save-btn:hover {
background: #218838;
}
.clear-btn {
background: #dc3545;
}
.clear-btn:hover {
background: #c82333;
}
select, textarea, input[type="text"] {
width: 100%;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-radius: 4px;
box-sizing: border-box;
}
textarea {
resize: vertical;
}
table {
width: 100%;
border-collapse: collapse;
margin: 10px 0;
}
th, td {
border: 1px solid #ccc;
padding: 10px;
text-align: left;
vertical-align: top;
word-break: break-word;
}
th {
background: #f0f0f0;
}
.table-container {
overflow-x: auto;
width: 100%;
}
.table-container table {
width: 100%;
border-collapse: collapse;
}
.table-container th, .table-container td {
border: 1px solid #ccc;
padding: 10px;
text-align: left;
vertical-align: top;
word-break: break-word;
}
.table-container th:first-child, .table-container td:first-child {
width: 60px; /* æ‚¨å¯ä»¥èª¿æ•´é€™å€‹åƒç´ å€¼ä¾†æ”¹è®Šå¯¬åº¦ */
}
.table-container th:nth-child(2), .table-container td:nth-child(2),
.table-container th:nth-child(3), .table-container td:nth-child(3) {
min-width: 100px;
}
.table-container th:nth-child(4), .table-container td:nth-child(4),
.table-container th:nth-child(5), .table-container td:nth-child(5) {
min-width: 150px;
}

@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}

.tool-btn {
animation: fadeIn 0.2s ease-in-out forwards;
opacity: 0;
}



#expandToolsBtn {
background-color: #7fb3d5;
}

#expandToolsBtn:hover {
background-color: #aed6f1;
}


#toolsContainer {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100vh;
background-color: rgba(0, 0, 0, 0.8);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
overflow: hidden; /* éš±è—é é¢æ»¾å‹•æ¢ */
}

#toolsList {
display: flex;
flex-direction: column;
align-items: flex-start;
max-height: 80vh; /* è¨­ç½®æœ€å¤§é«˜åº¦ï¼Œä¾‹å¦‚ 80% çš„è¦–çª—é«˜åº¦ */
overflow-y: auto; /* å•Ÿç”¨å‚ç›´æ»¾å‹•æ¢ */
position: relative; /* ä¿æŒç›¸å°å®šä½æ–¼å®¹å™¨å…§ */
}

#toolsList button {
opacity: 0;
margin: 10px 0;
padding: 10px 20px;
font-size: 16px;
background-color: #007bff;
color: white;
border: none;
border-radius: 4px;
cursor: pointer;
}

#closeToolsBtn {
position: absolute;
top: 20px;
right: 20px;
background-color: #dc3545;
color: white;
border: none;
padding: 10px 20px;
border-radius: 4px;
cursor: pointer;
}


#commentResult {
width: 100%;
overflow-wrap: break-word;
}

#toggleOverviewBtn {
background-color: #A9A9A9; /* ç°è‰²èƒŒæ™¯ */
color: white; /* ç™½è‰²æ–‡å­— */
}

#toggleOverviewBtn:hover {
background-color: #808080; /* æ‡¸åœæ™‚æ·±ç°è‰² */
}

#writingBtn{
background-color: #007bff;
}
#argumentBtn {
background-color: #800080; /* å°‡ã€Œè­°è«–ã€æŒ‰éµè¨­ç‚ºç´«è‰² */
}
#readingBtn {
background-color: #28a745;
}
#booksBtn {
background-color: #ffc107;
}
#expandBtn {
background-color: #dc3545;
}
#writingBtn:hover {
background-color: #0056b3;
}

#manuscriptPaperBtn {
background-color: #17a2b8;
}
#manuscriptPaperBtn:hover {
background-color: #138496;
}

#argumentBtn:hover {
background-color: #4B0082; /* æ‡¸åœæ™‚è®Šç‚ºæ·±ç´«è‰² */
}
#readingBtn:hover {
background-color: #218838;
}
#booksBtn:hover {
background-color: #e0a800;
}
#expandBtn:hover {
background-color: #c82333;
}


#writingContainer, #readingContainer, #booksContainer, #expandContainer, #argumentContainer {
display: none;
}
#argumentTopicSelectionArea, #argumentCustomTopicArea, #argumentWritingArea, #argumentGuideArea {
margin-top: 10px;
}



#music-player {
position: fixed;
bottom: 0px;
left: 0;
width: 100%;
background-color: #444;
color: white;
padding: 10px;
display: none; /* é è¨­éš±è— */
align-items: center;
justify-content: space-between;
z-index: 1002;
box-sizing: border-box;
font-size: 14px;
}
#music-player.hidden {
display: none;
}
#music-player .controls {
display: flex;
align-items: center;
flex-shrink: 0;
}
#music-player .controls button {
background: none;
border: none;
color: white;
font-size: 20px;
cursor: pointer;
margin-right: 10px;
}
#music-player .controls select {
background: #555;
color: white;
border: none;
padding: 5px;
border-radius: 3px;
max-width: 150px;
}
#music-player .progress {
flex: 1;
margin: 0 10px;
display: flex;
align-items: center;
}
#music-player .progress input[type="range"] {
width: 100%;
}
#music-player .mode {
margin-left: 10px;
flex-shrink: 0;
}
#music-player .mode select {
background: #555;
color: white;
border: none;
padding: 5px;
border-radius: 3px;
}
#music-player .hide-btn {
background: none;
border: none;
color: white;
font-size: 20px;
cursor: pointer;
margin-left: 10px;
}
#show-player {
position: fixed;
bottom: 25px; /* ä¸Šç§»è‡³ 30pxï¼Œå¯æ ¹æ“šéœ€è¦èª¿æ•´ */
right: 10px;
background: #444;
color: white;
border: none;
padding: 10px;
border-radius: 50%;
cursor: pointer;
z-index: 1003;
display: block; /* åˆå§‹é¡¯ç¤º */
font-size: 16px;
}
@media (max-width: 600px) {
#music-player {
flex-wrap: wrap;
padding: 5px;
}
#music-player .controls select {
max-width: 100px;
font-size: 12px;
}
#music-player .mode select {
font-size: 12px;
}
#progress-bar-music {
height: 10px;
-webkit-appearance: none;
appearance: none;
background: #ddd;
border-radius: 5px;
}
#progress-bar-music::-webkit-slider-thumb {
-webkit-appearance: none;
appearance: none;
width: 20px;
height: 20px;
background: #007bff;
border-radius: 50%;
cursor: pointer;
}
#progress-bar-music::-moz-range-thumb {
width: 20px;
height: 20px;
background: #007bff;
border-radius: 50%;
cursor: pointer;
}
#music-player .controls select, #music-player .mode select {
max-width: 80px;
padding: 3px;
font-size: 12px;
}
#music-player .controls button, #music-player .hide-btn {
padding: 5px;
font-size: 16px;
}
}

/* --- Styles for Tool 2 (èªè–ˆ) --- */
:root {
--bg-color: #f5f5f3;
--text-color: #333;
--primary-color: #6a7a7d;
--secondary-color: #8f8f8f;
--accent-color: #8c9ea1;
--line-color: #c5c5c5;
--shadow-color: rgba(0, 0, 0, 0.05);
--highlight-bg-writing: rgba(230, 240, 245, 0.6);
--highlight-bg-reading: rgba(245, 240, 230, 0.6);
--font-main: 'Noto Serif TC', 'cwTeXHei', 'cwTeXFangSong', 'cwTeXKai', 'cwTeXMing', 'PingFang TC', 'Microsoft JhengHei', serif;
}

#toolsContainer2 {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: var(--bg-color);
z-index: 1005;
overflow-y: auto;
display: none;
padding: 2rem 1rem;
box-sizing: border-box;
justify-content: center;
}

#closeToolsBtn2 {
position: fixed;
top: 15px;
right: 25px;
background-color: transparent;
border: none;
font-size: 2.5rem;
font-weight: bold;
color: #333;
cursor: pointer;
z-index: 1006;
line-height: 1;
padding: 5px 10px;
}

#closeToolsBtn2:hover {
color: #d32f2f;
}

.main-container {
max-width: 1200px;
width: 100%;
position: relative;
opacity: 0;
transition: opacity 0.5s ease-in;
}

.main-container.loaded {
opacity: 1;
}

.floating-header {
position: fixed;
top: 15px;
left: 20px;
background-color: rgba(255, 255, 255, 0.7);
backdrop-filter: blur(8px);
padding: 5px 15px;
border-radius: 30px;
border: 1px solid #e0e0e0;
z-index: 1000;
box-shadow: 0 2px 10px var(--shadow-color);
display: flex;
align-items: center;
gap: 10px;
}

#video-tour-btn {
background: none;
border: none;
cursor: pointer;
padding: 0;
display: flex;
align-items: center;
}

#video-tour-btn .icon {
width: 24px;
height: 24px;
fill: var(--primary-color);
transition: fill 0.3s;
}

#video-tour-btn:hover .icon {
fill: var(--accent-color);
}

.floating-header h1 {
font-size: 1.2rem;
margin: 0;
font-weight: 700;
color: var(--primary-color);
}

.mind-map-container {
display: grid;
grid-template-columns: 1fr 1fr;
grid-template-rows: auto auto 1fr auto;
grid-template-areas:
"core-ai core-ai"
"foundations foundations"
"writing reading"
"assignments support";
gap: 50px 20px;
width: 100%;
margin-top: 80px;
padding-bottom: 50px;
position: relative;
}

.node {
display: flex;
align-items: center;
text-align: center;
padding: 8px 12px;
background-color: #fff;
border: 1px solid #e0e0e0;
border-radius: 8px;
box-shadow: 0 3px 12px var(--shadow-color);
transition: transform 0.3s ease, box-shadow 0.3s ease;
position: relative;
}

.node:hover {
transform: translateY(-4px) scale(1.02);
box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
border-color: var(--accent-color);
}

.node a {
text-decoration: none;
color: inherit;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
font-size: 0.95rem;
gap: 8px;
width: 100%;
}

.node .icon {
width: 24px;
height: 24px;
margin-right: 0;
fill: var(--primary-color);
}

#toolsContainer2 .category {
display: flex;
flex-direction: column;
align-items: center;
gap: 20px;
margin-bottom: 0; /* Reset margin for this context */
}

#writing, #reading {
padding: 20px;
border-radius: 12px;
}
#writing {
background-color: var(--highlight-bg-writing);
}
#reading {
background-color: var(--highlight-bg-reading);
}

.category-title {
font-size: 1.2rem;
font-weight: 700;
color: var(--primary-color);
padding-bottom: 5px;
border-bottom: 2px solid var(--accent-color);
display: flex;
align-items: center;
margin-bottom: 10px;
}

.category-title .icon {
width: 24px;
height: 24px;
margin-right: 8px;
fill: var(--primary-color);
}

.sub-group {
display: flex;
flex-direction: column;
align-items: center;
gap: 12px;
width: 100%;
}

.sub-group-title {
font-weight: bold;
color: var(--secondary-color);
font-size: 0.9rem;
position: relative;
padding-bottom: 5px;
margin-bottom: 5px;
}
.sub-group-title::after{
content: '';
position: absolute;
bottom: 0;
left: 50%;
transform: translateX(-50%);
width: 30px;
height: 1px;
background-color: var(--line-color);
}

.node.level-2 { font-size: 0.9rem; }
.node.level-3 { font-size: 0.85rem; padding: 6px 10px; }
.node.level-3 a { font-weight: 400; flex-direction: row; }

/* Grid Area Assignments */
#core-ai { grid-area: core-ai; }
#foundations {
grid-area: foundations;
display: flex;
flex-direction: row;
justify-content: center;
gap: 350px;
align-items: flex-start;
}
#writing { grid-area: writing; }
#reading { grid-area: reading; }
#assignments { grid-area: assignments; }
#support { grid-area: support; }

.connector-svg {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: -1;
pointer-events: none;
}

.connector-svg line {
stroke: var(--line-color);
stroke-width: 1.5;
stroke-dasharray: 4;
animation: dash 1s linear infinite;
}

@keyframes dash {
to {
stroke-dashoffset: -20;
}
}

#yuyilu-toggle { cursor: pointer; }
.yuyilu-grades {
display: flex;
flex-direction: column;
gap: 8px;
width: 100%;
max-height: 500px;
overflow: hidden;
transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out;
opacity: 1;
}
.yuyilu-grades.collapsed {
max-height: 0;
opacity: 0;
pointer-events: none;
}

.foundation-item {
display: flex;
flex-direction: column;
align-items: center;
gap: 15px;
}

@media (max-width: 768px) {
#toolsContainer2 { padding: 1rem 0.5rem; }
.floating-header { top: 10px; left: 10px; }

.mind-map-container {
margin-top: 70px;
grid-template-columns: 1fr;
grid-template-rows: auto;
grid-template-areas:
"core-ai"
"foundations"
"writing"
"reading"
"assignments"
"support";
gap: 40px;
}

#foundations {
flex-direction: row;
justify-content: space-between;
align-items: flex-start;
width: 90%;
margin: 0 auto;
gap: 10px;
}

#writing, #reading {
padding: 15px;
}
}

/* --- Preview Modal Styles --- */
.preview-modal-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.7);
display: none; /* é è¨­éš±è— */
justify-content: center;
align-items: center;
z-index: 2000;
padding: 1rem;
box-sizing: border-box;
}

.preview-modal-content {
background-color: #fff;
border-radius: 12px;
box-shadow: 0 5px 25px rgba(0,0,0,0.2);
width: 90%;
height: 90%;
max-width: 1000px;
display: flex;
flex-direction: column;
overflow: hidden;
position: relative;
}

.preview-close-btn {
position: absolute;
top: 8px;
right: 8px;
background: rgba(255, 255, 255, 0.7);
border: none;
border-radius: 50%;
width: 36px;
height: 36px;
font-size: 1.5rem;
font-weight: bold;
color: #333;
cursor: pointer;
line-height: 1;
display: flex;
align-items: center;
justify-content: center;
transition: background-color 0.3s, color 0.3s;
z-index: 2010;
}
.preview-close-btn:hover {
color: #fff;
background-color: #d32f2f;
}

.preview-modal-body {
flex-grow: 1;
display: flex;
flex-direction: column;
height: 100%;
}

#previewIframe {
width: 100%;
flex-grow: 1; /* ä½”æ“šå¤§éƒ¨åˆ†ç©ºé–“ */
border: none;
border-top-left-radius: 12px;
border-top-right-radius: 12px;
min-height: 60%; /* ç¢ºä¿é è¦½ç•«é¢æœ‰è¶³å¤ é«˜åº¦ */
}

.preview-modal-footer {
padding: 16px;
background-color: #f7f9fa;
border-top: 1px solid #e0e0e0;
display: flex;
align-items: flex-start;
gap: 16px;
overflow-y: auto;
max-height: 40%;
flex-shrink: 0;
}

.preview-description {
font-size: 0.95rem;
color: #333;
line-height: 1.6;
text-align: left;
flex-grow: 1;
}

.preview-goto-btn {
background: #007bff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white' width='18px' height='18px'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z'/%3E%3C/svg%3E") no-repeat 15px center;
background-size: 18px 18px;
color: white;
padding: 10px 20px 10px 40px;
border: none;
border-radius: 20px;
text-decoration: none;
font-size: 1rem;
font-weight: bold;
transition: background-color 0.3s;
cursor: pointer;
flex-shrink: 0; /* é˜²æ­¢æŒ‰éˆ•ç¸®å° */
}
.preview-goto-btn:hover {
background-color: #0056b3;
color: white;
}

@media (max-width: 600px) {
.preview-modal-footer {
flex-direction: column;
align-items: stretch;
}
.preview-goto-btn {
align-self: flex-end; /* åœ¨å †ç–Šæ™‚ä»å°‡æŒ‰éˆ•é å³ */
}
}


/* --- Video Modal Styles --- */
.video-modal-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.8);
display: none; /* é è¨­éš±è— */
justify-content: center;
align-items: center;
z-index: 2100;
cursor: pointer;
}

.video-modal-content {
position: relative;
width: 90%;
max-width: 960px;
padding-top: 56.25%; /* 16:9 Aspect Ratio */
height: 0;
cursor: default;
}

.video-modal-content iframe {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
border: none;
}

/* --- ä¿®è¨‚ï¼šå¢åŠ é¸æ“‡åŠŸèƒ½åŠä¸‹æ–¹é …ç›®æ’ç‰ˆçš„é–“è·ï¼Œä½¿å…¶æ›´å¯¬é¬† --- */
.function-selector-wrapper {
    padding: 20px; /* å¢åŠ å…§é‚Šè·ï¼Œè®“å…§éƒ¨å…ƒç´ æœ‰æ›´å¤šå‘¼å¸ç©ºé–“ */
    background-color: rgba(59, 184, 219, 0.2);
    border-left: 5px solid #0288d1;
margin-top: 30px; /* <--- è«‹åŠ ä¸Šé€™ä¸€è¡Œ */
    margin-bottom: 35px; /* æ˜é¡¯å¢åŠ èˆ‡ä¸‹æ–¹å…§å®¹çš„é–“è· */
    border-radius: 8px; /* åœ“è§’ç¨å¤§ï¼Œè¦–è¦ºä¸Šæ›´æŸ”å’Œ */
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.function-selector-wrapper label {
    font-size: 1.1em; /* æ¨™é¡Œå­—é«”ç¨å¤§ï¼Œæ›´çªå‡º */
    font-weight: bold;
    color: #01579b;
    display: block;
    margin-bottom: 15px; /* å¢åŠ èˆ‡ä¸‹æ‹‰é¸å–®çš„é–“è· */
}
.function-selector-wrapper select {
    font-size: 1em; /* çµ±ä¸€ä¸‹æ‹‰é¸å–®å­—é«”å¤§å° */
    padding: 8px; /* é©åº¦å¢åŠ ä¸‹æ‹‰é¸å–®çš„å…§é‚Šè· */
}

/* ç‚ºå„å€‹åŠŸèƒ½å®¹å™¨å…§çš„ä¸»è¦å€å¡Šï¼ˆdivï¼‰å¢åŠ çµ±ä¸€çš„ä¸‹é–“è·ï¼Œå‰µé€ å€å¡Šé–“çš„å±¤æ¬¡æ„Ÿ */
#writingContentContainer > div,
#expandContentContainer > div,
#argumentContentContainer > div {
    margin-bottom: 30px;
}

/* æ¸…é™¤æœ€å¾Œä¸€å€‹å…ƒç´ çš„ä¸‹é‚Šè·ï¼Œé¿å…åœ¨å®¹å™¨æœ«å°¾ç”¢ç”Ÿå¤šé¤˜çš„ç©ºç™½ */
#writingContentContainer > div:last-child,
#expandContentContainer > div:last-child,
#argumentContentContainer > div:last-child {
    margin-bottom: 0;
}

/* é‡å°é–±è®€å€å¡Šï¼Œå…¶å…§éƒ¨çµæ§‹ä¸åŒï¼Œå–®ç¨èª¿æ•´å…¶å­å…ƒç´ çš„é–“è· */
#readingInputArea > *:not(div#readingResult) {
     margin-bottom: 20px; /* çµ±ä¸€é–±è®€å€å¡Šå…§è¼¸å…¥å…ƒç´ çš„ä¸‹é–“è· */
}


/* --- æ–°å¢çš„æ”¹å¯«èªªæ˜ UI æ¨£å¼ --- */
.rewrite-explanation-container {
    margin-top: 20px;
}
.rewrite-explanation-card {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}
.rewrite-explanation-card h3 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #343a40;
    font-size: 1.2em;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 10px;
}
.explanation-point {
    display: flex;
    align-items: flex-start;
    margin-bottom: 15px;
}
.explanation-point:last-child {
    margin-bottom: 0;
}
.explanation-number {
    flex-shrink: 0;
    width: 28px;
    height: 28px;
    background-color: #0288d1;
    color: white;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    margin-right: 15px;
    font-size: 1em;
}
.explanation-text {
    font-size: 1em;
    line-height: 1.6;
    color: #495057;
}

/* --- æ–°å¢ï¼šç‚ºé»è©•èªæ°£æ¨™ç±¤å¢åŠ ä¸Šæ–¹é–“è· --- */
.tone-selector-label {
    display: block; /* ç¢ºä¿æ¨™ç±¤ç¨ä½”ä¸€è¡Œï¼Œè®“é‚Šè·èƒ½æ­£ç¢ºé¡¯ç¤º */
    margin-top: 25px; /* å¢åŠ èˆ‡ä¸Šæ–¹å…ƒç´ çš„è·é›¢ */
}

/* --- é¡Œç›®é¡¯ç¤ºå€å¡Šæ¨£å¼ --- */
#topicResult, #argumentTopicResult {
    position: relative; /* ç‚ºäº†è®“ ::before å½å…ƒç´ å¯ä»¥å®šä½ */
    padding: 12px 15px;
    margin-bottom: 20px;
    border-left: 5px solid #2A9689;
    border-radius: 4px;
    font-size: 1em;
    display: none;
    background-color: transparent !important; /* å¼·åˆ¶å®¹å™¨æœ¬èº«é€æ˜ */
    z-index: 0;
}

#topicResult::before,
#argumentTopicResult::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(54, 187, 167, 0.5); /* åœ¨é€™è£¡è¨­å®šåŠé€æ˜èƒŒæ™¯ */
    border-radius: inherit; /* è®“èƒŒæ™¯çš„åœ“è§’èˆ‡å®¹å™¨åŒæ­¥ */
    z-index: -1; /* å°‡èƒŒæ™¯å±¤æ”¾åˆ°å…§å®¹çš„å¾Œé¢ */
}

/* æ­¥é©ŸäºŒï¼šå¼·åˆ¶è¨­å®šè¡¨æ ¼å„²å­˜æ ¼çš„èƒŒæ™¯é¡è‰² */
#topicResult td,
#argumentTopicResult td {
    background-color: #ffffff !important; /* å¼·åˆ¶ï¼å…§å®¹å„²å­˜æ ¼ç‚ºä¸é€æ˜ç™½è‰² */
}

#topicResult th,
#argumentTopicResult th {
    background-color: #f0f0f0 !important; /* å¼·åˆ¶ï¼è¡¨é ­ç‚ºä¸é€æ˜æ·ºç°è‰² */
}

/* ç•¶é¡Œç›®å€å¡Šå…§æœ‰å…§å®¹æ™‚ï¼Œæ‰å°‡å…¶é¡¯ç¤ºå‡ºä¾† */
#topicResult:not(:empty), #argumentTopicResult:not(:empty) {
    display: block;
}

/* --- æ–°å¢ï¼šè®“ã€Œé¸æ“‡é¡Œç›®æ–¹å¼ã€æ¨™é¡Œç¨ç«‹æˆè¡Œ --- */
#topicSelectionArea > label,
#argumentTopicSelectionArea > label {
    display: block;      /* è®“æ¨™é¡Œè®Šç‚ºå€å¡Šå…ƒç´ ï¼Œä½¿å…¶å¼·åˆ¶æ›è¡Œ */
    margin-bottom: 10px; /* åœ¨æ¨™é¡Œå’Œä¸‹æ–¹çš„æŒ‰éˆ•ä¹‹é–“å¢åŠ ä¸€é»å‚ç›´é–“è·ï¼Œè®“ç‰ˆé¢æ›´ç¾è§€ */
}

/* --- æŒ‰éµç¾åŒ–ä¿®è¨‚ (ç¬¬äºŒç‰ˆ) --- */

/* --- æŒ‰éµç¾åŒ–ä¿®è¨‚ (ç¬¬ä¸‰ç‰ˆ - å¼·åŠ›é»äº®æ•ˆæœ) --- */

/* --- æŒ‰éµç¾åŒ–ä¿®è¨‚ (ç¬¬å››ç‰ˆ - ç°è‰²é è¨­/é»æ“Šè®Šè‰²) --- */

/* 1. åŒ…è£¹æŒ‰éµçš„å®¹å™¨ */
.topic-buttons-container {
    display: flex;
    gap: 15px;
    align-items: center;
    margin-top: 10px;
}

/* 2. é€šç”¨çš„æŒ‰éµåŸºç¤æ¨£å¼ */
.btn {
    padding: 8px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    color: white;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    border: 3px solid transparent;
    
    /* ã€æ ¸å¿ƒä¿®è¨‚ã€‘é è¨­ç‹€æ…‹ä¸‹ï¼Œæ‰€æœ‰æŒ‰éµéƒ½æ˜¯ç°è‰² */
    background-color: #8E8E93; /* ä¸€å€‹è³ªæ„Ÿä¸éŒ¯çš„ä¸­æ€§ç° */
}

/* 3. æ»‘é¼ æ‡¸åœæ•ˆæœ (åªå°éæ´»å‹•çš„ç°è‰²æŒ‰éµç”Ÿæ•ˆ) */
.btn:not(.active):hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    filter: brightness(110%); /* æ‡¸åœæ™‚è®“ç°è‰²ç¨å¾®è®Šäº® */
}

/* --- é»äº® (Active) ç‹€æ…‹çš„æ¨£å¼ --- */

/* 4. ç•¶ã€Œç”Ÿæˆé¡Œç›®ã€æŒ‰éµè¢«é»äº®æ™‚ï¼Œè®Šæˆè—è‰² */
.btn-generate.active {
    background-color: #4A90E2; 
}

/* 5. ç•¶ã€Œè‡ªè¨‚é¡Œç›®ã€æŒ‰éµè¢«é»äº®æ™‚ï¼Œè®Šæˆç´«è‰² */
.btn-custom.active {
    background-color: #7B68EE; 
}

/* 6. æ‰€æœ‰è¢«é»äº®çš„æŒ‰éµï¼Œéƒ½å¥—ç”¨ç›¸åŒçš„å¼·åŠ›ç™¼å…‰æ•ˆæœ */
.btn.active {
    filter: brightness(115%);
    border: 3px solid white;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
    transform: translateY(-2px);
}

.btn .fas {
    font-size: 15px;
}

/* --- æ–°å¢ï¼šèª¿æ•´ã€Œå‰©é¤˜å­—æ•¸ã€è¨ˆæ•¸å™¨çš„æ¨£å¼èˆ‡ä½ç½® --- */
#charCount {
    margin-top: 0px; /* å¤§å¹…æ¸›å°‘èˆ‡ä¸Šæ–¹è¼¸å…¥æ¡†çš„é–“è· */
    margin-bottom: 20px; /* ç¢ºä¿èˆ‡ä¸‹æ–¹å…ƒç´ çš„é–“è·ï¼Œé¿å…æ“ åœ¨ä¸€èµ· */
    text-align: right; /* å°‡æ–‡å­—é å³å°é½Šï¼Œçœ‹èµ·ä¾†æ›´å°ˆæ¥­ */
    font-size: 0.9em; /* è®“å­—é«”ç¨å¾®å°ä¸€é»ï¼Œä½œç‚ºè¼”åŠ©è³‡è¨Š */
    color: #666; /* ä½¿ç”¨è¼ƒæŸ”å’Œçš„ç°è‰² */
}

/* --- æ–°å¢ï¼šç¦ç”¨æŒ‰éˆ•çš„é€šç”¨æ¨£å¼ --- */
button:disabled {
    background-color: #cccccc; /* ç°è‰²èƒŒæ™¯ */
    color: #666666;      /* æ·±ç°è‰²æ–‡å­— */
    cursor: not-allowed;  /* é¡¯ç¤ºã€Œç¦æ­¢ã€çš„é¼ æ¨™åœ–ç¤º */
    opacity: 0.6;         /* é™ä½é€æ˜åº¦ */
}

/* ç¢ºä¿æ­¤æ¨£å¼ä¹Ÿé©ç”¨æ–¼æœ‰ç‰¹å®š class çš„æŒ‰éˆ• */
.btn:disabled, .btn-icon-confirm:disabled {
    background-color: #cccccc !important; /* ä½¿ç”¨ !important è¦†è“‹åŸæœ‰æ¨£å¼ */
    border-color: #cccccc !important;
    cursor: not-allowed;
    opacity: 0.6;
    box-shadow: none; /* ç§»é™¤é™°å½± */
    transform: none;  /* ç§»é™¤è®Šå½¢æ•ˆæœ */
}

/* --- æ–°å¢ï¼šå„²å­˜/æ¸…é™¤åœ–ç¤ºæŒ‰éµæ¨£å¼ --- */
.action-buttons-container {
    display: flex;
    justify-content: flex-end; /* å°‡æŒ‰éˆ•é å³å°é½Š */
    gap: 12px; /* æŒ‰éˆ•ä¹‹é–“çš„é–“è· */
    margin-top: 10px; /* èˆ‡ä¸Šæ–¹å…ƒç´ çš„é–“è· */
    align-items: center; /* ç¢ºä¿æ‰€æœ‰é …ç›®å‚ç›´ç½®ä¸­ */
}
/* ... (æ‚¨åŸæœ‰çš„ .btn-icon-action, .btn-save-icon, .btn-clear-icon æ¨£å¼) ... */

/* æ–°å¢çµæ§‹æ®µæŒ‰éˆ•çš„ç‰¹å®šé¡è‰² */
.btn-add-icon {
    background-color: #007bff; /* ä¸»é¡Œè—è‰² */
}

.btn-icon-action {
    width: 36px;
    height: 36px;
    border-radius: 50%; /* åœ“å½¢æŒ‰éˆ• */
    border: none;
    color: white; /* åœ–ç¤ºé¡è‰² */
    font-size: 16px; /* åœ–ç¤ºå¤§å° */
    
    display: inline-flex;
    align-items: center;
    justify-content: center;
    
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    transition: all 0.2s ease-in-out;
}

.btn-icon-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    filter: brightness(110%);
}

.btn-icon-action:active {
    transform: translateY(0);
}

/* å„²å­˜æŒ‰éˆ•çš„ç‰¹å®šé¡è‰² */
.btn-save-icon {
    background-color: #28a745; /* ç¶ è‰² */
}

/* æ¸…é™¤æŒ‰éˆ•çš„ç‰¹å®šé¡è‰² */
.btn-clear-icon {
    background-color: #dc3545; /* ç´…è‰² */
}

/* --- æ–°å¢ï¼šæ›¸ç±è¨è«–è³‡è¨Šçš„å°ˆå±¬æ¨£å¼ --- */
.discussion-info {
    text-align: left; /* å¼·åˆ¶æ–‡å­—é å·¦å°é½Š */
    background-color: #eef1f4; /* ä¸€å€‹æŸ”å’Œã€ä¸­æ€§çš„èƒŒæ™¯è‰² */
    color: #333; /* æ·±è‰²æ–‡å­—ï¼Œç¢ºä¿å¯è®€æ€§ */
    padding: 12px 15px; /* é©ç•¶çš„å…§é‚Šè· */
    border-radius: 8px; /* åœ“è§’ */
    margin: 5px 0 15px 0; /* èˆ‡ä¸‹æ–¹ AI å›æ‡‰çš„é–“è· */
    line-height: 1.6; /* å¢åŠ è¡Œé«˜ï¼Œè®“æ–‡å­—ä¸æ“æ“  */
}

.discussion-info strong {
    color: #0056b3; /* è®“æ¨™é¡Œæ–‡å­—(æ›¸åã€ä½œè€…ç­‰)ä½¿ç”¨ä¸»é¡Œè—è‰²ï¼Œæ›´çªå‡º */
}

/* --- æ–°å¢ï¼šæ›¸ç±è³‡è¨Šè¡¨æ ¼çš„æ¨£å¼ --- */
.discussion-info table {
    width: 100%;
    border-collapse: collapse; /* ç§»é™¤å„²å­˜æ ¼ä¹‹é–“çš„ç©ºéš™ */
}

.discussion-info td {
    border: none; /* ç§»é™¤æ‰€æœ‰é‚Šæ¡† */
    padding: 4px 0; /* å¾®èª¿å‚ç›´å…§é‚Šè·ï¼Œè®“è¡Œè·é©ä¸­ */
    vertical-align: top; /* ç¢ºä¿é•·å…§å®¹çš„å„²å­˜æ ¼é ‚éƒ¨å°é½Š */
}

/* è®“æ¨™é¡Œæ¬„ä½æœ‰ä¸€å€‹å›ºå®šçš„ã€è¼ƒå°çš„å¯¬åº¦ */
.discussion-info td:first-child {
    width: 90px; /* æ‚¨å¯ä»¥æ ¹æ“šéœ€è¦èª¿æ•´é€™å€‹å¯¬åº¦ */
    font-weight: bold; /* è®“æ¨™é¡ŒåŠ ç²— */
    color: #0056b3; /* ç¹¼æ‰¿ä¸»é¡Œè—è‰² */
}

/* --- å…¨æ–°å°è©±è¦–çª—ç¾åŒ–æ¨£å¼ --- */

/* --- å…¨æ–°èŠå¤©ä»‹é¢æ¨£å¼ (ç„¡é ­åƒæ¥µç°¡ç‰ˆ) --- */

/* 1. èŠå¤©æ­·å²å®¹å™¨ */
/* 1. èŠå¤©æ­·å²å®¹å™¨ */
#chatHistory {
    background-color: #f0f4f8;
    border: 1px solid #dde3ea;
    border-radius: 12px;
    padding: 20px 15px;
    margin-bottom: 15px;
    max-height: 400px;
    overflow-y: auto;
    display: none;
    scroll-behavior: smooth;
    
    display: flex;
    flex-direction: column;
 
}

/* ã€æ ¸å¿ƒä¿®è¨‚ã€‘ä¸å†éœ€è¦ .message-row */

/* 2. è¨Šæ¯æ°£æ³¡æ¨£å¼ */
.message-bubble {
    padding: 10px 15px;
    border-radius: 18px;
    line-height: 1.5;
    word-wrap: break-word;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    max-width: 80%;
    animation: fadeIn 0.3s ease-in-out;
    margin-bottom: 15px; /* ã€æ ¸å¿ƒä¿®è¨‚ã€‘ç‚ºæ¯å€‹æ°£æ³¡å¢åŠ ä¸‹é‚Šè· */
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}



/* ---ã€æœ€çµ‚ä¿®æ­£ç‰ˆã€‘èŠå¤©æ°£æ³¡æ¨£å¼ --- */

/* 3. AI (é™³SIR) è¨Šæ¯çš„æ°£æ³¡æ¨£å¼ */
/* æˆ‘å€‘ä½¿ç”¨çµ„åˆé¸æ“‡å™¨ï¼Œç¢ºä¿åªé‡å°åŒæ™‚æ˜¯ bubble å’Œ ai-message çš„å…ƒç´  */
.message-bubble.ai-message {
    background-color: #ffffff;
    color: #333;
    align-self: flex-start; /* è®“æ°£æ³¡è‡ªèº«é å·¦ */
    border-top-left-radius: 4px; /* è£½é€ æ°£æ³¡æŒ‡å‘æ„Ÿ */
}

/* 4. ä½¿ç”¨è€…è¨Šæ¯çš„æ°£æ³¡æ¨£å¼ */
/* åŒæ¨£ï¼Œä½¿ç”¨çµ„åˆé¸æ“‡å™¨ä¾†æé«˜æ¬Šé‡ï¼Œç¢ºä¿æ¨£å¼èƒ½è¢«æ‡‰ç”¨ */
.message-bubble.user-message {
    background-color: rgba(45, 153, 102, 0.9); /* æ‚¨æƒ³è¦çš„å¸¶é€æ˜åº¦çš„ç¶ è‰² */
    color: white;
    align-self: flex-end; /* è®“æ°£æ³¡è‡ªèº«é å³ */
    border-top-right-radius: 4px; /* è£½é€ æ°£æ³¡æŒ‡å‘æ„Ÿ */
}




/* 5. æ›¸ç±è³‡è¨Šå¡ç‰‡æ¨£å¼ (ä¿æŒä¸è®Š) */
.discussion-info {
    text-align: left;
    background-color: #e9ecef;
    color: #495057;
    padding: 12px 15px;
    border-radius: 8px;
    margin: 0 auto 15px auto;
    line-height: 1.6;
    width: 95%;
    box-sizing: border-box;
}

/* ... discussion-info table çš„æ¨£å¼ä¿æŒä¸è®Š ... */
.discussion-info table {
    width: 100%;
    border-collapse: collapse;
}
.discussion-info td {
    border: none;
    padding: 4px 0;
    vertical-align: top;
}
.discussion-info td:first-child {
    width: 90px;
    font-weight: bold;
    color: #0056b3;
}

#discussionControlButtons {
    margin-bottom: 30px; 

</style>
</head>
<body>


<div class="title-container">
<h1>
<span class="title-text">ç¥æ€</span>
</h1>
</div>


<div id="hitokoto-container" class="box">
<div id="hitokoto"></div>
<div id="hitokoto-footer">
<span id="hitokoto-from"></span>
<button id="refresh-btn"><i class="fas fa-sync-alt"></i></button>
</div>
</div>



<style>
#hitokoto-container {
background: rgba(220, 220, 220, 0.96);
border-radius: 8px;
box-shadow: 0 2px 4px rgba(0,0,0,0.1);
padding: 16px;
margin: 15px 0;
text-align: center;
max-width: 800px;
position: relative;
}

@media (max-width: 600px) {
#hitokoto-container {
text-align: left;
}
}

#hitokoto {
font-size: 21px;
font-style: italic;
color: #333;
margin-bottom: 10px;
}

#hitokoto p {
margin: 5px 0;
}

#hitokoto-footer {
display: flex;
justify-content: space-between;
align-items: center;
margin-top: 10px;
}

#hitokoto-from {
font-size: 16px;
color: #666;
}

#refresh-btn {
background: none;
border: none;
cursor: pointer;
font-size: 20px;
color: #666;
transition: color 0.3s;
padding: 0;
margin: 0;
}

#refresh-btn:hover {
color: #000;
}


/* --- æ–°å¢ï¼šç¢ºèªåœ–ç¤ºæŒ‰éµæ¨£å¼ --- */

.btn-icon-confirm {
    /* 1. å¤–è§€è¨­å®šï¼šåœ“å½¢ã€ç¶ è‰²èƒŒæ™¯ */
    width: 44px;
    height: 44px;
    border-radius: 50%; /* è£½ä½œæˆå®Œç¾çš„åœ“å½¢ */
    background-color: #28a745; /* æˆåŠŸã€ç¢ºèªçš„ç¶ è‰² */
    border: none;
    
    /* 2. åœ–ç¤ºç½®ä¸­èˆ‡æ¨£å¼ */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: white; /* åœ–ç¤ºé¡è‰² */
    font-size: 20px; /* åœ–ç¤ºå¤§å° */
    
    /* 3. äº’å‹•æ•ˆæœèˆ‡é™°å½± */
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease-in-out;
}

.btn-icon-confirm:hover {
    /* 4. æ»‘é¼ æ‡¸åœæ™‚ï¼šæ”¾å¤§ã€æäº®ï¼Œé™°å½±åŠ æ·± */
    transform: scale(1.1);
    filter: brightness(110%);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
}

.btn-icon-confirm:active {
    /* 5. é»æ“Šç¬é–“ï¼šå†æ”¾å¤§ä¸€é»ï¼Œæä¾›å›é¥‹æ„Ÿ */
    transform: scale(1.15);
}



</style>

<script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
const converter = OpenCC.Converter({ from: 'cn', to: 'tw' });
const hitokotoElement = document.getElementById('hitokoto');
const hitokotoFromElement = document.getElementById('hitokoto-from');
const refreshBtn = document.getElementById('refresh-btn');

function fetchHitokoto() {
fetch('https://v1.hitokoto.cn/?c=d&c=i&c=k&encode=json')
.then(response => response.json())
.then(data => {
if (data.from.includes('é­”é“ç¥–å¸«')) {
fetchHitokoto(); // å¦‚æœä¾†æºæ˜¯ã€Œé­”é“ç¥–å¸«ã€ï¼Œé‡æ–°ç²å–åè¨€
} else {
const convertedHitokoto = converter(data.hitokoto);
const convertedFrom = converter(data.from);
const convertedFromWho = data.from_who ? converter(data.from_who) : 'ä½šå';
hitokotoElement.innerHTML = `<p>${convertedHitokoto}</p>`;
hitokotoFromElement.innerHTML = `â€”â€” ${convertedFromWho} ã€Š${convertedFrom}ã€‹`;
}
})
.catch(error => {
console.error('ç²å–åè¨€å¤±æ•—:', error);
hitokotoElement.innerHTML = '<p>ç²å–åè¨€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</p>';
hitokotoFromElement.innerHTML = '';
});
}

fetchHitokoto();
refreshBtn.addEventListener('click', fetchHitokoto);
});
</script>



<!-- å·¥å…·é¸æ“‡ -->
<div class="box">
<h2>å·¥å…·ä¸€è¦½ï¼š</h2>
<button id="expandToolsBtn2" style="background-color: #36BBA7;">é»æ“Šå±•é–‹</button>


<div id="effectContainer" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1001; pointer-events: none;"></div>
</div>

<!-- ç¯„ç–‡é¸æ“‡ -->
<div class="box">
<h2>é¸æ“‡ç¯„ç–‡ï¼š</h2>
<button id="readingBtn">ğŸ“•é–±è®€</button>
<button id="writingBtn">âœæ•˜äº‹æŠ’æƒ…</button>
<button id="argumentBtn">ğŸ“‹è­°è«–</button>
<button id="expandBtn">ğŸ“‚æ•´åˆæ‹“å±•</button>
<button id="booksBtn">ğŸ“šèª²å¤–æ›¸ç±</button>
</div>



<!-- å¯«ä½œå®¹å™¨ -->
<div id="writingContainer" class="box">
    <h2>æ•˜äº‹æŠ’æƒ…</h2>
    <div style="position:relative; width:100%; height:0px; padding-bottom:62.222%"><iframe allow="fullscreen" allowfullscreen height="100%" src="https://streamable.com/e/lke2eo?loop=0" width="100%" style="border:none; width:100%; height:100%; position:absolute; left:0px; top:0px; bottom:2px; overflow:hidden;"></iframe></div>
    
    <div class="function-selector-wrapper">
        <label for="writingType">é¸æ“‡åŠŸèƒ½ï¼š</label>
        <select id="writingType" onchange="toggleWritingType()">
            <option value="" selected disabled>è«‹åœ¨æ­¤é¸æ“‡åŠŸèƒ½</option>
            <option value="å¤§ç¶±">å¤§ç¶±</option>
            <option value="ç‰‡æ®µæå¯«">ç‰‡æ®µæå¯«/å…¨æ–‡å¯«ä½œ</option>
            <option value="æ•˜äº‹ç‰©è±¡">æ•˜äº‹ç‰©è±¡</option>
        </select>
    </div>

    <div id="writingContentContainer" style="display: none;">
        <div id="outlineStructureArea" style="display: none;">
            <label for="structure">é¸æ“‡å¤§ç¶±çµæ§‹ï¼š</label>
            <select id="structure" onchange="generateOutlineTable()">
                <option value="fourPart">èµ·æ‰¿è½‰åˆ</option>
                <option value="threeLine">ä¸‰ç·š</option>
            </select>
        </div>
    <!-- ... çœç•¥éƒ¨åˆ†ç¨‹å¼ç¢¼ ... -->
<div id="topicSelectionArea">
    <label>é¸æ“‡é¡Œç›®æ–¹å¼ï¼š</label>
    <div class="topic-buttons-container">
        <!-- å¥—ç”¨æ–°çš„ class: btn-generate -->
        <button class="btn btn-generate" onclick="generateTopic(this)">
            <i class="fas fa-sync-alt"></i> ç”Ÿæˆ
        </button>
        <!-- å¥—ç”¨æ–°çš„ class: btn-custom -->
        <button class="btn btn-custom" onclick="showCustomTopicInput(this)">
            <i class="fas fa-edit"></i> è‡ªè¨‚
        </button>
    </div>
    <div id="customTopicArea" style="display: none; margin-top: 15px;"></div>
</div>

<div id="topicResult"></div>
        <div id="narrativeElementsArea" style="display: none;">

            <label for="narrativeElements">è«‹è¼¸å…¥æ‚¨çš„å–ææˆ–æ•…äº‹èƒŒæ™¯ï¼š</label>
            <textarea id="narrativeElements" rows="5" placeholder="ä¾‹å¦‚ï¼šæ•…äº‹èƒŒæ™¯ã€äººç‰©è¨­å®šã€å–æç­‰..."></textarea>
        </div>
        <div id="writingArea">
             
            <div id="outlineTableArea"></div>
            <div id="outlineButtons" style="display: none;" class="action-buttons-container">
    <button class="btn-icon-action btn-save-icon" onclick="saveOutline()" title="å„²å­˜å¤§ç¶±">
        <i class="fas fa-save"></i>
    </button>
    <button class="btn-icon-action btn-clear-icon" onclick="clearOutline()" title="æ¸…ç©ºå¤§ç¶±">
        <i class="fas fa-trash-alt"></i>
    </button>
</div>
            <textarea id="writingContent" rows="10" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„å¯«ä½œå…§å®¹ï¼ˆã€Œç‰‡æ®µæå¯«ã€ä½¿ç”¨ï¼‰..." style="display: none;"></textarea>
          <label for="writingTone" id="writingToneLabel" class="tone-selector-label" style="display: none;">é¸æ“‡é»è©•èªæ°£ï¼š</label>
            <select id="writingTone" style="display: none;">
                <option value="serious">åš´è‚…æ­£ç¶“</option>
                <option value="chen">é™³SIRèªæ°£</option>
            </select>
            <!-- å°‡ <button onclick="submitWriting()"> æ”¹ç‚ºï¼š -->
<button id="submitWritingBtn" onclick="submitWriting()">æäº¤</button>
            <div id="commentResult"></div>
        </div>
    </div>
</div>

<!-- é–±è®€å®¹å™¨ -->
<div id="readingContainer" class="box" style="display: none;">
    <h2>é–±è®€</h2>
    <div style="position:relative; width:100%; height:0px; padding-bottom:62.222%"><iframe allow="fullscreen" allowfullscreen height="100%" src="https://streamable.com/e/vt3i1j?loop=0" width="100%" style="border:none; width:100%; height:100%; position:absolute; left:0px; top:0px; bottom:2px; overflow:hidden;"></iframe></div>
    
    <div class="function-selector-wrapper">
        <label for="readingFunction">é¸æ“‡åŠŸèƒ½ï¼š</label>
        <select id="readingFunction" onchange="toggleReadingFunction()">
            <option value="" selected disabled>è«‹åœ¨æ­¤é¸æ“‡åŠŸèƒ½</option>
            <option value="comment">é»è©•</option>
            <option value="guide">æŒ‡å¼•</option>
        </select>
    </div>

    <div id="readingInputArea" style="display: none;">
        <label for="readingPassage">è²¼ä¸Šé–±è®€ç¯‡ç« ï¼š</label>
        <textarea id="readingPassage" rows="10" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šé–±è®€ç¯‡ç« ..."></textarea>
        <label for="readingQuestion">è²¼ä¸Šé¡Œç›®ï¼š</label>
        <textarea id="readingQuestion" rows="3" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šé¡Œç›®..."></textarea>
        <div id="studentAnswerArea" style="display: none;">
            <label for="studentAnswer">è²¼ä¸Šç­”æ¡ˆï¼š</label>
            <textarea id="studentAnswer" rows="5" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šç­”æ¡ˆ..."></textarea>
        </div>
        <label for="readingTone" id="readingToneLabel" class="tone-selector-label" style="display: none;">é¸æ“‡é»è©•èªæ°£ï¼š</label>
        <select id="readingTone" style="display: none;">
            <option value="serious">åš´è‚…æ­£ç¶“</option>
            <option value="chen">é™³SIRèªæ°£</option>
        </select>
        <!-- å°‡ <button onclick="submitReading()"> æ”¹ç‚ºï¼š -->
<button id="submitReadingBtn" onclick="submitReading()">æäº¤</button>
        <div id="readingResult"></div>
    </div>
</div>

<!-- èª²å¤–æ›¸ç±å®¹å™¨ -->
<div id="booksContainer" class="box" style="display: none;">
<h2>èª²å¤–æ›¸ç±è¨è«–</h2>
<div style="position:relative; width:100%; height:0px; padding-bottom:62.222%"><iframe allow="fullscreen" allowfullscreen height="100%" src="https://streamable.com/e/4eznsi?loop=0" width="100%" style="border:none; width:100%; height:100%; position:absolute; left:0px; top:0px; bottom:2px; overflow:hidden;"></iframe></div>
<p>è«‹åœ¨ä¸‹æ–¹å¡«å¯«æ›¸åã€ä½œè€…å’Œè¨è«–å•é¡Œï¼Œé–‹å§‹èˆ‡é™³SIRå°è©±ï¼š</p>
<input type="text" id="bookTitle" placeholder="æ›¸å">
<input type="text" id="author" placeholder="ä½œè€…">
<textarea id="discussionQuestion" rows="3" placeholder="è¨è«–å•é¡Œ"></textarea>
<label for="booksTone">é¸æ“‡èªæ°£ï¼š</label>
<select id="booksTone">
<option value="serious">åš´è‚…æ­£ç¶“</option>
<option value="casual">è¼•é¬†æ´»æ½‘</option>
</select>
<div id="discussionControlButtons">
    <button id="startDiscussionBtn" onclick="startDiscussion()">é–‹å§‹è¨è«–</button>
</div>

<div id="chatHistory"></div>

<textarea id="userInput" rows="3" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„å›æ‡‰..."></textarea>

<!-- ã€æ ¸å¿ƒä¿®è¨‚ã€‘å°‡ continueBtn ç§»åˆ° userInput ä¹‹å¾Œï¼Œä¸¦é è¨­éš±è— -->
<button id="continueBtn" onclick="continueDiscussion()" style="display: none;">ç¹¼çºŒè¨è«–</button>

<div id="booksButtons" class="action-buttons-container">
    <button class="btn-icon-action btn-save-icon" onclick="saveBooksChat()" title="å„²å­˜å°è©±">
        <i class="fas fa-save"></i>
    </button>
    <button class="btn-icon-action btn-clear-icon" onclick="clearBooksChat()" title="æ¸…ç©ºå°è©±">
        <i class="fas fa-trash-alt"></i>
    </button>
</div>
</div>

<!-- æ•´åˆæ‹“å±•å®¹å™¨ -->
<!-- è«‹ç”¨é€™å€‹æ–°ç‰ˆæœ¬çš„ expandContainer å€å¡Šï¼Œæ›¿æ›æ‰æ‚¨åŸæœ¬çš„æ•´æ®µ -->
<div id="expandContainer" class="box" style="display: none;">
    <h2>æ•´åˆæ‹“å±•</h2>
    <div style="position:relative; width:100%; height:0px; padding-bottom:62.222%"><iframe allow="fullscreen" allowfullscreen height="100%" src="https://streamable.com/e/2otwxv?loop=0" width="100%" style="border:none; width:100%; height:100%; position:absolute; left:0px; top:0px; bottom:2px; overflow:hidden;"></iframe></div>
    
    <div class="function-selector-wrapper">
        <label for="expandFunction">é¸æ“‡åŠŸèƒ½ï¼š</label>
        <select id="expandFunction" onchange="toggleExpandFunction()">
            <option value="" selected disabled>è«‹åœ¨æ­¤é¸æ“‡åŠŸèƒ½</option>
            <option value="comment">é»è©•</option>
            <option value="guide">æŒ‡å¼•</option>
        </select>
    </div>

    <div id="expandContentContainer" style="display: none;">
        


<div id="expandTopicSelectionArea" style="display: none;">
    <label>é¸æ“‡é¡Œç›®æ–¹å¼ï¼š</label>
    <div class="topic-buttons-container">
        <!-- å¥—ç”¨æ–°çš„ class: btn-generate -->
        <button class="btn btn-generate" onclick="generateExpandTopic(this)">
            <i class="fas fa-sync-alt"></i> ç”Ÿæˆ
        </button>
        <!-- å¥—ç”¨æ–°çš„ class: btn-custom -->
        <button class="btn btn-custom" onclick="showExpandCustomTopicInput(this)">
            <i class="fas fa-edit"></i> è‡ªè¨‚
        </button>
    </div>
    <!-- é€™å€‹ div ç”¨ä¾†å‹•æ…‹é¡¯ç¤ºè‡ªè¨‚é¡Œç›®çš„è¼¸å…¥æ¡† -->
    <div id="expandCustomTopicInputArea" style="display: none; margin-top: 15px;">
    </div>
</div>
        <!-- ã€æ ¸å¿ƒä¿®è¨‚ã€‘å°‡ topicResult å¾ TopicSelectionArea å…§éƒ¨ç§»åˆ°å¤–éƒ¨ -->
        <div id="expandTopicResult"></div>

        <div id="expandWritingArea" style="display: none;">
            <label for="expandContent">æ•´åˆæ‹“å±•ï¼ˆæœ€å¤š180å­—ï¼‰ï¼š</label>
            <textarea id="expandContent" rows="5" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ•´åˆæ‹“å±•å…§å®¹..." oninput="updateCharCount()"></textarea>
            <p id="charCount">å‰©é¤˜å­—æ•¸ï¼š180</p>
            <label for="expandTone" id="expandToneLabel" class="tone-selector-label" style="display: none;">é¸æ“‡é»è©•èªæ°£ï¼š</label>
            <select id="expandTone" style="display: none;">
                <option value="serious">åš´è‚…æ­£ç¶“</option>
                <option value="chen">é™³SIRèªæ°£</option>
            </select>
            <!-- å°‡ <button onclick="submitExpand()"> æ”¹ç‚ºï¼š -->
<button id="submitExpandBtn" onclick="submitExpand()">æäº¤</button>
            <div id="expandCommentResult"></div>
        </div>
        
        <div id="expandGuideArea" style="display: none;">
            <table>
                <tr><th>é¡Œç›®</th><td><input type="text" id="expandGuideTitle" placeholder="è«‹è¼¸å…¥é¡Œç›®"></td></tr>
                <tr><th>ä¸»é¡Œå¥</th><td><textarea id="expandGuideTheme" rows="2" placeholder="è«‹è¼¸å…¥ä¸»é¡Œå¥"></textarea></td></tr>
                <tr><th>æŠ„éŒ„è³‡æ–™</th><td><textarea id="expandGuideData" rows="3" placeholder="è«‹è¼¸å…¥æŠ„éŒ„è³‡æ–™"></textarea></td></tr>
                <tr><th>æ•´åˆæ‹“å±•</th><td><textarea id="expandGuideExpand" rows="3" placeholder="è«‹è¼¸å…¥æ•´åˆæ‹“å±•"></textarea></td></tr>
            </table>
            <button onclick="submitExpand()">æäº¤</button>
            <div id="expandGuideResult"></div>
        </div>
    </div>
</div>

<!-- è­°è«–å®¹å™¨ -->
<div id="argumentContainer" class="box" style="display: none;">
    <h2>è­°è«–</h2>
    <div style="position:relative; width:100%; height:0px; padding-bottom:62.222%"><iframe allow="fullscreen" allowfullscreen height="100%" src="https://streamable.com/e/0ki8mx?loop=0" width="100%" style="border:none; width:100%; height:100%; position:absolute; left:0px; top:0px; bottom:2px; overflow:hidden;"></iframe></div>

    <div class="function-selector-wrapper">
        <label for="argumentType">é¸æ“‡åŠŸèƒ½ï¼š</label>
        <select id="argumentType" onchange="toggleArgumentType()">
            <option value="" selected disabled>è«‹åœ¨æ­¤é¸æ“‡åŠŸèƒ½</option>
            <option value="outline">å¤§ç¶±</option>
            <option value="writing">ç‰‡æ®µå¯«ä½œ/å…¨æ–‡å¯«ä½œ</option>
            <option value="guide">æŒ‡å¼•</option>
        </select>
    </div>
    
    <div id="argumentContentContainer" style="display: none;">
        <div id="argumentTopicSelectionArea">
    <label>é¸æ“‡é¡Œç›®æ–¹å¼ï¼š</label>
    <div class="topic-buttons-container">
        <!-- å¥—ç”¨æ–°çš„ class: btn-generate -->
        <button class="btn btn-generate" onclick="generateArgumentTopic(this)">
            <i class="fas fa-sync-alt"></i> ç”Ÿæˆ
        </button>
        <!-- å¥—ç”¨æ–°çš„ class: btn-custom -->
        <button class="btn btn-custom" onclick="showArgumentCustomTopicInput(this)">
            <i class="fas fa-edit"></i> è‡ªè¨‚
        </button>
    </div>
    <div id="argumentCustomTopicArea" style="display: none; margin-top: 15px;">
        <!-- å…§å®¹å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
    </div>
</div>
        <div id="argumentTopicResult"></div>
        <div id="argumentOutlineArea" style="display: none;">
     
    <div id="argumentOutlineTableArea"></div>
    
    <!-- æŒ‰éˆ•å®¹å™¨ç¾åœ¨åŒ…å«äº†æ–°å¢ã€å„²å­˜å’Œæ¸…é™¤æŒ‰éˆ• -->
    <div id="argumentOutlineButtons" class="action-buttons-container">
        <button class="btn-icon-action btn-add-icon" onclick="addArgumentStructureSegment()" title="æ–°å¢çµæ§‹æ®µ">
            <i class="fas fa-plus"></i>
        </button>
        <button class="btn-icon-action btn-save-icon" onclick="saveArgumentOutline()" title="å„²å­˜å¤§ç¶±">
            <i class="fas fa-save"></i>
        </button>
        <button class="btn-icon-action btn-clear-icon" onclick="clearArgumentOutline()" title="æ¸…ç©ºå¤§ç¶±">
            <i class="fas fa-trash-alt"></i>
        </button>
    </div>

    <label for="argumentOutlineTone" class="tone-selector-label">é¸æ“‡é»è©•èªæ°£ï¼š</label>
    <select id="argumentOutlineTone">
        <option value="serious">åš´è‚…æ­£ç¶“</option>
        <option value="chen">é™³SIRèªæ°£</option>
    </select>
    <button id="submitArgumentOutlineBtn" onclick="submitArgumentOutline()">æäº¤</button>
    <div id="argumentOutlineResult"></div>
</div>
        <div id="argumentWritingArea" style="display: none;">
            <textarea id="argumentWritingContent" rows="10" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„æ–‡ç« ..."></textarea>
            <label for="argumentWritingTone" class="tone-selector-label">é¸æ“‡é»è©•èªæ°£ï¼š</label>
            <select id="argumentWritingTone">
                <option value="serious">åš´è‚…æ­£ç¶“</option>
                <option value="chen">é™³SIRèªæ°£</option>
            </select>
            <!-- å°‡ <button onclick="submitArgumentWriting()"> æ”¹ç‚ºï¼š -->
<button id="submitArgumentWritingBtn" onclick="submitArgumentWriting()">æäº¤</button>
            <div id="argumentWritingResult"></div>
        </div>
        <div id="argumentGuideArea" style="display: none;">
            <label for="argumentGuideTopic">é¡Œç›®ï¼š</label>
            <input type="text" id="argumentGuideTopic" placeholder="è«‹è¼¸å…¥é¡Œç›®">
            <label for="argumentGuidePoint">è«–é»ï¼ˆå¯é¸ï¼‰ï¼š</label>
            <textarea id="argumentGuidePoint" rows="3" placeholder="è«‹è¼¸å…¥è«–é»"></textarea>
            <label for="argumentGuideEvidence">è«–æ“šï¼ˆå¯é¸ï¼‰ï¼š</label>
            <textarea id="argumentGuideEvidence" rows="3" placeholder="è«‹è¼¸å…¥è«–æ“š"></textarea>
            <label for="argumentGuideArgument">è«–è­‰ï¼ˆå¯é¸ï¼‰ï¼š</label>
            <textarea id="argumentGuideArgument" rows="3" placeholder="è«‹è¼¸å…¥è«–è­‰"></textarea>
           <button id="submitArgumentGuideBtn" onclick="submitArgumentGuide()">æäº¤</button>
            <div id="argumentGuideResult"></div>
        </div>
    </div>
</div>

<!-- éŸ³æ¨‚æ’­æ”¾å™¨ HTML -->
<div id="music-player">
<div class="controls">
<select id="music-select">
<option value="">é¸æ“‡éŸ³æ¨‚</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Battle-Abysswalker.mp3">The Abysswalker</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Battle-Rosemoon.mp3">æ­»ã›ã‚‹éƒ½ã®æˆ°ä¹™å¥³</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Battle-deadly.mp3">äº”å¤§ç½ª</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Battle-rapier.mp3">ç¹¼æ‰¿åŠçš„å°‘å¥³</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Ariadne-Battle.mp3">ä¸å±ˆæ„å¿—ä¹‹åˆƒ</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/battle-arms.mp3">è¥¿éƒ¨æˆ°é¬¥</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Battle.mp3">Battle Theme</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Wanderers-City.mp3">æµæµªåŸé®</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Remotest-Liblary.mp3">æ²‰ç¡çš„è¨˜æ†¶</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Nostalgia.mp3">éº¥ç”°æ‡·èˆŠ</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/sunbeams.mp3">æ”¾å­¸å¾Œ</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/village.mp3">é„‰æ‘ç”Ÿæ´»</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Take-a-Rest.mp3">ä¼‘æ¯ä¸€ä¸‹</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/winter-snow.mp3">é›ªé„‰</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Forgotten-Place.mp3">è¢«éºå¿˜çš„åœ°æ–¹</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Rest-in-Peace.mp3">å®‰æ¯</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Farewell.mp3">å‘Šåˆ¥</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/reminiscence.mp3">å›æ†¶</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/starry-night.mp3">æ˜Ÿå¤œ</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/last-wish.mp3">ç•¶æ€å¿µå‚³åˆ°æŸäººè€³ç•”</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/sorrow.mp3">è¶…è¶Šæ‚²å‚·</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/hotarumichi.mp3">è¢ç«èŸ²ä¹‹è·¯</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Sky-Airship.mp3">é£›è‰‡</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/Voyage_SE.mp3">è·¨è¶Šç¥ç§˜ä¹‹æµ·</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/main-theme01.mp3">ç›¼æœ›</option>
<option value="https://youfulca.com/wp-content/uploads/2022/08/saikai637.mp3">ç´„å®šä¹‹åœ°</option>
</select>
<button id="play-pause">â–¶ï¸</button>
</div>
<div class="progress">
<input type="range" id="progress-bar-music" value="0" min="0" max="100">
</div>
<div class="mode">
<select id="play-mode">
<option value="loop" selected>å–®æ›²å¾ªç’°</option>
<option value="next">è‡ªå‹•æ’­æ”¾ä¸‹é¦–</option>
</select>
</div>
<button class="hide-btn" id="hide-player">ğŸ”½</button>
</div>
<button id="show-player">ğŸ¹</button>
<audio id="audio" preload="auto"></audio>

<!-- å±•é–‹å·¥å…·äºŒ (èªè–ˆ) å®¹å™¨ -->
<div id="toolsContainer2">
<button id="closeToolsBtn2">&times;</button>
<div class="main-container">
<!-- Floating Title -->
<!-- Floating Title -->
<header class="floating-header">
<h1>èªè–ˆ</h1>
<button id="video-tour-btn" title="è§€çœ‹ä»‹ç´¹å½±ç‰‡">
<svg class="icon" viewBox="0 0 24 24"><use xlink:href="#icon-video"></use></svg>
</button>
</header>

<!-- Embedded SVG Icons -->
<svg width="0" height="0" style="position:absolute">
<defs>
<symbol id="icon-brain" viewBox="0 0 24 24"><path d="M7.445 11.232C7.445 10.537 7.98 9.96 8.629 9.96H9.02V8.203H7.818C6.983 8.203 6.3 8.91 6.3 9.778V11.23H5.161C4.326 11.23 3.644 11.938 3.644 12.806V14.17H2.82C2.17 14.17 1.636 14.746 1.636 15.44V17.65H1.523C.688 17.65 0 18.358 0 19.226V20.48C0 21.35 0.688 22.056 1.523 22.056H6.738C6.738 23.13 7.573 24 8.628 24H15.37C16.425 24 17.26 23.13 17.26 22.058H22.477C23.312 22.058 24 21.35 24 20.48V19.225C24 18.357 23.312 17.65 22.477 17.65H22.364V15.44C22.364 14.745 21.83 14.17 21.18 14.17H20.356V12.805C20.356 11.937 19.674 11.23 18.839 11.23H17.68V9.777C17.68 8.908 17.017 8.2 16.182 8.2H14.98V9.96H15.37C16.02 9.96 16.555 10.536 16.555 11.23V12.986H15.37V15.92H8.629V12.986H7.445V11.232M11.1 11.23H12.9V14.17H11.1V11.23M12 1.947C10.13 1.947 8.58 2.894 7.854 4.316C7.65 3.52 7.2 2.813 6.545 2.27C5.124 1.053 2.95 1.54 1.987 3.16C0.945 4.925 1.489 7.346 3.09 8.528C3.21 8.62 3.33 8.71 3.464 8.78C3.464 7.024 4.818 5.618 6.52 5.618C8.22 5.618 9.573 7.024 9.573 8.78V9.1H14.4V8.78C14.4 7.024 15.78 5.618 17.48 5.618C19.18 5.618 20.536 7.024 20.536 8.78C20.662 8.71 20.782 8.62 20.91 8.528C22.51 7.346 23.055 4.925 22.013 3.16C21.05 1.54 18.876 1.053 17.455 2.27C16.8 2.813 16.35 3.52 16.145 4.316C15.42 2.894 13.87 1.947 12 1.947Z"/></symbol>
<symbol id="icon-write" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" /></symbol>
<symbol id="icon-read" viewBox="0 0 24 24"><path d="M18.5,1.15C19.9,1.15 21.15,2.4 21.15,3.85V15.85C21.15,17.3 19.9,18.55 18.5,18.55H5.5C4.1,18.55 2.85,17.3 2.85,15.85V3.85C2.85,2.4 4.1,1.15 5.5,1.15H18.5M18.5,22.85H5.5C2.45,22.85 0,20.4 0,17.35V2.35C0,1.4 0.35,0.6 0.95,0.1C1.25,-0.1 1.7,-0.05 2,0.25L3.1,1.35C3.3,1.55 3.3,1.85 3.1,2.05L2.05,3.1C1.85,3.3 1.55,3.3 1.35,3.1L0.7,2.45C0.7,5.55 2.85,7.85 5.5,7.85H18.5C21.15,7.85 23.3,5.55 23.3,2.45L22.6,3.1C22.4,3.3 22.1,3.3 21.9,3.1L20.85,2.05C20.65,1.85 20.65,1.55 20.85,1.35L21.95,0.25C22.25,-0.05 22.7,-0.1 23,0.1C23.6,0.6 24,1.4 24,2.35V17.35C24,20.4 21.5,22.85 18.5,22.85Z" /></symbol>
<symbol id="icon-work" viewBox="0 0 24 24"><path d="M14,6V4H10V6H14M18,9H15V6H9V9H6A2,2 0 0,0 4,11V19A2,2 0 0,0 6,21H18A2,2 0 0,0 20,19V11A2,2 0 0,0 18,9Z" /></symbol>
<symbol id="icon-support" viewBox="0 0 24 24"><path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z" /></symbol>
<symbol id="icon-foundation" viewBox="0 0 24 24"><path d="M12 2L2 7V17L12 22L22 17V7L12 2ZM19.6 8.25L12 12.5L4.4 8.25L12 4L19.6 8.25Z"/></symbol>
<symbol id="icon-explore" viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A1.5,1.5 0 0,1 13.5,5.5A1.5,1.5 0 0,1 12,7A1.5,1.5 0 0,1 10.5,5.5A1.5,1.5 0 0,1 12,4M12,18.2C9.5,18.2 7.29,16.42 6.5,14H17.5C16.71,16.42 14.5,18.2 12,18.2Z"/></symbol>
<symbol id="icon-video" viewBox="0 0 24 24"><path d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z" /></symbol>
</defs>
</svg>

<!-- Mind Map Layout -->
<main class="mind-map-container" id="mind-map">
<svg class="connector-svg" id="connector-svg"></svg>

<!-- 1. Core AI -->
<div class="category" id="core-ai" data-connect-to="">
<div class="node" data-id="core-ai-node" style="padding: 10px 20px;">
<a href="https://kenchan20141.github.io/AIChinese/" data-tool-id="sansi">


<svg class="icon" style="width:32px; height:32px;"><use xlink:href="#icon-brain"></use></svg>
ç¥æ€
</a>
</div>
<div class="sub-group" style="flex-direction: row; gap: 10px;">
<div class="node level-3"><a href="https://kenchan20141.github.io/AIChinese2/" data-tool-id="sansi-backup">ç¥æ€ (å‚™ç”¨)</a></div>
<div class="node level-3"><a href="https://sansi.vercel.app/" data-tool-id="sansi-v3">ç¥æ€ (V3)</a></div>
</div>
</div>

<!-- Foundations tier -->
<div id="foundations" data-connect-to="core-ai-node">
<div class="foundation-item" data-id="foundation-tizi">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-foundation"></use></svg>æ‡‰è©¦</div>
<div class="sub-group-title">AIæ“¬é¡Œ</div>
<div class="node level-2"><a href="https://kenchan20141.github.io/generator/" data-tool-id="tizi">é¡Œå­³<br></a></div>
</div>
<div class="foundation-item" data-id="foundation-explore">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-explore"></use></svg>èª²å¤–æ¢ç´¢</div>
<div class="node level-2"><a href="https://kenchan20141.github.io/reading/" data-tool-id="reading-pieces">æ–‡å­¸ãƒ»ç‰‡æ®µ</a></div>
<div class="node level-2"><a href="https://kenchan20141.github.io/mensyu/" data-tool-id="mensyu">æ–‡æ¨</a></div>
<div class="node level-2"><a href="https://kenchan20141.github.io/wabisabi/" data-tool-id="wabisabi">ä¸€ç¬ä¹‹è©©</a></div>
<div class="node level-2"><a href="https://621d05f47d591.site123.me/%E6%9B%B8%E9%96%A3%E8%97%8F%E6%9B%B8%E6%A6%82%E8%A6%BD" data-tool-id="book-overview">æ›¸ç±æ¦‚è¦½</a></div>
</div>
</div>

<!-- 2. Writing -->
<div class="category" id="writing" data-connect-to="foundation-tizi">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-write"></use></svg>å¯«ä½œå‰µä½œ</div>
<div class="sub-group">
<div class="sub-group-title">AIç¯„æ–‡</div>
<div class="node level-2"><a href="https://kenchan20141.github.io/article/" data-tool-id="fanshui-narrative">ç¿»æ°´ (æ•˜äº‹)</a></div>
<div class="node level-2"><a href="https://kenchan20141.github.io/essay/" data-tool-id="fanshui-argument">ç¿»æ°´ (è­°è«–)</a></div>
</div>
<div class="sub-group">
<div class="sub-group-title">è‰æ“¬</div>
<div class="node level-2"><a href="https://kenchan20141.github.io/manuscriptpaper/" data-tool-id="manuscript">æ™ºèƒ½åŸç¨¿ç´™</a></div>
</div>
<div class="sub-group">
<div class="sub-group-title">æ½¤è‰²èˆ‡å»¶ä¼¸</div>
<div class="node level-2"><a href="https://kenchan20141.github.io/words/" data-tool-id="words">å­—æ–Ÿãƒ»å¥é…Œ</a></div>
<div class="node level-2"><a href="https://kenchan20141.github.io/slideshow/" data-tool-id="slideshow">æ–‡ç« å¹»ç‡ˆç‰‡</a></div>
</div>
</div>

<!-- 3. Reading -->
<div class="category" id="reading" data-connect-to="foundation-tizi">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-read"></use></svg>é–±è®€æº«ç¿’</div>
<div class="sub-group">
<div class="sub-group-title">èª²æ–‡æº«ç¿’</div>
<div class="node level-2" id="yuyilu-toggle"><a href="#">èªå¼ˆéŒ„ </a></div>


<div class="yuyilu-grades collapsed" id="yuyilu-grades">
<div class="node level-3"><a href="https://kenchan20141.github.io/f1chinese/" data-tool-id="yuyilu-f1">ä¸­ä¸€</a> | <a href="https://kenchan20141.github.io/chinese2/" data-tool-id="yuyilu-f2">ä¸­äºŒ</a> | <a href="https://kenchan20141.github.io/chinese3/" data-tool-id="yuyilu-f3">ä¸­ä¸‰</a></div>
<div class="node level-3"><a href="https://kenchan20141.github.io/f4chinese/" data-tool-id="yuyilu-f4">ä¸­å››</a> | <a href="https://kenchan20141.github.io/chinese/" data-tool-id="yuyilu-f5">ä¸­äº”</a> | <a href="https://kenchan20141.github.io/chinese6/" data-tool-id="yuyilu-f6">ä¸­å…­</a></div>
</div>
<div class="node level-2"><a href="https://kenchan20141.github.io/timer/" data-tool-id="timer">èƒŒæ›¸ç¥å™¨</a></div>
</div>
<div class="sub-group">
<div class="sub-group-title">æ–‡è¨€æ–‡</div>
<div class="node level-2"><a href="https://kenchan20141.github.io/mensyu/" data-tool-id="mensyu-2">æ–‡æ¨</a></div>
</div>
</div>

<!-- 4. Assignments -->
<div class="category" id="assignments" data-connect-to="core-ai-node">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-work"></use></svg>å·¥å…·</div>
<div class="sub-group">
<div class="sub-group-title">èª²æ¥­æµç¨‹</div>
<div class="node level-2"><a href="https://script.google.com/a/macros/ccckyc.edu.hk/s/AKfycby1T18HxuFICIaR0LYWRuaqlpmglkL191bVl39MH69zj5CQ-uhozF17edtJ_T54NhZ5/exec" data-tool-id="zhiyun">å¸™é›²</a></div>
</div>
<div class="sub-group">
<div class="sub-group-title">å¯¦ç”¨å·¥å…·</div>
<div class="node level-2"><a href="https://kenchan20141.github.io/WCT/" data-tool-id="zhuoyu">ç¢ç‰</a></div>
<div class="node level-2"><a href="https://kenchan20141.github.io/quizbuzzer/" data-tool-id="quizbuzzer">æ¶ç­”å™¨</a></div>
<div class="node level-2"><a href="https://www.i2ocr.com/free-online-image-ocr" data-tool-id="ocr">æ‰‹å¯«æ–‡å­—è½‰æ› (OCR)</a></div>
<div class="node level-2"><a href="https://kenchan20141.github.io/epub/" data-tool-id="epub">é›»å­æ›¸é–±è®€å™¨</a></div>
</div>
</div>

<!-- 5. Support -->
<div class="category" id="support" data-connect-to="core-ai-node">
<div class="category-title"><svg class="icon"><use xlink:href="#icon-support"></use></svg>å­¸ç¿’æ”¯æ´</div>
<div class="sub-group">
<div class="sub-group-title">AIèŠå¤©å®¤</div>
<div class="node level-2"><a href="https://kenchan20141.github.io/chitutor/" data-tool-id="chitutor">å–»è›‹æ•™å®¤</a></div>
<div class="node level-2"><a href="https://kenchan20141.github.io/histutor/" data-tool-id="histutor">å²èŠå§†æ•™å®¤</a></div>
<div class="node level-2"><a href="https://kenchan20141.github.io/counseling/" data-tool-id="counseling">è§£æ†‚é›œè²¨åº—</a></div>
</div>
<div class="sub-group">
<div class="sub-group-title">è³‡æºåº«</div>
<div class="node level-2"><a href="https://621d05f47d591.site123.me/" data-tool-id="self-learning">è‡ªå­¸è³‡æº</a></div>
</div>
</div>
</main>
</div>
</div>

<!-- Preview Modal (ä¿®è¨‚å¾Œ) -->
<div id="previewModal" class="preview-modal-overlay">
<div class="preview-modal-content">
<div class="preview-modal-body">
<iframe id="previewIframe" src="" frameborder="0"></iframe>
<div class="preview-modal-footer">
<div id="previewDescription" class="preview-description"></div>
<a id="previewGoToPageBtn" href="" target="_blank" class="preview-goto-btn">å‰å¾€</a>
</div>
</div>
<button id="previewCloseBtn" class="preview-close-btn" title="é—œé–‰">&times;</button>
</div>
</div>


<!-- Video Modal (æ–°å¢) -->
<div id="videoModal" class="video-modal-overlay">
<div class="video-modal-content">
<iframe id="videoIframe" allow="fullscreen" allowfullscreen src="" width="100%" style="border:none;"></iframe>
</div>
</div>

<script>

// ã€æ ¸å¿ƒä¿®è¨‚ã€‘å»ºç«‹ä¸€å€‹æ¸…é™¤æ‰€æœ‰é¡Œç›®ç‹€æ…‹çš„å°ˆç”¨å‡½å¼
function clearAllTopicStates() {
    // 1. æ¸…é™¤æ‰€æœ‰é¡Œç›®é¡¯ç¤ºå€å¡Šçš„å…§å®¹ä¸¦éš±è—å®ƒå€‘
    document.getElementById('topicResult').innerHTML = '';
    document.getElementById('topicResult').style.display = 'none';
    document.getElementById('argumentTopicResult').innerHTML = '';
    document.getElementById('argumentTopicResult').style.display = 'none';
    document.getElementById('expandTopicResult').innerHTML = '';
    document.getElementById('expandTopicResult').style.display = 'none';

    // 2. æ¸…é™¤æ‰€æœ‰å„²å­˜åœ¨ localStorage çš„é¡Œç›®ç›¸é—œè³‡æ–™
    // ã€Œæ•˜äº‹æŠ’æƒ…ã€ç›¸é—œ
    localStorage.removeItem("currentTopic");
    localStorage.removeItem("currentFocus");
    localStorage.removeItem("currentPlot");
    localStorage.removeItem("lastTopic");

    // ã€Œè­°è«–ã€ç›¸é—œ
    localStorage.removeItem("argumentCurrentTopic");
    localStorage.removeItem("lastArgumentTopic");

    // ã€Œæ•´åˆæ‹“å±•ã€ç›¸é—œ
    localStorage.removeItem("expandCurrentTitle");
    localStorage.removeItem("expandCurrentTheme");
    localStorage.removeItem("expandCurrentData");

    // 3. æ¸…é™¤è‡ªè¨‚é¡Œç›®çš„è¼¸å…¥å€
    const customTopicArea = document.getElementById("customTopicArea");
    if (customTopicArea) {
        customTopicArea.innerHTML = '';
        customTopicArea.style.display = 'none';
    }
    const argumentCustomTopicArea = document.getElementById("argumentCustomTopicArea");
    if (argumentCustomTopicArea) {
        argumentCustomTopicArea.innerHTML = '';
        argumentCustomTopicArea.style.display = 'none';
    }
}



/**
 * æ›´æ–°æŒ‰éˆ•çš„ í™œì„±í™” (active) ç‹€æ…‹ã€‚
 * @param {HTMLElement} clickedButton - è¢«é»æ“Šçš„æŒ‰éˆ•å…ƒç´ ã€‚
 */
function updateButtonActiveState(clickedButton) {
    // æ‰¾åˆ°æŒ‰éˆ•æ‰€åœ¨çš„å®¹å™¨
    const container = clickedButton.closest('.topic-buttons-container');
    if (!container) return;

    // ç²å–å®¹å™¨å…§çš„æ‰€æœ‰æŒ‰éˆ•
    const buttons = container.querySelectorAll('.btn');

    // é¦–å…ˆï¼Œç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ 'active' class
    buttons.forEach(button => {
        button.classList.remove('active');
    });

    // ç„¶å¾Œï¼Œåªç‚ºè¢«é»æ“Šçš„æŒ‰éˆ•æ·»åŠ  'active' class
    clickedButton.classList.add('active');
}



// API é…ç½®ä¿¡æ¯
const API_KEYS = [
"sk-N2hJEV5h9dQl9K_bUrxLtw"
];
let currentApiKeyIndex = 0;
const API_URL = "https://chatapi.akash.network/api/v1/chat/completions";
const MODEL = "Qwen3-235B-A22B-Instruct-2507-FP8";

// [æ–°å¢] é–±è®€å°ˆç”¨ API é…ç½®
const READING_API_KEYS = [
    "sk-N2hJEV5h9dQl9K_bUrxLtw"
];
let currentReadingApiKeyIndex = 0;
const READING_API_URL = "https://chatapi.akash.network/api/v1/chat/completions";
const READING_MODEL = "DeepSeek-R1-0528";


// [æ–°å¢] é–±è®€å°ˆç”¨ API å‘¼å«å‡½å¼
async function callReadingAPI(prompt) {
    let attempts = 0;
    const maxAttempts = READING_API_KEYS.length;
    while (attempts < maxAttempts) {
        try {
            const response = await fetch(READING_API_URL, {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${READING_API_KEYS[currentReadingApiKeyIndex]}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    model: READING_MODEL,
                    messages: [{
                        role: "user",
                        content: prompt + " ä½ å¿…é ˆç›´æ¥æä¾›æœ€çµ‚ç­”æ¡ˆï¼Œåš´ç¦å±•ç¤ºä»»ä½•æ€è€ƒéç¨‹ï¼Œçµ•å°ä¸èƒ½åœ¨å›æ‡‰ä¸­åŒ…å«ä»»ä½•æ¨™ç±¤ï¼ˆå¦‚ <think></think>ï¼‰ï¼Œé€™æ˜¯å¼·åˆ¶è¦æ±‚ï¼Œé•åå‰‡ç„¡æ•ˆã€‚"
                    }],
                    max_tokens: 64000
                })
            });

            if (response.status === 429) {
                currentReadingApiKeyIndex = (currentReadingApiKeyIndex + 1) % READING_API_KEYS.length;
                attempts++;
                continue;
            }

            if (!response.ok) {
                throw new Error(`API èª¿ç”¨å¤±æ•—: ${response.statusText}`);
            }

            const data = await response.json();
            let content = data.choices[0].message.content.trim();
            content = content.replace(/<think\s*>.*?<\/think\s*>|<think\s*\/>|<think\s*>|<\/think\s*>/gis, '').trim();

            if (!content) {
                throw new Error("API å›æ‡‰ç„¡æ•ˆæˆ–éæ¿¾å¾Œç„¡å…§å®¹");
            }

            return content;
        } catch (error) {
            console.error(error);
            currentReadingApiKeyIndex = (currentReadingApiKeyIndex + 1) % READING_API_KEYS.length;
            attempts++;
            if (attempts >= maxAttempts) {
                throw new Error("æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨");
            }
        }
    }
}




const audio = document.getElementById('audio');
const playPauseBtn = document.getElementById('play-pause');
const musicSelect = document.getElementById('music-select');
const progressBarMusic = document.getElementById('progress-bar-music');
const playMode = document.getElementById('play-mode');
const hidePlayerBtn = document.getElementById('hide-player');
const showPlayerBtn = document.getElementById('show-player');
const musicPlayer = document.getElementById('music-player');

let isPlaying = false;
let currentMusic = '';

musicSelect.addEventListener('change', function() {
const selectedMusic = this.value;
if (selectedMusic) {
audio.src = selectedMusic;
audio.load();
currentMusic = selectedMusic;
audio.play().then(() => {
isPlaying = true;
playPauseBtn.textContent = 'â¸ï¸';
}).catch(error => console.error('è‡ªå‹•æ’­æ”¾å¤±æ•—:', error));
}
});

audio.addEventListener('canplay', function() {
if (isPlaying) audio.play();
});

playPauseBtn.addEventListener('click', function() {
if (isPlaying) {
audio.pause();
playPauseBtn.textContent = 'â–¶ï¸';
} else {
if (currentMusic) {
audio.play();
playPauseBtn.textContent = 'â¸ï¸';
} else {
alert('è«‹å…ˆé¸æ“‡éŸ³æ¨‚');
}
}
isPlaying = !isPlaying;
});

audio.addEventListener('timeupdate', function() {
if (!audio.duration) return;
const progress = (audio.currentTime / audio.duration) * 100;
progressBarMusic.value = progress;
});

progressBarMusic.addEventListener('input', function() {
const time = (this.value / 100) * audio.duration;
audio.currentTime = time;
});

audio.addEventListener('ended', function() {
if (playMode.value === 'loop') {
audio.currentTime = 0;
audio.play();
} else if (playMode.value === 'next') {
const options = musicSelect.options;
for (let i = 0; i < options.length; i++) {
if (options[i].value === currentMusic) {
let nextIndex = (i + 1) % options.length;
if (nextIndex === 0) nextIndex = 1;
currentMusic = options[nextIndex].value;
musicSelect.value = currentMusic;
audio.src = currentMusic;
audio.load();
audio.play();
break;
}
}
}
});

hidePlayerBtn.addEventListener('click', function() {
musicPlayer.style.display = 'none';
showPlayerBtn.style.display = 'block';
});

showPlayerBtn.addEventListener('click', function() {
musicPlayer.style.display = 'flex';
showPlayerBtn.style.display = 'none';
});

// é è¨­å¯«ä½œé¡Œç›®åˆ—è¡¨
const topics = [
"æ—è§€", "èˆå°", "é€™ä»¶ç‰©ä»¶å¾ˆæ˜¯è¼•å·§ï¼Œå»è®“æˆ‘æ˜ç™½ã€ä½†æ±‚ç„¡æ„§æ–¼å¿ƒã€çš„é“ç†ã€‚", "å±±é ‚", "ç¨®å­", "æ ¹", "ç–¤ç—•",
"ä»Šå¤©ï¼Œæˆ‘ä¸èƒ½åƒè³½ï¼Œåªèƒ½ååœ¨è§€çœ¾å¸­ä¸Šï¼Œä½†ç•¶æ™‚çš„æ‰€è¦‹æ‰€èå»çµ¦äºˆæˆ‘å¶„æ–°çš„é«”æœƒã€‚", "å¾ä»Šä»¥å¾Œï¼Œæˆ‘ä¸æœƒå†è¼•è¨€æ”¾æ£„ã€‚",
"ç­‰å€™", "æˆ‘æ›¾ç¶“åŠªåŠ›å˜—è©¦ï¼Œä½†æœ€çµ‚ä»æ˜¯äº‹èˆ‡é¡˜é•", "å›æ†¶", "å¾¹å¤œé›£çœ ", "å½©è™¹",
"æ˜Ÿç©ºä¸‹ï¼Œçœ¼å‰çš„æ™¯è±¡è®“æˆ‘æƒ³èµ·é‚£æ®µå¾€äº‹ï¼Œä»¤æˆ‘ä¸ç¦æ­äº†ä¸€å£æ°£â€¦â€¦", "è·¯ç‰Œ", "ä»Šå­¸å¹´æœ€å¾Œæ‚”çš„ä¸€ä»¶äº‹",
"æœ€ä»¤æˆ‘æ„Ÿå‹•çš„ä¸€å¥è©±", "å†è©¦ä¸€æ¬¡", "ä»Šå¤©å†æ¬¡åœ¨å°ä¸Šæ¼”å¥ï¼Œæˆ‘å·²ç¶“è„«èƒæ›éª¨ï¼Œä¸å†æ˜¯å¾å‰é‚£å€‹é©•å‚²è‡ªæ»¿çš„æˆ‘äº†ã€‚",
"æ¯æ¬¡ç¶“éé€™æ¢è¡—ï¼Œçœ‹ç€è¡—ä¸Šçš„æ™¯ç‰©ï¼Œæˆ‘ä¾¿æ„Ÿè§¸ä¸å·²â€¦â€¦", "æ„å¤–", "é‘°åŒ™", "éŒ¯éäº†çš„æ©Ÿæœƒ",
"é‚£å¥è©±ï¼Œæˆ‘å¯¦åœ¨ä¸è©²èªªâ€¦â€¦", "è‰²å½©", "ç…™ç«", "è—¥", "æ”¾ä¸‹", "è¿½é€", "åŸä¾†ï¼Œé€™åªæ˜¯ä¸€å ´èª¤æœƒ",
"ç¼ºæ†¾", "ç„¡æ‚”çš„æŠ‰æ“‡", "å‹‡æ°£", "å‚˜", "è‡ªæ­¤ä¹‹å¾Œï¼Œæˆ‘æ˜ç™½åˆ°åŸä¾†çˆ¶æ¯çš„æ„›ç¸½æ˜¯é«”ç¾åœ¨å°äº‹ä¸Šã€‚",
"ä¸€ä»¶ä»¤æˆ‘å¾Œæ‚”ä¸å·²çš„äº‹", "ä¸€æ¬¡å°·å°¬çš„ç¶“æ­·", "æ²¿é€”æœ‰ä½ ", "é€™ä¸€æ¬¡ï¼Œæˆ‘å¯¦åœ¨æ„Ÿåˆ°ç„¡åœ°è‡ªå®¹ã€‚",
"é€™ä¸€æ¬¡ï¼Œæˆ‘æ˜ç™½åˆ°ï¼ŒåŸä¾†å¹«åŠ©ä»–äººçš„åŒæ™‚ï¼Œä¹Ÿå¹«åŠ©äº†è‡ªå·±ã€‚",
"æˆ‘çš„é„°å±…å¼µå…ˆç”Ÿæ˜¯ä¸€ä½å¾ˆè‹›åˆ»çš„äººï¼Œç¶“å¸¸æœƒç‚ºäº›ã€å°äº‹ã€è€ŒæŠ•è¨´ä»–äººã€‚ä½†ä»Šå¤©æˆ‘ç™¼ç¾ï¼Œä»–é€™æ¨£åšæ˜¯æœ‰åŸå› çš„â€¦â€¦",
"ç¨è™•çš„ä¸€å¤©", "é€™ä¸€åˆ»ï¼Œæˆ‘çµ‚æ–¼èˆ’äº†ä¸€å£æ°£ã€‚", "è¨˜ä¸€æ¬¡è¢«èª¤è§£çš„ç¶“æ­·", "ä¸€æ¬¡èˆ‡åˆ¥äººè¨€æ­¸äºå¥½çš„ç¶“æ­·",
"è‡ªæ­¤ä¹‹å¾Œï¼Œæˆ‘æ„Ÿåˆ°è‡ªå·±çœŸçš„é•·å¤§äº†ã€‚", "è‡ªæ­¤ä¹‹å¾Œï¼Œæˆ‘æ˜ç™½åˆ°å¹¸ç¦åŸä¾†å¯ä»¥å¾ˆç°¡å–®ã€‚", "è¨˜ä¸€æ¬¡è‹¦ç›¡ç”˜ä¾†çš„ç¶“æ­·ã€‚",
"é€™ä»¶äº‹è®“æˆ‘é«”æœƒåˆ°å–œå‡ºæœ›å¤–çš„æ»‹å‘³ã€‚", "è·¯æ¨™", "è¶³å°", "éºæ†¾", "é–", "é¢å…·", "å¿ƒçµ", "é–€",
"å½±å­", "ç¦å€", "ç­‰å¾…", "æ ¹", "æœ€å¾Œï¼Œæˆ‘é¸æ“‡äº†æ”¾æ£„", "è‡ªé‚£ä¸€åˆ»ï¼Œæˆ‘è§£é–‹äº†å¿ƒçµ",
"è‡ªæ­¤ä¹‹å¾Œï¼Œæˆ‘æ˜ç™½çŒ¶è±«æœƒä½¿äººä¸€äº‹ç„¡æˆã€‚", "åŸä¾†æˆ‘æ²’æœ‰å¿˜è¨˜é‚£ä¸€é “é£¯ã€‚", "æˆ‘åœ¨å¤§è‡ªç„¶ä¹‹ä¸­æ‰¾åˆ°å¿«æ¨‚ã€‚",
"ç†±é¬§éå¾Œï¼Œæˆ‘å»æ„Ÿåˆ°å¤±è½ã€‚", "çœ‹è‘—é€æ¼¸é å»çš„èƒŒå½±ï¼Œæˆ‘æ„Ÿåˆ°å¾ˆå…§ç–šã€‚", "ä»Šå¤©æˆ‘æµæ·šäº†ï¼Œä½†æˆ‘ä¸¦éæ„Ÿåˆ°é›£éã€‚",
"è‡ªæ­¤ä¹‹å¾Œï¼Œæˆ‘æ‰¾åˆ°äº†å‹•åŠ›", "ç¶“æ­·äº†é€™æ¬¡é¢¨æ³¢ï¼Œæˆ‘é•·å¤§äº†ã€‚",
"ç¶“éé€™ä»¶äº‹ï¼Œæˆ‘æ‰æ˜ç™½åˆ°ä¸€å¿ƒæ˜¯æˆ‘çš„çŸ¥å·±ï¼Œæ˜¯çœŸæ­£äº†è§£æˆ‘çš„äººã€‚", "è‡ªæ­¤ä¹‹å¾Œï¼Œæˆ‘å­¸æœƒæ”¾ä¸‹ç„¡è¬‚çš„é¢å­ã€‚",
"é€™ä¸€æ¬¡ï¼Œæˆ‘å†æ²’æœ‰éºæ†¾", "é‡éŠèˆŠåœ°æ‰€è¦‹æœ‰æ„Ÿ", "å¤±è€Œå¾©å¾—", "é€™æ¢è¡—é›–ç„¶è€èˆŠï¼Œä½†å»å……æ»¿äººæƒ…å‘³ã€‚",
"é€™å¥è©±ï¼Œæˆ‘æœƒè¨˜ä¸Šä¸€è¼©å­ã€‚", "é–€", "ä¾†æ—¥æ–¹é•·", "å¾—ä¸å„Ÿå¤±", "éš±è—", "å¾®ç¬‘ä»¥å°",
"ç†±é¬§éå¾Œï¼Œæˆ‘å»æ„Ÿåˆ°å¤±è½ã€‚", "å¤¢æƒ³çœ‹ä¼¼ä¸åˆ‡å¯¦éš›ï¼Œä½†å…¶å¯¦å¾ˆæœ‰æ„ç¾©", "å¤¢æƒ³çœ‹ä¼¼å¾ˆæœ‰æ„ç¾©ï¼Œå…¶å¯¦ hä¸åˆ‡å¯¦éš›",
"ä»Šå¤©æˆ‘æ²’æœ‰å¸¶æ‰‹æé›»è©±å¤–å‡ºï¼Œå› è€Œæœ‰ä¸ä¸€æ¨£çš„ç¶“æ­·å’Œé«”æœƒã€‚",
"ä»Šå¤©ç™¼ç”Ÿäº†ä¸€ä»¶äº‹æƒ…ï¼Œç•¶æ™‚æˆ‘æ›¾ç¶“æƒ³åŠ›é™³å·±è¦‹ï¼Œæœ€å¾Œé¸æ“‡äº†æ²‰é»˜ã€‚æˆ‘èªç‚ºæ²‰é»˜æ˜¯å¿…è¦çš„ã€‚",
"çŸ›ç›¾", "æœªå…Œç¾çš„è«¾è¨€", "æœªå¯„å‡ºçš„ä¿¡", "è·é›¢", "ä¸€å ´æ²’æœ‰å¤±æ•—è€…çš„æ¯”è³½", "ä¸€ä»¶ç™¼äººæ·±çœçš„äº‹",
"æˆ‘æœ€æƒ³ä¿ç•™çš„ä¸€æœ¬ç›¸ç°¿", "æˆ‘æœ€æƒ³å°‹å›çš„ä¸€ä»¶ç©å…·", "ç„¡æ„§çš„æŠ‰æ“‡", "ä¸èƒ½æ‰ä¸‹çš„çœ¼æ·š", "ç„¡ç•çš„æ¢ç´¢",
"ä¸€æ¬¡ä»¤æˆ‘ç™¾æ„Ÿäº¤é›†çš„èšé¤", "å¦‚é¡˜ä»¥å„Ÿ"
];

// é è¨­è­°è«–é¡Œç›®åˆ—è¡¨ï¼ˆè«‹åœ¨æ­¤è™•è¼¸å…¥æ‚¨çš„é¡Œåº«ï¼‰
const argumentTopics = [
'æ‰€è¬‚ã€Œå¤©è¡Œæœ‰å¸¸ï¼Œç«‹èº«æœ‰æœ¬ã€‚ã€æ„æ€æ˜¯å¤§è‡ªç„¶é‹è¡Œæœ‰æ—¢å®šçš„è¦å¾‹ï¼Œäººç«‹èº«è™•ä¸–æœ‰ä¸€å®šçš„åŸå‰‡ã€‚è©¦è«‡è«‡ä½ å°ã€Œç«‹èº«æœ‰æœ¬ã€çš„çœ‹æ³•ã€‚',
'æ—è§€',
'æœ‰äººèªç‚ºã€Œäººç”Ÿåœ¨ä¸–ï¼Œå¿…é ˆè¬›ç©¶å„€å¼ã€‚ã€ä½ åŒæ„å—ï¼Ÿè©¦æ’°æ–‡ä¸€ç¯‡ï¼Œè«–è¿°ä½ çš„çœ‹æ³•ã€‚',
'èˆå°',
'æ ¹',
'å¤äººèªªï¼šã€Œå›å­ä¸ä»¥äººå»¢è¨€ã€‚ã€æ„æ€æ˜¯ï¼šå›å­ä¸æœƒå› ç‚ºæŸäººçš„å¾·è¡Œä¸å¥½è€Œä¸æ¡ç´ä»–çš„å–„æ„è¦å‹¸ã€‚åœ¨ç¾ä»Šç¤¾æœƒï¼Œä½ æ˜¯å¦åŒæ„ã€Œå›å­ä¸ä»¥äººå»¢è¨€ã€ï¼Ÿè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'è¨ˆç®—',
'æœ‰äººèªªï¼šã€Œåœ¨ç¾ä»Šç¤¾æœƒä¸­ï¼Œæˆ‘å€‘é›£ä»¥æ´»å‡ºçœŸæˆ‘ã€‚ã€ä½ åŒæ„å—ã€‚è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'ä¿—èªèªªã€Œæœ‰ç«¶çˆ­æ‰æœ‰é€²æ­¥ã€ï¼Œä¹Ÿæœ‰äººèªªã€Œç«¶çˆ­ç„¡ç”¨ã€ã€‚è©¦å¯«ä½œæ–‡ç« ä¸€ç¯‡ï¼Œè«‡è«‡ä½ å°ã€Œç«¶çˆ­ç„¡ç”¨ã€çš„çœ‹æ³•ã€‚',
'å±±é ‚',
'ã€Œç¨®å­ã€é›–æ˜¯å¹³å¸¸äº‹ç‰©ï¼Œå»å¯ä»¥å¼•èµ·è¯æƒ³ï¼Œæˆ–ç‰½å‹•æ€ç·’ï¼Œåˆæˆ–å•Ÿç™¼æ€è€ƒã€‚è©¦ä»¥ã€Œç¨®å­ã€ç‚ºé¡Œï¼Œå°±å€‹äººé«”æœƒå¯«ä½œæ–‡ç« ä¸€ç¯‡ã€‚',
'æœ‰äººèªç‚ºã€ŒæŒ«æ•—æ›´æœ‰åˆ©å­©å­æˆé•·ã€‚ã€ä½ åŒæ„å—ï¼Ÿè©¦æ’°æ–‡ä¸€ç¯‡ï¼Œè«–è¿°ä½ çš„çœ‹æ³•ã€‚',
'ç–¤ç—•',
'è©¦ä»¥ã€Œè«‡ç©ç‰©å–ªå¿—ã€æˆ–ã€Œè«‡ç©ç‰©é¤Šå¿—ã€ç‚ºé¡Œï¼Œå¯«ä½œæ–‡ç« ä¸€ç¯‡ã€‚',
'æ³°ç„¶è™•ä¹‹',
'å¤èªæœ‰äº‘ã€Œå¤©ä¸‹çš†çŸ¥å–ä¹‹ç‚ºå–ï¼Œè€Œè«çŸ¥èˆ‡ä¹‹ç‚ºå–ã€‚ã€æ„æ€æ˜¯ä¸–äººéƒ½çŸ¥é“ç´¢å–å¯ä»¥ç²å¾—ï¼Œè€Œä¸çŸ¥é“çµ¦äºˆä¹Ÿå¯ä»¥ç²å¾—ã€‚è©¦è«‡è«‡ä½ å°é€™å¥è©±çš„çœ‹æ³•ã€‚',
'è«‡åš´è‹›',
'è«‡å¯¬å®¹',
'è«‡æ†¤æ€’',
'å¾…å€™',
'æœ‰äººèªç‚ºï¼šã€Œèˆ‡å…¶è¿½æ±‚æˆåŠŸï¼Œä¸å¦‚è¿½æ±‚å¹¸ç¦ã€‚ã€ä½ åŒæ„å—ï¼Ÿè©¦æ’°å¯«æ–‡ç« ä¸€ç¯‡ï¼Œè«–è¿°ä½ çš„çœ‹æ³•ã€‚',
'çŸ›ç›¾',
'æœ‰äººèªç‚ºï¼šã€Œä¿æŒè·é›¢èƒ½ä»¤é—œä¿‚é•·ä¹…ã€‚ã€ä½ åŒæ„å—ï¼Ÿè©¦æ’°æ–‡ä¸€ç¯‡ï¼Œè«–è¿°ä½ çš„çœ‹æ³•ã€‚',
'æœ‰äººèªªï¼šã€Œè¿‘æœ±è€…èµ¤ï¼Œè¿‘å¢¨è€…é»‘ã€‚ã€ä½ åŒæ„å—ï¼Ÿç‚ºç”šéº¼ï¼Ÿ',
'è©¦ä»¥ã€Œç•¶ç§‘æŠ€æ–‡æ˜æ¶ˆå¤±å¾Œã€ç‚ºé¡Œï¼Œå¯«ä¸€ç¯‡è©•è«–ï¼Œåæ€ç§‘æŠ€ç™¼å±•å¸¶ä¾†çš„å½±éŸ¿ã€‚',
'æˆåŠŸè·¯ä¸Šç„¡æ·å¾‘ï¼Œè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'å€‹äººé›»å­ç”¢å“çš„æ™®åŠåŒ–ï¼Œæœ‰äººèªç‚ºæ˜¯ç”Ÿæ´»çš„é€²æ­¥ï¼Œæœ‰äººèªç‚ºæ˜¯ç”Ÿæ´»çš„å€’é€€ã€‚ä½ è¼ƒèªåŒå“ªä¸€ç¨®è§€é»ï¼Ÿè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'æœ‰äººèªç‚ºå³ä½¿å¿ƒä¸­ä¸å¿«ï¼Œäº¦è¦ä»¥ç¬‘é¢å°äººï¼›æœ‰äººèªç‚ºæ‡‰ä»¥çœŸæ€§æƒ…å°äººï¼Œä¸æ‡‰æ©é£¾å¿ƒä¸­çš„æ„Ÿå—ï¼Œä½ è¼ƒè´ŠåŒå“ªä¸€æ–¹ï¼Ÿè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'é‘°åŒ™',
'è²§ä¹èˆ‡å¯Œè¶³',
'è«–æ„å¤–',
'è©¦è«‡è«‡ä½ å°ã€Œè½å¤©ç”±å‘½ã€é€™ç¨®è™•ä¸–æ…‹åº¦çš„çœ‹æ³•ã€‚',
'ã€Œå¤©è³œé£Ÿæ–¼é³¥ï¼Œå»ä¸æŠ•é£Ÿæ–¼å·¢ã€‚ã€ä¸Šå¤©è³œäºˆé³¥é¡è¦“é£Ÿçš„æœ¬èƒ½ï¼Œè€Œä¸æŠŠé£Ÿç‰©æŠ•åˆ°é³¥å·¢ã€‚æ„æ€æ˜¯äººéœ€è¦é€šéåŠªåŠ›ï¼Œæ‰èƒ½æœ‰æ‰€å¾—ã€‚ä½ èªåŒå—?è©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'è‰²å½©',
'è«‡è—è¡“çš„åƒ¹å€¼',
'è—¥',
'æœ‰äººèªªï¼šã€Œæ¯æ¬¡ä»˜å‡ºæ‡‰è©²å…ˆè¨ˆç®—å›å ±ã€‚ã€ä½ åŒæ„é€™ç¨®è™•äº‹æ…‹åº¦å—ï¼Ÿ',
'è«–å…¬å¾·å¿ƒçš„é‡è¦æ€§',
'æœ‰äººèªç‚ºä¸­å­¸ç”Ÿæ‡‰å¤šåƒèˆ‡èª²å¤–æ´»å‹•ï¼Œç™¼å±•èˆˆè¶£ï¼›æœ‰äººå‰‡èªç‚ºæ‡‰å°ˆæ³¨å­¸æ¥­ï¼Œçˆ­å–å¥½æˆç¸¾ã€‚ä½ è¼ƒèªåŒå“ªç¨®èªªæ³•ï¼Ÿè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'ä½ åŒæ„ã€Œå“å¾·æ¯”å­¸å•æ›´é‡è¦ã€å—ï¼Ÿè©¦å¯«ä¸€ç¯‡è­°è«–æ–‡ï¼Œè«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'è«‡ç«¶çˆ­',
'è«‡ç¼ºæ†¾',
'è«‡å¾—å¤±',
'è«‡å‹‡æ°£',
'å¾—ä¸å„Ÿå¤±',
'çˆºçˆºï¼šã€Œæˆ‘ç•¶é˜éŒ¶åŒ è¶…é50å¹´ï¼Œç•¢ç”Ÿå°ˆæ³¨é€™é–€æ‰‹è—ï¼Œèƒ½åšåˆ°åˆ†æ¯«ä¸å·®ã€‚ã€å…è¡Œï¼šã€Œæˆ‘æ˜¯å“å‘³ç”Ÿæ´»çš„å’–å•¡å¸«ï¼Œäº¦æ˜¯æ›¸å¯«äººç”Ÿçš„ä½œå®¶ï¼Œæ›´æ˜¯åŸ¹è‚²å¾Œé€²çš„æ­¦è¡“æ•™ç·´ã€‚ã€å„äººå°äººç”Ÿæœ‰ä¸åŒè¿½æ±‚ã€‚æœ‰äººèªç‚ºï¼šã€Œèˆ‡å…¶ä¸€ç”Ÿå°ˆç²¾ä¸€äº‹ï¼Œä¸å¦‚ç™¼å±•å¤šå…ƒäººç”Ÿã€‚ã€ä½ åŒæ„å—ï¼Ÿè©¦æ’°æ–‡ä¸€ç¯‡ï¼Œè«–è¿°ä½ çš„çœ‹æ³•ã€‚',
'å¾®ç¬‘ä»¥å°',
'æœ‰äººèªç‚ºã€Œå‚³çµ±å¾€å¾€æ˜¯å‰µæ–°çš„åŒ…è¢±ã€ã€‚è©¦è«‡è«‡ä½ å°é€™å¥è©±çš„çœ‹æ³•ã€‚',
'è¶³å°',
'å¤äººèªªï¼šã€Œç¨å­¸è€Œç„¡å‹ï¼Œå‰‡å­¤é™‹è€Œå¯¡èã€‚ã€æ„æ€æ˜¯ç¨è‡ªå­¸ç¿’ï¼Œæ²’æœ‰æœ‹å‹äº’ç›¸åˆ‡ç£‹è§£é›£ï¼Œäººä¾¿æœƒæ·ºé™‹è€Œè¦‹è­˜ä¸å»£ã€‚åœ¨ç¾ä»Šçš„å­¸ç¿’ç”Ÿæ´»ä¸­ï¼Œä½ æ˜¯å¦åŒæ„ã€Œç¨å­¸è€Œç„¡å‹ï¼Œå‰‡å­¤é™‹è€Œå¯¡èã€ï¼Ÿè©¦è©¦è«‡ä½ çš„çœ‹æ³•ã€‚',
'ã€Œä¸åšç¬¬ä¸€ï¼Œä¹Ÿä¸åšæœ€å¾Œã€‚ã€è©¦è«‡è«‡ä½ å°é€™ç¨®è™•ä¸–æ…‹åº¦çš„çœ‹æ³•ã€‚',
'è©¦ä»¥ã€Œé™½å…‰èˆ‡é™°å½±ã€ç‚ºé¡Œï¼Œå¯«ä½œä¸€ç¯‡æ–‡ç« ã€‚',
'ã€Œå­©å­ä¸æ˜¯ç­‰å¾…è¢«å¡«æ»¿çš„ç“¶å­ï¼Œè€Œæ˜¯ç›¼æœ›åŒ–ä½œç‡ƒç‡’çš„ç«ç„°ã€‚ã€è©¦å°±å€‹äººå°é€™å¥è©±çš„é«”æœƒ ï¼Œä»¥ã€Œæˆé•·ã€ç‚ºé¡Œï¼Œå¯«ä½œä¸€ç¯‡æ–‡ç« ã€‚',
'ã€Œä»Šæ—©åª½åª½æ‰“æƒçš„æ™‚å€™ï¼Œç„ä¸€ç„ç»ç’ƒçª—å¤–é„°å±…æ™¾æ›¬çš„è¡£æœï¼Œä¾¿æ‰¹è©•é“ï¼šã€çœ‹ï¼Œé‚£æ–°é„°å±…çœŸé¦¬è™ï¼è¡£æœé‚„æ˜¯æ±¡æ¼¬æ–‘æ–‘ï¼Œæ´—å¾—ä¸€é»ä¹Ÿä¸ä¹¾æ·¨ã€‚ã€å¥³å…’è½å¾Œï¼Œä¸€è¨€ä¸ç™¼ï¼Œèµ°åˆ°çª—å‰ä»”ç´°æ‰“é‡ï¼Œéš¨å³æŠ¹æ‰çª—ä¸Šçš„ç°å¡µï¼Œèªªé“ï¼šã€é€™ä¸å°±ä¹¾æ·¨äº†å—ï¼Ÿã€åª½åª½æç„¶å¤§æ‚Ÿï¼Œä¸ä¹¾æ·¨çš„ä¸æ˜¯åˆ¥äººçš„è¡£æœï¼Œè€Œæ˜¯è‡ªå·±çš„çª—å­ã€‚ã€è©¦å°±é€™å€‹æ•…äº‹å°ä½ çš„å•“ç™¼ï¼Œå¯«ä½œä¸€ç¯‡æ–‡ç« ï¼Œè«‡è«‡å¦‚ä½•æ¶ˆé™¤åè¦‹ã€‚',
'ã€Œä¸€å€‹å¯’å†·çš„å†¬å¤©ï¼Œå¹¾éš»åˆºèŸæ“ åœ¨ä¸€èµ·å–æš–ã€‚ç”±æ–¼ç‰ å€‘èº«ä¸Šé•·æ»¿äº†çŸ­åˆºï¼Œå½¼æ­¤æˆ³ç—›äº†å°æ–¹ï¼Œæ‰€ä»¥ä¸å¾—ä¸æ•£é–‹ã€‚å¯æ˜¯ï¼Œå¯’å†·çš„å¤©æ°£åˆé©…ä½¿ç‰ å€‘æ“ åœ¨ä¸€èµ·ï¼ŒåŒæ¨£çš„äº‹æƒ…é‡è¤‡ç™¼ç”Ÿï¼Œç‰ å€‘çµ‚æ–¼æ˜ç™½ï¼›ä¸è¦å¤ªè¿‘ï¼Œä¹Ÿä¸è¦å¤ªé ï¼Œæœ€å¥½å½¼æ­¤ä¿æŒä¸€å®šçš„è·é›¢ã€‚ã€é€™å€‹æ•…äº‹çš„é“ç†ä»ç„¶è²«ç©¿åœ¨æˆ‘å€‘çš„ç¾å¯¦ç”Ÿæ´»ä¸­ï¼Œè©¦å°±æ­¤å¯«ä¸€ç¯‡æ–‡ç« ã€‚',
'å€‹äººç§éš±æ¯”å…¬çœ¾çŸ¥æƒ…æ¬Šæ›´é‡è¦ï¼Œä½ åŒæ„å—ï¼Ÿè«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'é¦™æ¸¯æ˜¯ä¸€å€‹ç‰©è³ªç”Ÿæ´»ååˆ†å¯Œåº¶çš„åœ°æ–¹ï¼Œå¯æ˜¯åœ¨å¤šå€‹åœ‹éš›æ€§çš„èª¿æŸ¥ä¸­ï¼Œã€Œå¿«æ¨‚æŒ‡æ•¸ã€çš„æ’åä¸¦ä¸é«˜ã€‚æœ‰äººèªç‚ºå¯Œåº¶çš„ç‰©è³ªç”Ÿæ´»åä»¤äººé›£ä»¥å¿«æ¨‚ï¼›ä¹Ÿæœ‰äººèªç‚ºå¯Œåº¶çš„ç‰©è³ªç”Ÿæ´»æ˜¯å¿«æ¨‚çš„åŸºç¤ã€‚é€™å…©ç¨®çœ‹æ³•ï¼Œä½ æ¯”è¼ƒèªåŒå“ªä¸€ç¨®ï¼Ÿè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'é¢å°ä¸åŒæ„è¦‹ï¼Œæœ‰äººèªç‚ºæ‡‰æ“šç†åŠ›çˆ­ï¼Œå …å®ˆç«‹å ´ï¼›æœ‰äººèªç‚ºæ‡‰å½¼æ­¤åŒ…å®¹ï¼Œæ±‚åŒå­˜ç•°ã€‚ä¸Šè¿°å…©ç¨®æ…‹åº¦ï¼Œå“ªä¸€ç¨®è¼ƒç‚ºç†æƒ³ï¼Ÿè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'æœ‰äººèªç‚ºçˆ¶æ¯æ•™é¤Šå­å¥³ï¼Œæ‡‰è©²çµ¦äºˆç©ºé–“ï¼Œè®“å­å¥³è‡ªç”±ç™¼å±•ï¼›æœ‰äººèªç‚ºæ‡‰è©²çµ¦äºˆæ˜ç¢ºçš„æŒ‡å°ï¼Œè®“å­å¥³ä¾å¾ã€‚ä¸Šè¿°æ•™é¤Šå­å¥³çš„æ–¹æ³•ï¼Œå“ªä¸€ç¨®è¼ƒç‚ºç†æƒ³ï¼Ÿè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'æœ‰äººèªªï¼šã€Œèˆ‡å…¶è¿½éš¨æ½®æµï¼Œä¸å¦‚å±•ç¾å€‹äººé¢¨æ ¼ã€‚ã€ä½ å°é€™å¥è©±æœ‰ä»€éº¼çœ‹æ³•ï¼Ÿ',
'æœ‰äººèªªï¼šã€Œæ£’ä¸‹å‡ºå­å­ï¼Œåš´å¸«å‡ºé«˜å¾’ã€‚ã€ä¹Ÿæœ‰äººèªªï¼šã€Œçè³æ˜¯æ•™è‚²çš„æ©ç‰©ã€‚ã€ä½ å°é€™å…©ç¨®èªªæ³•æœ‰ä»€éº¼æ„è¦‹ï¼Ÿ',
'ç¾ä»Šç¤¾æœƒï¼Œè¨±å¤šäººèªç‚ºè²¡å¯Œèˆ‡ç¤¾æœƒåœ°ä½æˆæ­£æ¯”ï¼Œè²¡å¯Œæ„ˆå¤šï¼Œç¤¾æœƒåœ°ä½æ„ˆé«˜ã€‚ä½ çš„çœ‹æ³•å¦‚ä½•ï¼Ÿ',
'æœ‰äººèªç‚ºè®šè³æ˜¯æˆåŠŸçš„æœ€å¤§æ¨å‹•åŠ›ï¼Œä½ åŒæ„å—ï¼Ÿè©¦ä½œæ–‡ä¸€ç¯‡ï¼Œè«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'æœ‰äººèªªï¼šã€Œè±è£•çš„ç‰©è³ªç”Ÿæ´»å°±æ˜¯æœ€ç¾å¥½çš„ç”Ÿæ´»ã€‚ã€ä½ åŒæ„å—ï¼Ÿè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'ç²å–çŸ¥è­˜æ˜¯é€šå¾€æˆåŠŸçš„å”¯ä¸€é€”å¾‘ï¼Œä½ åŒæ„å—ï¼Ÿè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚',
'è«‡è«‡é’å¹´äººæ‡‰å¦‚ä½•å…‹æœå›°é›£',
'ã€Œå¾‹å·±ä»¥åš´ï¼Œå¾…äººä»¥å¯¬ã€‚ã€è«‡è«‡ä½ å°é€™è©±çš„çœ‹æ³•ã€‚',
'ã€ŒæˆåŠŸæ˜¯æ†å¿ƒçš„åŸºçŸ³ã€è«‡è«‡ä½ å°é€™è©±çš„çœ‹æ³•ã€‚',
'è«–ã€Œå®¶æœ‰ä¸€è€ï¼Œå¦‚æœ‰ä¸€å¯¶ã€',
'é€ç¦®ä¹‹æˆ‘è¦‹',
'é„‰æ‘ç™¼å±•ç‚ºå·¥æ¥­å€ï¼ŒåŸä¾†çš„å¤©ç„¶æ™¯ç‰©å—åˆ°ç ´å£ã€‚æœ‰äººèªªï¼šã€Œæœ‰ç ´å£æ‰æœ‰å»ºè¨­ã€‚ã€ä¹Ÿæœ‰äººèªªï¼šã€Œé€™ç¨®å»ºè¨­ç ´å£äº†äººå€‘ç”Ÿæ´»çš„æƒ…è¶£ã€‚ã€ä½ çš„çœ‹æ³•åˆæ€æ¨£ï¼Ÿè©¦èªªå‡ºä½ å€‹äººçš„æ„è¦‹ã€‚'
];

let lastTopic = localStorage.getItem("lastTopic") || "";
let lastArgumentTopic = localStorage.getItem("lastArgumentTopic") || "";

// ç¯„ç–‡å®šç¾©
const categories = {
"ç‰‡æ®µæå¯«": {
commentNote: "å¿…é ˆç”¨ç¹é«”å­—ã€‚é»è©•æ™‚ï¼Œå¿…é ˆå°±ä¸Šè¿°ç”Ÿæˆæˆ–è¼¸å…¥çš„é¡Œç›®ã€çµæ§‹æ®µé‡é»ã€æƒ…ç¯€å¤§è¦ï¼Œé»è©•å¤§ç¶±å…§å®¹æ˜¯å¦æ‰£é¡Œã€‚å¿…é ˆå¾ä»¥ä¸‹å…©å€‹è§’åº¦é»è©•ï¼šå…¶ä¸€ï¼Œé»è©•ã€Œçµæ§‹æ®µé‡é»èˆ‡é¡Œç›®æ˜¯å¦æœ‰é—œã€æœ‰å¤šå¤§é‚è¼¯é—œä¿‚ã€ï¼›å…¶äºŒï¼Œé»è©•ã€Œæƒ…ç¯€å¤§è¦æ˜¯å¦èƒ½çªé¡¯å‡ºçµæ§‹æ®µé‡é»ã€å¯«ä½œå…§å®¹çš„è©³ç•¥å‰ªè£æ˜¯å¦æ°ç•¶ï¼Œå³æ˜¯å¦æœ‰æ•ˆçªé¡¯çµæ§‹æ®µé‡é»ï¼ˆå‰ææ˜¯çµæ§‹æ®µé‡é»æ‰£é¡Œï¼Œå¦‚ä¸æ‰£é¡Œï¼Œæƒ…ç¯€å¤§è¦åŠå¯«ä½œå…§å®¹å°±è‚¯å®šä¸æ‰£é¡Œï¼‰ï¼Œé»è©•æ™‚è¦æ³¨æ„å¯«ä½œå…§å®¹ã€çµæ§‹æ®µé‡é»å…©è€…èˆ‡é¡Œç›®æœ‰æ²’æœ‰åœ¨é¡¯æ€§çš„é‚è¼¯é—œä¿‚ï¼Œå¯«ä½œå…§å®¹è¦æ±‚çš„ä¸åªæ˜¯å–ææƒ…ç¯€å¯ä»¥èˆ‡çµæ§‹æ®µé‡é»åŠé¡Œç›®æ§‹æˆé‚è¼¯é—œä¿‚ï¼Œæ›´è¦ç”¨åˆé©çš„æƒ…ç¯€è©³ç•¥å‰ªè£å’Œæ‰£é¡Œå°æ®µå»çªé¡¯èˆ‡è©²éƒ¨ä»½çš„é‚è¼¯é—œä¿‚ï¼Œä½¿å¯«ä½œå…§å®¹æ˜ç¢ºå‘¼æ‡‰çµæ§‹æ®µé‡é»åŠé¡Œç›®ã€‚ã€è‹¥é›¢é¡Œï¼Œç¯„ä¾‹ä¸å¿…æ ¹æ“šåŸæ–‡é›¢é¡Œå…§å®¹æ”¹å¯«ï¼Œè€Œæ”¹å¯«éƒ¨ä»½å¿…é ˆåŒ…å«æ‰£é¡Œå°æ®µï¼ˆéƒ¨ä»½å¥å­ç›´æ¥å‘¼æ‡‰çµæ§‹æ®µé‡é»æˆ–é¡Œç›®ï¼‰ã€‚é»è©•åˆ†ç‚ºä¸‰éƒ¨åˆ†ï¼š### é»è©•ã€### å»ºè­°ã€### æ”¹å¯«ç¯„ä¾‹ã€‚åªé¸å–æœ€é‡è¦çš„ä¸€è‡³å…©é»è©•è«–ï¼Œæ‡‰å…ˆèšç„¦åœ¨è©•è«–å¯«ä½œå…§å®¹æ˜¯å¦åœ¨æ‰£é€£é¡Œç›®åŠçµæ§‹æ®µé‡é»çš„æ–¹å‘ä»¥åŠå…¶è©³ç•¥å‰ªè£ï¼Œå…¶æ¬¡æ–¹ç‚ºæ–‡å¥ï¼ˆåŒ…æ‹¬ç¤ºç¾æ•˜äº‹å’Œå¯†åº¦ï¼‰ã€‚è‹¥çµæ§‹æ®µé‡é»æˆ–æƒ…ç¯€å¤§è¦èˆ‡é¡Œç›®é—œä¿‚è–„å¼±ï¼Œé ˆåœ¨é»è©•ä¸­æŒ‡å‡ºä¸¦é‡é»èªªæ˜ã€‚é»è©•å…§å®¹è¦ç²¾ç°¡ã€ä¸€èªä¸­çš„ï¼Œåƒ…å°‡æœ€é—œéµã€å½±éŸ¿æœ€å¤§çš„ä¸€è‡³å…©é …è©•èªé»å‡ºä¾†ï¼Œè‹¥æ‰£é¡Œå’Œè©³ç•¥å‰ªè£ç­‰éƒ½è™•ç†ä¸å¾—ç•¶ï¼Œå‰‡ä¸éœ€è¦è©³è©•æ–‡å¥ã€‚ç‰‡æ®µæå¯«éœ€äº¤æ›¿é‹ç”¨å°ç‰©ä»¶ã€å‹•ä½œã€å°è©±å’Œå…§å¿ƒç¨ç™½ï¼Œæé«˜æ–‡å¥å¯†åº¦ï¼ˆè©åŒ¯æ·±åº¦é«˜ã€ç‰©è±¡è±å¯Œã€å¯¦è©æ¯”ä¾‹é«˜ï¼‰ï¼Œä½†å¿…é ˆæ³¨æ„ï¼šé ï¼ˆä¾‹å¦‚é€£ç”¨å°ç‰©ä»¶åšä¸»èªçš„å¥å­ï¼‰å‰‡ä¸å®œï¼Œé©æ™‚éœ€è¦ä»¥äººç‰©ä½œä¸»èªï¼Œäº¤æ›¿å»ç”¨ï¼Œæœ‰æ™‚åŠ å…¥å…§å¿ƒç¨ç™½æœƒä»¤æ–‡å¥é¡¯å¾—æ›´è‡ªç„¶ï¼Œå¯†åº¦ä¸å®œéé«˜ï¼Œé©æ™‚è¦åŠ å…¥è™›è©æ”¾ç·©ç¯€å¥ï¼Œå¼µå¼›æœ‰åº¦ã€‚æ­¤å¤–ï¼Œè¦æ§åˆ¶è©³ç•¥ç¯€å¥ï¼Œè©³å¯«èˆ‡é¡Œç›®ç›¸é—œçš„éƒ¨åˆ†ï¼Œç•¥å¯«æ¬¡è¦å…§å®¹ã€‚æ–‡å¥å¯†åº¦ä¹Ÿæ˜¯å¥½æ–‡ç­†çš„æ¨™æº–ï¼Œéœ€ç´å…¥è€ƒé‡ã€‚é»è©•å’Œå»ºè­°ä¸æ‡‰ä½¿ç”¨åˆ—é»å½¢å¼ï¼Œæ‡‰ä»¥æ®µè½å‘ˆç¾ã€‚æ­¤å¤–ï¼Œå‡å¦‚æ•´é«”è¡¨ç¾çœŸçš„ä¸éŒ¯ï¼Œæ²’æœ‰å¤§å•é¡Œï¼Œåœ¨é»è©•æ™‚ç¨±è®šå³å¯ï¼Œä¸å¿…å¹æ¯›æ±‚ç–µåœ°æ‰¹è©•ï¼Œä½†åœ¨å¯«ä½œå…§å®¹çš„ã€Œæ‰£é¡Œã€é‚è¼¯ä¸Šå¿…é ˆåš´è¬¹æŠŠé—œã€‚é»è©•ã€å»ºè­°åŠæ”¹å¯«éƒ½è¦åœ¨200å­—ä»¥å…§ã€‚"
},
"å¤§ç¶±": {
commentNote: "å¿…é ˆç”¨ç¹é«”å­—ã€‚é»è©•æ™‚ï¼Œå¿…é ˆå°±ä¸Šè¿°ç”Ÿæˆçš„é¡Œç›®é»è©•å¤§ç¶±å…§å®¹æ˜¯å¦æ‰£é¡Œï¼Œå‡å¦‚å¤§ç¶±é›¢é¡Œï¼Œç¯„ä¾‹ä¾¿ä¸å¿…æ ¹æ“šé›¢é¡Œå…§å®¹æ”¹å¯«ã€‚æ­¤å¤–ï¼Œé»è©•æ‡‰åˆ†ç‚ºä¸‰å€‹éƒ¨ä»½ï¼šé»è©•ã€å»ºè­°ã€æ”¹å¯«ç¯„ä¾‹ã€‚åœ¨å¯«ä½œå¤§ç¶±æ™‚ï¼Œå­¸ç”Ÿæ‡‰å±•ç¤ºä»–å€‘çµ„ç¹”æ€è·¯å’Œçµæ§‹æ•…äº‹çš„èƒ½åŠ›ã€‚è©•åˆ†æ™‚ï¼Œè«‹æ³¨æ„å¤§ç¶±çš„é‚è¼¯æ€§ã€æ¢ç†æ€§ä»¥åŠæ˜¯å¦åŒ…å«äº†æ•…äº‹çš„èµ·æ‰¿è½‰åˆæˆ–ä¸‰ç·šçµæ§‹ï¼ˆå³æ‰€è¬‚ã€Œæ•£æ•˜ã€ï¼Œæœ‰ä»¥ä¸‹ä¸‰é»è¦æ³¨æ„ï¼šå…¶ä¸€ï¼Œä¸‰ç·šçš„åˆ†é¡ç¯„ç–‡ç›¸åŒï¼›å…¶äºŒï¼Œä¸‰ç·šæˆ–æœ‰å±¤éé—œä¿‚ï¼Œæˆ–èƒ½å¾ä¸‰å€‹è§’åº¦å‘ˆç¾åŒä¸€å€‹ä¸»é¡Œï¼›å…¶ä¸‰ï¼Œä¸‰ç·šçš„æƒ…ç¯€ç™¼å±•ä¸èƒ½éæ–¼ç›¸ä¼¼ï¼›å…¶å››ï¼Œæ‰€åˆ†ä¹‹è§’åº¦èƒ½çªé¡¯èˆ‡ä¸»é¡Œç›¸é—œçš„ç«‹æ„ã€‚ã€Œä¸‰ç·šã€ä¾‹å­å¦‚ä¸‹ï¼šé¡Œç›®ç‚ºã€Œå‹‡æ°£ã€ï¼Œå‰‡å¯ç”¨ã€Œå¹´å°‘æ™‚çš„å‹‡æ°£ã€ç‚ºä¸€ç·šã€ã€Œå¹´é’æ™‚çš„å‹‡æ°£ã€ç‚ºäºŒç·šã€ã€Œå¹´è€æ™‚çš„å‹‡æ°£ã€ç‚ºä¸‰ç·šï¼›åˆå¦‚ä»¥ã€Œé‡éŠèˆŠåœ°æ‰€è¦‹æœ‰æ„Ÿã€ï¼Œå‰‡å¯ç”¨åœ¨æ•…é„‰çš„ä¸åŒã€Œåœ°ã€æ‰€è¦‹ä½œä¸‰ç·šåˆ†é¡ï¼Œä¾‹å¦‚è€å±‹ã€å¾Œå±±ç­‰ã€‚å¿…é ˆç¢ºä¿æ¯æ¢ç·šçš„ã€Œçµæ§‹æ®µé‡é»ã€æ¸…æ™°é»æ˜ä¸‰ç·šçš„åˆ†é¡ç¯„ç–‡ã€æƒ³çªé¡¯é¡Œç›®çš„ç”šéº¼è¦é»ã€èˆ‡é¡Œç›®å¦‚ä½•æ‰£é€£ç­‰ï¼Œä»¥åŠã€Œåˆã€èƒ½çµ±æ”ç¸½çµå…¨æ–‡ç«‹æ„ï¼‰ã€‚è¦é€éƒ¨åˆ†åˆ†ææ¯å€‹çµæ§‹æ®µèˆ‡é¡Œç›®çš„é—œä¿‚æœ‰å¤šå¤§ï¼Œä¸¦åœ¨é»è©•ä¸­æ˜ç¢ºæŒ‡å‡ºã€‚æ­¤å¤–ï¼Œåœ¨ã€Œæ”¹å¯«å¾Œçš„å¤§ç¶±ã€,å…¶ã€Œçµæ§‹æ®µé‡é»ã€å¿…é ˆäº¤ä»£è©²éƒ¨ä»½èˆ‡é¡Œç›®ä¹‹é–“çš„é‚è¼¯é—œä¿‚ï¼Œå³æ€æ¨£åšåˆ°æ‰£é¡Œã€‚æ­¤å¤–ï¼Œç”±æ–¼æ˜¯æ‡‰è©¦æ–‡ç« ï¼Œå› æ­¤æ”¹å¯«å¾Œçš„å¤§ç¶±é¿å…éä»½å…·ç†è«–å“²å­¸æ€§åŠæ–‡å­¸æ€§ï¼Œä»¥è‡³æ–¼è„«é›¢äº†ç¾å¯¦å’Œæ—¥å¸¸ç”Ÿæ´»ï¼Œäº¦åœç¹äººåœ¨ç¶“æ­·çš„æƒ…æ„Ÿå’Œé«”æ‚Ÿè¨­å®šï¼Œå¿…é ˆæ¸›å°‘æ¦‚å¿µæ¨¡ç³Šçš„è¡“èªï¼Œä¾‹å¦‚ã€Œæƒ…æ„Ÿè¼‰é«”ã€åŠã€Œæ™‚ç©ºçš„å…±å‰µã€ï¼Œè«‹ç”¨æ—¥å¸¸åŒ–ç”¨èªæè¿°ã€‚æ­¤å¤–ï¼Œã€Œæ”¹å¯«å¾Œçš„å¤§ç¶±ã€ä¸å®œåªåœç¹ä¸€ä»¶äº‹æ•˜å¯«ï¼Œé€™æ¨£æœƒå®¹æ˜“å¯«å¾—å¤ªæŠ½è±¡ï¼Œæ‡‰é©æ™‚åŠ æ’äººç‰©èˆ‡äººç‰©ä¹‹é–“çš„å›æ†¶æˆ–å…¶ä»–ç¶“æ­·ï¼Œä»¤æ–‡ç« çœ‹èµ·ä¾†æ›´å…·é«”å¯¦åœ¨ã€‚æ­¤å¤–ï¼Œå¤§ç¶±ä¸æ˜¯å…¨ç¯‡æ–‡ç« ï¼Œæœ€é‡è¦çš„æ˜¯åœ¨é»è©•æ™‚åˆ†æå…¶çµæ§‹æ®µåŠæƒ…ç¯€å¤§è¦çš„æ€è·¯æ˜¯å¦æ‰£ç·Šé¡Œç›®ï¼Œæ–¹å‘æ˜¯å¦åˆç†ã€æ­£ç¢ºã€‚å‡å¦‚æ•´é«”è¡¨ç¾çœŸçš„ä¸éŒ¯ï¼Œæ²’æœ‰å¤§å•é¡Œï¼Œåœ¨é»è©•æ™‚ç¨±è®šå³å¯ï¼Œä¸å¿…å¹æ¯›æ±‚ç–µåœ°æ‰¹è©•ã€‚"
},
"æ•˜äº‹ç‰©è±¡": {
commentNote: "å¿…é ˆç”¨ç¹é«”å­—ã€‚åœ¨ã€Œæ•˜äº‹ç‰©è±¡ã€ä¸­ï¼Œå­¸ç”Ÿéœ€è¦é‹ç”¨è±å¯Œçš„ç‰©è±¡ä¾†å¢å¼·æ•…äº‹çš„ç”Ÿå‹•æ€§å’ŒçœŸå¯¦æ„Ÿã€‚ç‰©è±¡æ‡‰èˆ‡é¡Œç›®ã€å–æå’Œæ•…äº‹èƒŒæ™¯ç·Šå¯†ç›¸é—œï¼Œä¸¦ä¸”èƒ½å¤ æœ‰æ•ˆåœ°è¡¨é”äººç‰©çš„æƒ…æ„Ÿå’Œæ•…äº‹çš„ä¸»é¡Œã€‚è«‹ç¢ºä¿ç”Ÿæˆçš„ç‰©è±¡ä¸é‡è¤‡ï¼Œä¸¦ä¸”æ’ç‰ˆæ¸…æ™°æ˜“è®€ã€‚æ­¤å¤–ï¼Œæ¯å€‹ç‰©è±¡éƒ½å¿…é ˆç”±å…©å€‹å­—æ§‹æˆã€‚"
},
"é–±è®€": {
commentNote: "å¿…é ˆç”¨ç¹é«”å­—ã€‚é»è©•æ™‚ï¼Œéœ€è©•ä¼°ç­”é¡Œæ–¹å‘æ˜¯å¦åˆç†ã€æ–‡æœ¬ä¾æ“šæ˜¯å¦å……å¯¦å…·é«”ã€é—¡é‡‹æ¨è«–æ˜¯å¦åš´è¬¹ã€ä¸»é¡Œå¥æ˜¯å¦æ¸…æ™°ã€‚æ–‡æœ¬ä¾æ“šæ‡‰æ¦‚æ‹¬æ­¸ç´è€Œéç›´æ¥å¼•ç”¨åŸæ–‡ï¼Œé™¤éé¡Œç›®ä¸­æœ‰ã€æ‘˜éŒ„ã€å­—çœ¼ã€‚æ”¹å¯«ç¯„ä¾‹æ‡‰ä½¿ç­”æ¡ˆæ›´åœ“è¶³ï¼Œä½†è‹¥å­¸ç”Ÿç­”é¡Œæ–¹å‘éŒ¯èª¤ï¼Œå‰‡ä¸è·Ÿå¾éŒ¯èª¤æ–¹å‘æ”¹å¯«ã€‚é»è©•ä»¥æ®µè½å½¢å¼å‘ˆç¾ï¼Œä¸ä½¿ç”¨åˆ—é»ã€‚åœ¨ã€Œæ”¹å¯«ç¯„ä¾‹ã€å‰ï¼ŒåŠ å…¥ç­”é¡Œæ­¥é©ŸåŠæ€è·¯ï¼Œæè¿°å„éƒ¨åˆ†æ–¹å‘ï¼Œæ­¥é©Ÿå› é¡Œåˆ¶å®œï¼Œå¯èƒ½åŒ…æ‹¬ã€é‹ªå¢Šã€‘ã€ã€å›æ‡‰ã€‘ã€ã€æ–‡æœ¬ä¾æ“šã€‘ã€ã€é—¡é‡‹ã€‘ï¼Œéˆæ´»é‹ç”¨ã€‚æ¯å€‹æ­¥é©Ÿä»¥ã€æ­¥é©Ÿåã€‘æ¨™é¡ŒåŠ åˆ†è¡Œå…§å®¹å‘ˆç¾ï¼Œæ’ç‰ˆæ•´é½Šã€‚è¡¨æ ¼ä¸­åªåŒ…å«æ–‡å­—å’Œæ¨™é»ï¼Œä¸å«ã€---ã€ç­‰ç¬¦è™Ÿã€‚",
guideNote: "å¿…é ˆç”¨ç¹é«”å­—ã€‚è¼¸å‡ºåˆ†ç‚ºã€Œ### ç­”é¡ŒæŒ‡å¼•ã€å’Œã€Œ### ç­”é¡Œè©åŒ¯ã€å…©éƒ¨åˆ†ã€‚ã€Œç­”é¡ŒæŒ‡å¼•ã€è«‹ç”Ÿæˆä¸‰é“å•é¡Œï¼Œå¼•å°æ€è€ƒï¼Œæ¯å€‹å•é¡Œä½”ä¸€è¡Œã€‚ã€Œç­”é¡Œè©åŒ¯ã€è«‹ç”Ÿæˆåäº”å€‹ç”±å…©å€‹å­—æ§‹æˆçš„è©å½™ï¼Œæ¯å€‹è©å½™ä½”ä¸€è¡Œã€‚è«‹ç¢ºä¿æ‰€æœ‰å…§å®¹éƒ½ä»¥ç´”æ–‡å­—åˆ—è¡¨å‘ˆç¾ï¼Œä¸è¦ä½¿ç”¨ä»»ä½•Markdownè¡¨æ ¼èªæ³•ã€‚"
},
"èª²å¤–æ›¸ç±": {
chatNote: "å¿…é ˆç”¨ç¹é«”å­—ï¼Œå¤šç”¨EMOJIï¼Œå¶çˆ¾å¯ä»¥ç”¨ä¸€ä¸‹ç¶²çµ¡ç”¨èªã€‚",
seriousChatNote: "å¿…é ˆç”¨ç¹é«”å­—ï¼Œç”¨èªè²¼è¿‘æ—¥å¸¸ç”Ÿæ´»ï¼Œå›æ‡‰ä¸è¦ç†è«–åŒ–ï¼Œä¸è¦ç”¨ç¶²çµ¡ç”¨èªï¼Œä¹Ÿä¸è¦ç”¨EMOJIã€‚"
},
"æ•´åˆæ‹“å±•": {
topicPrompt: "è«‹ç”Ÿæˆä¸€é“é©åˆä¸­å­¸ç”Ÿç·´ç¿’æ•´åˆæ‹“å±•çš„é¡Œç›®ï¼Œé¡Œç›®æ‡‰åŒ…å«ä¸»é¡Œå¥ï¼ˆä¸»é¡Œå¥çµ•å°ä¸èƒ½æ˜¯å•å¥ï¼‰å’ŒæŠ„éŒ„è³‡æ–™ï¼ˆæŠ„éŒ„è³‡æ–™å¿…é ˆä¸åŒ…å«ä»»ä½•æ•¸æ“šï¼Œä¸»è¦åŒ…æ‹¬æ´»å‹•å…§å®¹åŠç´°ç¯€ï¼Œæ ¼å¼å¦‚ã€Œç¤¾å€æ¼«æ­¥ç”±å°è³å“¡å¸¶é ˜åƒåŠ è€…éŠè¦½ç¤¾å€ï¼Œå…±åŒèª¦è®€èˆ‡ç¤¾å€ç›¸é—œçš„æ–‡å­¸ä½œå“ï¼Œæ„Ÿå—ç¤¾å€é­…åŠ›ã€‚ã€ä¸å¾—åŒ…å«å¼•è™Ÿæˆ–äººç‰©å°è©±ï¼Œè€Œä¸”ä¸å¾—è¶…é30å­—ï¼‰ï¼Œä¸¦ç¬¦åˆä»¥ä¸‹æ–‡é¡å’Œå–æç¯„åœã€‚æ–‡é¡ï¼šæ›¸ä¿¡ã€è©•è«–ã€å»ºè­°æ›¸ã€æ¼”è¬›è¾­ã€å ±å‘Šã€å°ˆé¡Œæ–‡ç« ã€‚å–æç¯„åœï¼šä¾‹å¦‚ã€Œè«‹éš¨æ©Ÿé¸æ“‡ä¸€å€‹ä¸»é¡Œï¼Œä¸”è©²ä¸»é¡Œå¿…é ˆèˆ‡ä»¥ä¸‹åˆ—å‡ºçš„æ‰€æœ‰ä¸»é¡Œï¼ˆé‹å‹•ã€ç”Ÿæ¶¯è¦åŠƒã€è²¬ä»»ã€æ•™è‚²ã€æ–‡åŒ–ã€ç¤¾æœƒã€æ­·å²ã€åœ°ç†ã€è—è¡“ã€é«”è‚²ã€æ³•å¾‹ã€å¥åº·ã€å¿ƒç†ã€å®¶åº­ã€å‹èª¼ã€å°±æ¥­ã€ç¶“æ¿Ÿã€ç”Ÿæ…‹ã€èƒ½æºã€è³‡æºã€å®‰å…¨ã€ç¶²è·¯ã€åª’é«”ã€è³‡è¨Šã€é“å¾·ã€èª ä¿¡ã€å…¬å¹³ã€è‡ªç”±ã€æ¬Šåˆ©ã€ç¾©å‹™ã€éš±ç§ã€ç¦®å„€ã€æ¦œæ¨£ã€å‰µæ–°ã€å‰µæ¥­ã€æ¶ˆè²»ã€å„²è“„ã€æ°‘æ—ã€èªè¨€ã€å®—æ•™ã€å‚³çµ±ã€ç¾ä»£ã€åŸé„‰ã€ç¤¾å€ã€å…¬ç›Šã€æ…ˆå–„ã€ç½å®³ã€é†«ç™‚ã€ç–¾ç—…ã€é£²é£Ÿã€æ—…éŠã€å»ºç¯‰ã€å¨›æ¨‚ã€éŸ³æ¨‚ã€é›»å½±ã€æ–‡å­¸ã€äººå£ã€æ€§åˆ¥ã€å¹´é½¡ã€è·æ¥­ã€å­¸æ¥­ã€è€ƒè©¦ã€å‡å­¸ã€æ ¡åœ’ã€å¸«ç”Ÿã€åŒå­¸ã€èª²å¤–ã€ç¤¾åœ˜ã€ç«¶è³½ã€å¿—é¡˜ã€å£“åŠ›ã€è‡ªå¾‹ã€æ™‚é–“ã€èˆˆè¶£ã€ç¿’æ…£ã€éŠæˆ²ã€ç¡çœ ã€æ°£å€™ã€æ±™æŸ“ã€é–±è®€ã€ï¼Œä½†å‡ºé¡Œè«‹å¤šå…ƒåŒ–ä¸€é»ï¼Œäº¦ä¸è¦æ¯æ¬¡éƒ½æ˜¯èˆ‡å¥½è™•ç›¸é—œçš„ï¼Œå¦å‰‡ç”¨å®¶å¤šç”Ÿæˆå¹¾æ¬¡ï¼Œä¾¿æœƒé‡åˆ°é¡ä¼¼çš„é¡Œç›®ã€‚è¦æ±‚ï¼š1. ä¸»é¡Œå¥ç°¡æ½”ï¼Œ20å­—ä»¥å…§ã€‚2. æŠ„éŒ„è³‡æ–™ç‚ºä¸€æ®µæ–‡å­—ï¼Œä¸è¶…é100å­—ã€‚3. è¼¸å‡ºæ ¼å¼ç‚ºï¼šä¸»é¡Œå¥ï¼š...\næŠ„éŒ„è³‡æ–™ï¼š...\n4. å…§å®¹ç°¡æ½”æ˜äº†ï¼Œé¿å…å†—é•·ã€‚5. é¡Œç›®å¤šæ¨£åŒ–ï¼Œé¿å…é‡è¤‡ã€‚",
commentNote: "å¿…é ˆç”¨ç¹é«”å­—ã€‚é»è©•æ™‚ï¼Œéœ€è©•ä¼°ã€Œæ•´åˆæ‹“å±•ã€æ˜¯å¦èƒ½é—¡é‡‹ã€ŒæŠ„éŒ„è³‡æ–™ã€èˆ‡ã€Œä¸»é¡Œå¥ã€çš„é‚è¼¯é—œä¿‚ã€‚éœ€åˆ¤æ–·ï¼š1.ã€Œæ‹“å±•ã€æ–¹å‘æ˜¯å¦æ­£ç¢ºï¼ˆå³æ˜¯å¦èƒ½è«–è­‰ä¸»é¡Œå¥ï¼‰ï¼›2.æ¨è«–æ˜¯å¦åš´è¬¹ï¼›3.æ˜¯å¦å…·é«”ä¸ç©ºæ³›ã€‚ã€Œé»è©•ã€æ™‚ï¼Œè‹¥æ–¹å‘ä¸æ­£ç¢ºï¼Œéœ€æŒ‡å‡ºä¸¦å»ºè­°å¦‚ä½•ä¿®è¨‚ï¼Œéœ€æŒ‡å°ç·Šæ‰£ä¸»é¡Œå¥ï¼Œäº¦é ˆåˆ†æä¸»é¡Œå¥å’Œé¡Œç›®ä»»å‹™çš„é—œä¿‚æ˜¯å¦ç·Šå¯†ï¼Œä¾‹å¦‚é¡Œç›®ä»»å‹™ç‚ºæå‡ºå»ºè­°ï¼Œä½†ä¸»é¡Œå¥ç„¦é»å»æ˜¯æè¿°å•é¡Œï¼Œå‰‡å±¬æ–¼ä¸å¦¥ç•¶ã€‚ã€Œæ”¹å¯«ã€æ™‚äº¦ä¸èƒ½é †è‘—ã€Œæ•´åˆæ‹“å±•ã€éŒ¯èª¤æ€è·¯æ”¹å–„ï¼Œéœ€æ‰£ç·Šä¸»é¡Œå¥ï¼Œå‡å¦‚ä¸»é¡Œå¥æœ¬èº«å°±æœªèƒ½ç·Šæ‰£é¡Œç›®çš„ä»»å‹™ï¼Œå‰‡ä¸æ‡‰åœç¹æœ¬èº«éŒ¯èª¤çš„ä¸»é¡Œå¥æ”¹å¯«ï¼Œè¦åœ¨ã€Œæ”¹å¯«ã€çš„éƒ¨ä»½é‡å°ä¸€å€‹æ­£ç¢ºçš„ä¸»é¡Œå¥ä½œæ”¹å¯«ã€‚æ­¤å¤–ï¼Œæ”¹å¯«éƒ¨ä»½ä¸å®œåˆ†ç‚ºå¤ªå¤šè§’åº¦è«–è¿°ï¼Œé€™æ¨£æœƒä»¤é—¡é‡‹è¼ƒé›¶æ•£ï¼Œé ˆå°±æœ€å¤š2å€‹è§’åº¦æ·±å…¥åˆ†æã€é—¡é‡‹ã€‚æ”¹å¯«éƒ¨ä»½ä¸å¾—è¶…é180å­—ï¼Œä¸”ä¸å¾—è™›æ§‹è³‡æ–™ï¼ŒåŒ…æ‹¬æ•¸æ“šåŠèª¿æŸ¥ï¼Œä¸è¦è‡ªæ“¬ã€Œæ ¹æ“šèª¿æŸ¥ã€ä¹‹é¡ï¼Œåªå¯æ ¹æ“šæŠ„éŒ„è³‡æ–™è£œå……åˆç†ç´°ç¯€ï¼Œã€Œæ”¹å¯«ã€éƒ¨ä»½ä¸è¦é‡è¤‡ç”¨å®¶è¼¸å…¥çš„ã€ŒæŠ„éŒ„è³‡æ–™ã€ï¼Œæœƒç™½ç™½æµªè²»ç©ºé–“ã€‚æ­¤å¤–ï¼Œã€Œæ”¹å¯«ã€äº¦è¦åš´è¬¹å°æ‡‰ä¸»é¡Œå¥åŠæŠ„éŒ„è³‡æ–™é—œä¿‚ï¼Œä¾‹å¦‚ä¸»é¡Œå¥æè¿°æ´»å‹•å•é¡Œï¼Œå‰‡åœ¨ã€Œæ”¹å¯«ã€çš„éƒ¨ä»½ä¸å®œèšç„¦åœ¨æ”¹å–„æªæ–½ï¼Œå¿…é ˆæ³¨æ„è©³ç•¥ã€è¼•é‡ï¼Œæ‰èƒ½çªé¡¯ä¸»é¡Œå¥ã€‚æ­¤å¤–ï¼Œã€Œæ”¹å¯«ã€äº¦è¦ç•™æ„é¡Œç›®ä»»å‹™ï¼Œä¸è¦åœ¨ã€Œæ”¹å¯«ã€æ™‚æœƒé †è‘—ç”¨å®¶è©³ç•¥ä¸ç•¶æˆ–éŒ¯èª¤çš„ã€Œæ•´åˆæ‹“å±•ã€æ€è·¯æ”¹å¯«ã€‚æ­¤å¤–ï¼Œã€Œæ”¹å¯«ã€éƒ¨ä»½ä¸è¦å¤ªæ•¸æ“šåŒ–ï¼Œä¾‹å¦‚åšè¨ˆç®—åŠåˆ†ææ•¸æ“šç­‰ï¼Œé€™éƒ¨ä»½æœ€é‡è¦æ˜¯äº¤ä»£äº‹ç†çš„é‚è¼¯é—œä¿‚ã€‚é»è©•åˆ†ç‚ºä¸‰éƒ¨åˆ†ï¼š### é»è©•ã€### å»ºè­°ã€### æ”¹å¯«ã€‚é»è©•å’Œå»ºè­°ä»¥æ®µè½å½¢å¼å‘ˆç¾ï¼Œä¸ä½¿ç”¨åˆ—é»ã€‚æ‹“å±•æ–¹æ³•ï¼šä»¥æŠ„éŒ„è³‡æ–™ç‚ºèµ·é»ï¼Œä¸»é¡Œå¥ç‚ºçµ‚é»ï¼Œé‹ç”¨æ©«å‘æ‹“å±•ï¼ˆé€æ­¥æ¨è«–ï¼Œå›ç­”ã€Œç‚ºä½•ã€æˆ–ã€Œå¦‚ä½•ã€ï¼‰æˆ–ç›´å‘æ‹“å±•ï¼ˆè£œå……å…·é«”ä¾‹å­æˆ–ç´°ç¯€ï¼‰ã€‚æ”¹å¯«éƒ¨ä»½å¿…é ˆæ³¨æ„è¦é‹ç”¨å¥½æ©«å‘æ‹“å±•åŠç›´å‘æ‹“å±•çš„æŠ€å·§ã€‚å¸¸è¦‹å•é¡ŒåŒ…æ‹¬ï¼šæ¨è«–æ–¹å‘éŒ¯èª¤ã€æœªæ¨è«–åˆ°åº•ã€æ¨è«–é»é‡è¤‡ã€æ¨è«–è·³è„«ã€æœ‰é‡ç„¡è³ªï¼Œéœ€é‡å°æ€§æŒ‡å‡ºï¼Œæ”¹å¯«æ™‚äº¦è¦é¿å…çŠ¯ä¸‹é€™äº›å•é¡Œã€‚é»è©•åŠå»ºè­°éƒ½å¿…é ˆåœ¨200å­—ä»¥å…§ï¼Œæ”¹å¯«å¿…é ˆåœ¨160è‡³180å­—ä»¥ä¸Šã€‚",
guideNote: "å¿…é ˆç”¨ç¹é«”å­—ã€‚åƒ…ç”Ÿæˆä¸‰é“å•é¡Œä»¥å¼•å°ç”¨å®¶æ€è€ƒå¦‚ä½•æ ¹æ“šè¡¨æ ¼è³‡æ–™åšå¥½æ•´åˆæ‹“å±•ï¼Œå•é¡Œæ‡‰åœç¹ä¸»é¡Œå¥å’ŒæŠ„éŒ„è³‡æ–™çš„é‚è¼¯é—œä¿‚ï¼Œå¼•å°ç”¨å®¶æ€è€ƒå¦‚ä½•é—¡é‡‹å’Œæ‹“å±•ã€‚è«‹ä¸è¦é‹ç”¨æ­åŒ–å¥åŠè©åŒ¯ï¼Œä¾‹å¦‚ã€Œé—œè¯æ€§ã€ã€ã€Œå¯¦æ•ˆæ€§ã€ï¼Œé€™äº›å­—è©æ„ç¾©ä¸æ˜ç¢ºï¼Œä½†ç”¨ç”Ÿæ´»åŒ–ä¸€é»ã€å…·é«”ä¸€é»çš„å­—è©ç”Ÿæˆå•é¡Œã€‚è¼¸å‡ºåˆ†ç‚ºä¸€å€‹éƒ¨åˆ†ï¼š### æŒ‡å¼•å•é¡Œã€‚æŒ‡å¼•å•é¡Œä»¥å•é¡Œå½¢å¼å‘ˆç¾ï¼Œæ¯å€‹å•é¡Œä½”ä¸€è¡Œã€‚"
},
"è­°è«–": {
outlineCommentNote: "å¿…é ˆç”¨ç¹é«”å­—ã€‚é»è©•æ™‚ï¼Œå¿…é ˆå°±ä¸Šè¿°ç”Ÿæˆæˆ–è¼¸å…¥çš„é¡Œç›®é»è©•å¤§ç¶±å…§å®¹æ˜¯å¦æ‰£é¡Œã€‚å¿…é ˆå¾ä»¥ä¸‹è§’åº¦é»è©•ï¼š1. è«–é»æ˜¯å¦æ¸…æ™°æ˜ç¢ºï¼Œä¸€èªä¸­çš„ï¼Œèƒ½ç›´æ¥å‘¼æ‡‰é¡Œç›®ï¼›2. ç”¨å®¶æä¾›çš„è«–æ“šèˆ‡è«–é»æ˜¯å¦å¯†åˆ‡ç›¸é—œï¼Œå…¨æ–‡è«–æ“šæ˜¯å¦æ¶µè“‹å¤ä»Šä¸­å¤–ï¼ˆä¸éœ€è¦æ¯æ®µéƒ½æœ‰å¤ä»Šä¸­å¤–çš„ä¾‹å­ï¼Œå‡å¦‚å¤§ç¶±ä¸­ç¼ºè«–æ“šï¼Œå‰‡è¦è£œå……å¤ä»Šä¸­å¤–å…·é«”çš„è«–æ“šï¼Œå³æœ‰åæœ‰å§“çš„äººç‰©ä¾‹å­ï¼‰ï¼›3. æ®µå…§è«–æ“šçš„è©³ç•¥æœ‰å¹¾ç¨®æ¨¡å¼ï¼šå…©å€‹è©³çš„è«–æ“šï¼Œæˆ–ä¸€è©³æ•¸ç•¥ï¼Œæˆ–æ•¸ç•¥ï¼Œå› æ‡‰æ®µè½è«–è¿°éœ€è¦è€Œå®šï¼Œä»¥è£½é€ è®ŠåŒ–ï¼›4. è«–è­‰æ–¹å‘æ˜¯å¦åˆç†ï¼Œèƒ½åˆç†è§£é‡‹è«–æ“šèˆ‡è«–é»çš„é—œä¿‚ï¼ˆä½†è¦ç†è§£é€™éƒ¨ä»½åªæ˜¯å¤§ç¶±ï¼Œä¸å¯èƒ½è«–è­‰å¾—éå¸¸å…·é«”å’Œè©³ç´°ï¼Œåªè¦æ–¹å‘æ­£ç¢ºå³å¯æ¥å—ï¼‰ï¼›5. å…¨æ–‡è„ˆçµ¡æ˜¯å¦åˆ†æ˜ï¼Œå¯é‹ç”¨å‰ä¸­å¾Œæ§‹å»ºæ³•ï¼ˆå‰ï¼šèƒŒå¾Œæ¦‚å¿µ/æ¦‚å¿µèƒŒæ™¯ã€ç¾å¯¦ä¾‹å­ã€é§è«–ï¼›ä¸­ï¼šåˆ†é¡è«–è¿°ï¼Œä¾‹å¦‚é¡Œç›®ç‚ºã€Šè«‡æ†¤æ€’ã€‹ï¼Œå¯åˆ†ç‚ºã€Œå…¬æ€’ã€å’Œã€Œç§æ€’ã€ï¼Œæˆ–åˆ†æ‹†è«–è¿°ï¼Œä¾‹å¦‚é¡Œç›®ç‚ºã€Œé¢å°ä¸åŒæ„è¦‹ï¼Œæœ‰äººèªç‚ºæ‡‰æ“šç†åŠ›çˆ­ï¼Œå …å®ˆç«‹å ´ï¼›æœ‰äººèªç‚ºæ‡‰å½¼æ­¤åŒ…å®¹ï¼Œæ±‚åŒå­˜ç•°ã€‚ä¸Šè¿°å…©ç¨®æ…‹åº¦ï¼Œå“ªä¸€ç¨®è¼ƒç‚ºç†æƒ³ï¼Ÿè©¦è«‡è«‡ä½ çš„çœ‹æ³•ã€‚ã€ï¼Œå¯ä¸€æ®µè«–è¿°ã€Œæ±‚åŒã€ï¼Œå¦ä¸€æ®µè«–è¿°ã€Œå­˜ç•°ã€ï¼›å¾Œï¼šä¾‹å¤–æƒ…æ³/å…¶ä»–çœ‹æ³•ã€æ–¹æ³•ï¼‰ã€‚å³ä½¿é‹ç”¨ã€Œé™³SIRèªæ°£ã€ï¼Œã€Œå»ºè­°ã€åŠã€Œæ”¹å¯«å¾Œçš„å¤§ç¶±ã€éƒ½å¿…é ˆæ­£ç¶“åš´è‚…ï¼Œä¸è¦é‹ç”¨EMOJIã€‚æ­¤å¤–ï¼Œå‡å¦‚å…¨æ–‡æœ‰å…­æ®µæˆ–ä»¥ä¸Šï¼Œå‰‡æ‡‰åœ¨ç¬¬äºŒæ®µæˆ–æœ«äºŒçš„æ®µè½åšé§è«–ï¼Œé»è©•ã€å»ºè­°åŠæ”¹å¯«å¾Œçš„å¤§ç¶±éƒ½è¦æ³¨æ„é€™é»ã€‚æ­¤å¤–ï¼Œä¸è¦åˆ—é»å’Œé‹ç”¨ã€Œ*ã€ç­‰ç¬¦è™Ÿï¼Œå¿…é ˆä»¥æ®µè½å’Œå®Œæ•´å¥å­æ–¹å¼ç”Ÿæˆæ”¹å¯«å¾Œçš„å¤§ç¶±ã€‚æ­¤å¤–ï¼Œåœ¨å»ºè­°å’Œæ”¹å¯«å¾Œçš„å¤§ç¶±éƒ¨ä»½ï¼Œè‹¥è§¸åŠä¸€äº›ä¾‹å­æˆ–å…¸æ•…(ä¸è¦èˆ‰æ„›è¿ªç”Ÿç‚ºåƒè€ƒè«–æ“š)ï¼Œå¿…é ˆå…·é«”èªªæ˜è©²ä¾‹å­æˆ–å…¸æ•…çš„ä¾†é¾å»è„ˆï¼Œä»¥åŠè¦æ¸…æ¥šèªªæ˜å¦‚ä½•é‹ç”¨è©²ä¾‹å­æˆ–å…¸æ•…å»è­‰ç«‹è«–é»ã€‚æ­¤å¤–ï¼Œç„¡è«–é»è©•ã€å»ºè­°æˆ–æ”¹å¯«å¾Œçš„å¤§ç¶±ï¼Œç”¨èªéƒ½å¿…é ˆç”Ÿæ´»åŒ–ï¼Œè¦æ‘’æ£„éæ–¼æŠ½è±¡å’Œç†è«–çš„è¡¨é”ã€‚æ­¤å¤–ï¼Œé»è©•æ‡‰åˆ†ç‚ºä¸‰å€‹éƒ¨ä»½ï¼šé»è©•ã€å»ºè­°ã€æ”¹å¯«ç¯„ä¾‹ã€‚åªé¸å–æœ€é‡è¦çš„ä¸€è‡³å…©é»è©•è«–ï¼Œæ‡‰å…ˆèšç„¦åœ¨è«–é»ã€è«–æ“šå’Œè«–è­‰çš„è³ªé‡ï¼Œå…¶æ¬¡æ–¹ç‚ºçµæ§‹ã€‚é»è©•å…§å®¹è¦ç²¾ç°¡ã€ä¸€èªä¸­çš„ã€‚è‹¥å¤§ç¶±é›¢é¡Œï¼Œæ”¹å¯«å¾Œçš„å¤§ç¶±ä¸å¿…æ ¹æ“šé›¢é¡Œå…§å®¹æ”¹å¯«ã€‚",
writingCommentNote: "å¿…é ˆç”¨ç¹é«”å­—ã€‚é»è©•æ™‚ï¼Œå¿…é ˆå°±ç”¨å®¶æä¾›çš„å…§å®¹å»é»è©•ï¼Œä¸è¦æé€ ç”¨å®¶æ²’æœ‰è¼¸å…¥çš„å…§å®¹ä½œé»è©•ã€‚é ˆè©•ä¼°æ–‡ç« æ˜¯å¦ç¬¦åˆä»¥ä¸‹æ¨™æº–ï¼š1. è«–é»æ¸…æ™°æ˜ç¢ºï¼Œä¸€èªä¸­çš„ï¼Œèƒ½ç›´æ¥å‘¼æ‡‰é¡Œç›®ï¼›2. è«–æ“šèˆ‡è«–é»å¯†åˆ‡ç›¸é—œï¼Œå…¨æ–‡è«–æ“šæ¶µè“‹å¤ä»Šä¸­å¤–ï¼ˆä¸éœ€è¦æ¯æ®µéƒ½æœ‰å¤ä»Šä¸­å¤–çš„ä¾‹å­ï¼Œä¸è¦æé€ ç”¨å®¶æ²’æœ‰è¼¸å…¥çš„ä¾‹å­ä½œé»è©•ï¼Œå‡å¦‚ç¼ºå°‘ä¾‹å­ï¼Œç›´è¨€å…¶å•é¡Œå³å¯ã€‚è¦æ³¨æ„éçŒ¶ä¸åŠï¼Œå……å¡ä¾‹å­å‰‡æ„Ÿè¦ºç”Ÿç¡¬ï¼‰ï¼›3. è«–è­‰åš´è¬¹ï¼Œèƒ½å…·é«”è§£é‡‹è«–æ“šèˆ‡è«–é»çš„é—œä¿‚ï¼›4. æ³¨æ„æ–‡å¥å¯†åº¦ï¼ˆè©åŒ¯é‡ã€å¯¦è©åŠè™›è©æ¯”ä¾‹ï¼Œä½†éçŒ¶ä¸åŠï¼Œéé‡ä½¿ç”¨å¯¦è©å‰‡ç”Ÿç¡¬ï¼Œé©æ™‚åŠ å…¥è™›è©ï¼Œæ‰èƒ½ä½¿æ–‡å¥ç¯€å¥éŒ¯è½æœ‰è‡´ï¼‰åŠä¿®è¾­é‹ç”¨ï¼ˆå®œé©æ™‚é‹ç”¨æ’æ¯”å’Œæ¯”å–»ï¼‰ã€‚é»è©•åˆ†ç‚ºä¸‰éƒ¨åˆ†ï¼š### é»è©•ã€### å»ºè­°ã€### æ”¹å¯«ç¯„ä¾‹ã€‚é»è©•å’Œå»ºè­°ä»¥æ®µè½å½¢å¼å‘ˆç¾ï¼Œä¸ä½¿ç”¨åˆ—é»ã€‚å³ä½¿é‹ç”¨ã€Œé™³SIRèªæ°£ã€ï¼Œã€Œå»ºè­°ã€åŠã€Œæ”¹å¯«ç¯„ä¾‹ã€éƒ½å¿…é ˆæ­£ç¶“åš´è‚…åœ°è¡¨è¿°ï¼Œä¸è¦é‹ç”¨EMOJIã€‚ã€Œæ”¹å¯«ç¯„ä¾‹ã€æ‡‰ä»¥ç´”æ®µè½æ–¹å¼è¡¨è¿°ï¼Œä¸è¦é‹ç”¨EMOJIï¼Œä¸è¦é™„æœ‰ã€åŸæ–‡æ®µè½ã€‘åŠã€æ”¹å¯«æ®µè½ã€‘ç­‰æ¨™é¡Œã€‚é»è©•ã€å»ºè­°åŠæ”¹å¯«éƒ½è¦åœ¨200å­—ä»¥å…§ã€‚",
guideNote: "å¿…é ˆç”¨ç¹é«”å­—ã€‚æ ¹æ“šç”¨æˆ¶è¼¸å…¥çš„é¡Œç›®ã€è«–é»ã€è«–æ“šå’Œè«–è­‰ï¼Œæä¾›ç›¸æ‡‰çš„åƒè€ƒå»ºè­°ï¼Œä½†æ‡‰é‡è³ªä¸é‡é‡ï¼ŒæŒ‡å¼•è«–é»ã€è«–æ“šæˆ–è«–è­‰éƒ½å®œåªèˆ‰ä¸€é …ï¼Œè€Œä¸”è«–æ“šå¿…é ˆç”¨çœŸå¯¦çš„å¤ä»Šä¸­å¤–ä¾‹å­ï¼Œè€Œè«–è­‰å‰‡è«–è­‰å¿…é ˆç·Šæ‰£ç”¨å®¶æä¾›æˆ–ä½ ä¸Šè¿°ç”Ÿæˆçš„è«–æ“šä½œè«–è¿°ã€‚è‹¥åªè¼¸å…¥é¡Œç›®ï¼Œå‰‡æä¾›åƒè€ƒè«–é»ã€åƒè€ƒè«–æ“šå’Œåƒè€ƒè«–è­‰ï¼›è‹¥è¼¸å…¥é¡Œç›®å’Œè«–é»ï¼Œå‰‡æä¾›åƒè€ƒè«–æ“šå’Œåƒè€ƒè«–è­‰ï¼›è‹¥è¼¸å…¥é¡Œç›®å’Œè«–æ“šï¼Œå‰‡æä¾›åƒè€ƒè«–é»å’Œåƒè€ƒè«–è­‰ï¼Œå¦‚æ­¤é¡æ¨ã€‚ä¸è¦èˆ‰æ„›è¿ªç”Ÿç‚ºåƒè€ƒè«–æ“šã€‚è¼¸å‡ºåˆ†ç‚ºç›¸æ‡‰éƒ¨åˆ†ï¼š### åƒè€ƒè«–é»ã€### åƒè€ƒè«–æ“šã€### åƒè€ƒè«–è­‰ï¼ˆè¦–ç”¨æˆ¶è¼¸å…¥æƒ…æ³è€Œå®šï¼‰ã€‚æ¯éƒ¨åˆ†ä»¥æ®µè½å½¢å¼å‘ˆç¾ã€‚"
}
};

// ç¯„ç–‡åˆ‡æ›
document.getElementById("writingBtn").addEventListener("click", function() {
showContainer("writingContainer");
});
document.getElementById("readingBtn").addEventListener("click", function() {
showContainer("readingContainer");
});



document.getElementById("booksBtn").addEventListener("click", function() {
showContainer("booksContainer");
loadBooksChat();
});
document.getElementById("expandBtn").addEventListener("click", function() {
showContainer("expandContainer");
});
document.getElementById("argumentBtn").addEventListener("click", function() {
showContainer("argumentContainer");
});


function showContainer(containerId) {
    // ã€æ ¸å¿ƒä¿®è¨‚ã€‘åœ¨åˆ‡æ›ä¸»è¦ç¯„ç–‡æ™‚ï¼Œé¦–å…ˆæ¸…é™¤æ‰€æœ‰èˆŠçš„é¡Œç›®ç‹€æ…‹
    clearAllTopicStates();

    document.getElementById("writingContainer").style.display = "none";
    document.getElementById("readingContainer").style.display = "none";
    document.getElementById("booksContainer").style.display = "none";
    document.getElementById("expandContainer").style.display = "none";
    document.getElementById("argumentContainer").style.display = "none";
    document.getElementById(containerId).style.display = "block";
    if (containerId === "writingContainer") {
        toggleWritingType();
        loadOutline();
    }
    if (containerId === "readingContainer") toggleReadingFunction();
    if (containerId === "expandContainer") toggleExpandFunction();
    if (containerId === "booksContainer") toggleBooksDiscussionState();
    if (containerId === "argumentContainer") toggleArgumentType();
}

// æ–°å¢æ­¤å‡½å¼ï¼šç”¨æ–¼é¡¯ç¤ºè­°è«–çš„è‡ªè¨‚é¡Œç›®ä»‹é¢
function showArgumentCustomTopicInput(buttonElement) { // (1) å¢åŠ åƒæ•¸ buttonElement
    // (2) æ–°å¢é€™æ®µç¨‹å¼ç¢¼ä¾†æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
    if (buttonElement) {
        updateButtonActiveState(buttonElement);
    }

    const customTopicArea = document.getElementById("argumentCustomTopicArea");
    const topicResult = document.getElementById("argumentTopicResult");

    topicResult.innerHTML = "";
    topicResult.style.display = "none";
    localStorage.removeItem("argumentCurrentTopic");

    customTopicArea.innerHTML = `
    <input type="text" id="argumentCustomTopic" placeholder="è«‹è¼¸å…¥è‡ªè¨‚é¡Œç›®">
    <button class="btn-icon-confirm" onclick="setArgumentCustomTopic()" title="ç¢ºèªé¡Œç›®">
        <i class="fas fa-check"></i>
    </button>
`;
    customTopicArea.style.display = "block";
}

// åˆ‡æ›å¯«ä½œé¡å‹
function toggleWritingType() {

// ã€æ ¸å¿ƒä¿®è¨‚ã€‘åœ¨åˆ‡æ›åŠŸèƒ½æ™‚æ¸…é™¤ç‹€æ…‹
    clearAllTopicStates();
    const writingType = document.getElementById("writingType").value;
    const contentContainer = document.getElementById("writingContentContainer");

    if (writingType) {
        contentContainer.style.display = "block";
    } else {
        contentContainer.style.display = "none";
        return; // å¦‚æœæ²’æœ‰é¸æ“‡ï¼Œå‰‡åœæ­¢åŸ·è¡Œ
    }
    
    const outlineStructureArea = document.getElementById("outlineStructureArea");
    const narrativeElementsArea = document.getElementById("narrativeElementsArea");
    const writingContent = document.getElementById("writingContent");
    const outlineTableArea = document.getElementById("outlineTableArea");
    const writingToneLabel = document.getElementById("writingToneLabel");
    const writingTone = document.getElementById("writingTone");
    const outlineButtons = document.getElementById("outlineButtons");

    if (writingType === "å¤§ç¶±") {
        outlineStructureArea.style.display = "block";
        narrativeElementsArea.style.display = "none";
        writingContent.style.display = "none";
        outlineTableArea.style.display = "block";
        generateOutlineTable();
        loadOutline();
        writingToneLabel.style.display = "block";
        writingTone.style.display = "block";
        outlineButtons.style.display = "block";
    } else if (writingType === "æ•˜äº‹ç‰©è±¡") {
        outlineStructureArea.style.display = "none";
        narrativeElementsArea.style.display = "block";
        writingContent.style.display = "none";
        outlineTableArea.innerHTML = "";
        outlineTableArea.style.display = "none";
        writingToneLabel.style.display = "none";
        writingTone.style.display = "none";
        outlineButtons.style.display = "none";
    } else { // ç‰‡æ®µæå¯«
        outlineStructureArea.style.display = "none";
        narrativeElementsArea.style.display = "none";
        writingContent.style.display = "block";
        outlineTableArea.innerHTML = "";
        outlineTableArea.style.display = "none";
        writingToneLabel.style.display = "block";
        writingTone.style.display = "block";
        outlineButtons.style.display = "none";
    }
    toggleTopicInput();
}

  // åŸ showCustomTopicInput() å‡½å¼
function showCustomTopicInput(buttonElement) { // (1) å¢åŠ åƒæ•¸ buttonElement
    // (2) æ–°å¢é€™æ®µç¨‹å¼ç¢¼ä¾†æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
    if (buttonElement) {
        updateButtonActiveState(buttonElement);
    }

    const writingType = document.getElementById("writingType").value;
    const customTopicArea = document.getElementById("customTopicArea");
    const topicResult = document.getElementById("topicResult");

    topicResult.innerHTML = "";
    topicResult.style.display = "none";
    localStorage.removeItem("currentTopic");
    localStorage.removeItem("currentFocus");
    localStorage.removeItem("currentPlot");

    if (writingType === "ç‰‡æ®µæå¯«") {
        customTopicArea.innerHTML = `
        <table>
            <tr><th colspan="2">è‡ªè¨‚é¡Œç›®èˆ‡é‡é»</th></tr>
            <tr><td colspan="2"><input type="text" id="customTitle" placeholder="è«‹è¼¸å…¥è‡ªè¨‚é¡Œç›®"></td></tr>
            <tr><td>çµæ§‹æ®µé‡é»/å…¨æ–‡é‡é»</td><td>æƒ…ç¯€å¤§è¦</td></tr>
            <tr><td><textarea id="customFocus" rows="3" placeholder="è«‹è¼¸å…¥çµæ§‹æ®µé‡é»"></textarea></td>
            <td><textarea id="customPlot" rows="3" placeholder="è«‹è¼¸å…¥æƒ…ç¯€å¤§è¦"></textarea></td></tr>
        </table>
        <button class="btn-icon-confirm" onclick="setCustomTopic()" title="ç¢ºèªé¡Œç›®">
    <i class="fas fa-check"></i>
</button>
        `;
    } else { 
        customTopicArea.innerHTML = `
<input type="text" id="customTopic" placeholder="è«‹è¼¸å…¥è‡ªè¨‚é¡Œç›®">
<button class="btn-icon-confirm" onclick="setCustomTopic()" title="ç¢ºèªé¡Œç›®">
    <i class="fas fa-check"></i>
</button>
`;
    }
    customTopicArea.style.display = "block";
}

// ä¿å­˜å¤§ç¶±
function saveOutline() {
const structure = document.getElementById("structure").value;
const parts = structure === "fourPart" ? ["èµ·", "æ‰¿", "è½‰", "åˆ"] : ["èµ·", "ä¸€ç·š", "äºŒç·š", "ä¸‰ç·š", "åˆ"];
const outlineData = parts.map((part, index) => {
const focusId = structure + "Focus" + (index + 1);
const plotId = structure + "Plot" + (index + 1);
const focus = document.getElementById(focusId)?.value.trim() || "";
const plot = document.getElementById(plotId)?.value.trim() || "";
return { part, focus, plot };
});
localStorage.setItem("outlineData", JSON.stringify(outlineData));
localStorage.setItem("outlineStructure", structure);
alert("å¤§ç¶±å·²å„²å­˜");
}

// æ¸…ç©ºå¤§ç¶±
function clearOutline() {
if (confirm("ç¢ºå®šè¦æ¸…ç©ºå¤§ç¶±å—ï¼Ÿ")) {
const structure = document.getElementById("structure").value;
const parts = structure === "fourPart" ? ["èµ·", "æ‰¿", "è½‰", "åˆ"] : ["èµ·", "ä¸€ç·š", "äºŒç·š", "ä¸‰ç·š", "åˆ"];
parts.forEach((part, index) => {
const focusId = structure + "Focus" + (index + 1);
const plotId = structure + "Plot" + (index + 1);
if (document.getElementById(focusId)) document.getElementById(focusId).value = "";
if (document.getElementById(plotId)) document.getElementById(plotId).value = "";
});
localStorage.removeItem("outlineData");
localStorage.removeItem("outlineStructure");
}
}

// åŠ è¼‰å¤§ç¶±
function loadOutline() {
const savedStructure = localStorage.getItem("outlineStructure");
const savedData = localStorage.getItem("outlineData");
if (savedStructure && savedData) {
document.getElementById("structure").value = savedStructure;
generateOutlineTable();
try {
const parsedData = JSON.parse(savedData);
parsedData.forEach((item, index) => {
const focusId = savedStructure + "Focus" + (index + 1);
const plotId = savedStructure + "Plot" + (index + 1);
const focusElement = document.getElementById(focusId);
const plotElement = document.getElementById(plotId);
if (focusElement) focusElement.value = item.focus;
if (plotElement) plotElement.value = item.plot;
});
} catch (e) {
console.error("Error parsing outlineData:", e);
}
}
}

// ä¿å­˜èª²å¤–æ›¸ç±å°è©±
// æ›¿æ›èˆŠçš„ saveBooksChat å‡½å¼
function saveBooksChat() {
    const bookTitle = document.getElementById("bookTitle").value.trim();
    const author = document.getElementById("author").value.trim();
    const discussionQuestion = document.getElementById("discussionQuestion").value.trim();
    const booksTone = document.getElementById("booksTone").value;
    
    // å„²å­˜ç´”æ•¸æ“šçš„ chatHistory é™£åˆ— (JSON æ ¼å¼)
    localStorage.setItem("booksChatHistory", JSON.stringify(chatHistory));
    localStorage.setItem("booksChatState", JSON.stringify({
        bookTitle, author, discussionQuestion, booksTone
    }));
    alert("å°è©±å·²å„²å­˜");
}

function clearBooksChat() {
    if (confirm("ç¢ºå®šè¦æ¸…ç©ºå°è©±å—ï¼Ÿ")) {
        const chatHistoryDiv = document.getElementById("chatHistory");
        chatHistoryDiv.innerHTML = "";
        chatHistoryDiv.style.display = "none";

        document.getElementById("bookTitle").value = "";
        document.getElementById("author").value = "";
        document.getElementById("discussionQuestion").value = "";
        
        const userInput = document.getElementById("userInput");
        const continueBtn = document.getElementById("continueBtn");
        
        userInput.value = "";
        userInput.style.display = "none";
        continueBtn.style.display = "none";
        
        // ã€æ ¸å¿ƒä¿®è¨‚ã€‘ä¸å†éœ€è¦æ‰‹å‹•æ“ä½œ startBtn çš„é¡¯ç¤ºç‹€æ…‹
        const startBtn = document.getElementById('startDiscussionBtn');
        if(startBtn) {
            startBtn.disabled = false; // ç¢ºä¿æŒ‰éˆ•æ˜¯å¯ç”¨çš„
        }

        localStorage.removeItem("booksChatHistory");
        localStorage.removeItem("booksChatState");
        
        chatHistory = [];
        bookTitle = "";
        author = "";
        discussionQuestion = "";
        booksTone = "";
    }
}

// æ›¿æ›èˆŠçš„ loadBooksChat å‡½å¼
function loadBooksChat() {
    const savedChatJSON = localStorage.getItem("booksChatHistory");
    const savedState = localStorage.getItem("booksChatState");

    const chatHistoryDiv = document.getElementById("chatHistory");
    const continueBtn = document.getElementById("continueBtn");
    const userInput = document.getElementById("userInput");
    const startBtn = document.getElementById('startDiscussionBtn');
    
    // ç„¡è«–å¦‚ä½•ï¼Œã€Œé–‹å§‹è¨è«–ã€æŒ‰éˆ•éƒ½ä¿æŒå¯è¦‹
    startBtn.style.display = 'block';
    startBtn.disabled = false;

    if (savedChatJSON && savedState) {
        // --- æœ‰å„²å­˜ç´€éŒ„çš„æ¨¡å¼ ---
        
        chatHistoryDiv.innerHTML = '';
        chatHistory = JSON.parse(savedChatJSON);
        
        chatHistory.forEach(item => {
            const messageContainer = document.createElement("div");
            if (item.sender === "info") {
                messageContainer.className = "discussion-info";
                messageContainer.innerHTML = item.message;
            } else {
                messageContainer.className = `message-bubble ${item.sender}-message`;
                const avatar = document.createElement("div");
                avatar.className = "avatar";
                const messageContent = document.createElement("div");
                messageContent.className = "message-content";
                messageContent.innerHTML = item.message;
                messageContainer.appendChild(avatar);
                messageContainer.appendChild(messageContent);
            }
            chatHistoryDiv.appendChild(messageContainer);
        });

        chatHistoryDiv.style.display = "block";

        const state = JSON.parse(savedState);
        document.getElementById("bookTitle").value = state.bookTitle || "";
        document.getElementById("author").value = state.author || "";
        document.getElementById("discussionQuestion").value = state.discussionQuestion || "";
        document.getElementById("booksTone").value = state.booksTone || "serious";
        bookTitle = state.bookTitle || "";
        author = state.author || "";
        discussionQuestion = state.discussionQuestion || "";
        booksTone = state.booksTone || "serious";

        // é¡¯ç¤ºã€Œç¹¼çºŒè¨è«–ã€ç›¸é—œçš„ä»‹é¢
        userInput.style.display = "block";
        continueBtn.style.display = "block";

    } else {
        // --- æ²’æœ‰å„²å­˜ç´€éŒ„çš„æ¨¡å¼ (åˆå§‹ç‹€æ…‹) ---

        // ã€æ ¸å¿ƒä¿®è¨‚ã€‘ç¢ºä¿èŠå¤©ç›¸é—œä»‹é¢éƒ½æ˜¯éš±è—çš„
        chatHistoryDiv.style.display = "none";
        userInput.style.display = "none";
        continueBtn.style.display = "none";
    }
}


/**
 * æ›´æ–°æœ€å¾Œä¸€æ¢ AI è¨Šæ¯çš„å…§å®¹ï¼ˆå¾ "æ­£åœ¨å›æ‡‰..." åˆ°å¯¦éš›çš„å›æ‡‰ï¼‰ã€‚
 * é€™å€‹æ–°ç‰ˆæœ¬èƒ½è™•ç†å¸¶æœ‰é ­åƒå’Œæ°£æ³¡çš„è¤‡é›œ HTML çµæ§‹ã€‚
 * @param {string} newMessage - å¾ API ç²å–åˆ°çš„æ–°è¨Šæ¯å…§å®¹ã€‚
 */
function updateLastAIMessage(newMessage) {
    // ç¾åœ¨ ai-loading é€™å€‹ ID ç›´æ¥åœ¨ message-bubble å…ƒç´ ä¸Š
    const loadingBubble = document.getElementById("ai-loading"); 

    if (loadingBubble) {
        // ç›´æ¥æ›´æ–°æ°£æ³¡çš„å…§å®¹
        loadingBubble.innerHTML = newMessage;
        // ç§»é™¤ ID
        loadingBubble.id = ""; 
        
        // åŒæ­¥æ•¸æ“š
        if (chatHistory.length > 0) {
            chatHistory[chatHistory.length - 1].message = newMessage;
        }
    } else {
        addMessageToHistory("ai", newMessage);
    }
}

// åˆ‡æ›èª²å¤–æ›¸ç±è¨è«–ç‹€æ…‹
function toggleBooksDiscussionState() {
const savedChat = localStorage.getItem("booksChatHistory");
if (savedChat) {
document.getElementById("userInput").style.display = "block";
document.getElementById("continueBtn").style.display = "block";
} else {
document.getElementById("userInput").style.display = "none";
document.getElementById("continueBtn").style.display = "none";
}
}

// åˆ‡æ›é–±è®€åŠŸèƒ½
function toggleReadingFunction() {

 clearAllTopicStates();

    const readingFunction = document.getElementById("readingFunction").value;
    const contentContainer = document.getElementById("readingInputArea");

    if (readingFunction) {
        contentContainer.style.display = "block";
    } else {
        contentContainer.style.display = "none";
        return; // å¦‚æœæ²’æœ‰é¸æ“‡ï¼Œå‰‡åœæ­¢åŸ·è¡Œ
    }

    const studentAnswerArea = document.getElementById("studentAnswerArea");
    const readingToneLabel = document.getElementById("readingToneLabel");
    const readingTone = document.getElementById("readingTone");
    if (readingFunction === "comment") {
        studentAnswerArea.style.display = "block";
        readingToneLabel.style.display = "block";
        readingTone.style.display = "block";
    } else {
        studentAnswerArea.style.display = "none";
        readingToneLabel.style.display = "none";
        readingTone.style.display = "none";
    }
}


// è«‹ç”¨é€™å€‹æ–°ç‰ˆæœ¬çš„å‡½å¼ï¼Œæ›¿æ›æ‰æ‚¨åŸæœ¬çš„ toggleExpandFunction
// è«‹ç”¨é€™å€‹æ–°ç‰ˆæœ¬çš„å‡½å¼ï¼Œæ›¿æ›æ‰æ‚¨åŸæœ¬çš„ toggleExpandFunction
function toggleExpandFunction() {
    clearAllTopicStates(); // é€™è¡Œå¾ˆå¥½ï¼Œä¿æŒä¸è®Š

    const expandFunction = document.getElementById("expandFunction").value;
    const contentContainer = document.getElementById("expandContentContainer");

    if (expandFunction) {
        contentContainer.style.display = "block";
    } else {
        contentContainer.style.display = "none";
        return;
    }
    
    const expandWritingArea = document.getElementById("expandWritingArea");
    const expandGuideArea = document.getElementById("expandGuideArea");
    const expandTopicSelectionArea = document.getElementById("expandTopicSelectionArea");
    const expandToneLabel = document.getElementById("expandToneLabel");
    const expandTone = document.getElementById("expandTone");

    // æ ¹æ“šé¸æ“‡çš„åŠŸèƒ½ï¼Œé¡¯ç¤ºæˆ–éš±è—å°æ‡‰çš„å€å¡Š
    if (expandFunction === "comment") {
        expandWritingArea.style.display = "block";
        expandGuideArea.style.display = "none";
        expandTopicSelectionArea.style.display = "block"; // é¡¯ç¤ºæˆ‘å€‘æ–°çš„æŒ‰éˆ•å€å¡Š
        expandToneLabel.style.display = "block";
        expandTone.style.display = "block";

        // ç¢ºä¿è‡ªè¨‚é¡Œç›®è¼¸å…¥å€é è¨­æ˜¯éš±è—çš„
        const customInputArea = document.getElementById("expandCustomTopicInputArea");
        if(customInputArea) {
            customInputArea.style.display = 'none';
            customInputArea.innerHTML = '';
        }

    } else { // "guide"
        expandWritingArea.style.display = "none";
        expandGuideArea.style.display = "block";
        expandTopicSelectionArea.style.display = "none";
        expandToneLabel.style.display = "none";
        expandTone.style.display = "none";
    }
}
// æ–°å¢æ­¤å‡½å¼ï¼šç”¨æ–¼é¡¯ç¤ºæ•´åˆæ‹“å±•çš„è‡ªè¨‚é¡Œç›®ä»‹é¢
function showExpandCustomTopicInput(buttonElement) {
    if (buttonElement) {
        updateButtonActiveState(buttonElement);
    }

    const customTopicArea = document.getElementById("expandCustomTopicInputArea");
    const topicResult = document.getElementById("expandTopicResult");

    topicResult.innerHTML = "";
    topicResult.style.display = "none";
    localStorage.removeItem("expandCurrentTitle");
    localStorage.removeItem("expandCurrentTheme");
    localStorage.removeItem("expandCurrentData");

    // å‹•æ…‹ç”Ÿæˆè‡ªè¨‚é¡Œç›®çš„è¼¸å…¥è¡¨æ ¼å’Œç¢ºèªæŒ‰éˆ•
    customTopicArea.innerHTML = `
        <table>
            <tr><th>é¡Œç›®</th><td><input type="text" id="expandCustomTitle" placeholder="è«‹è¼¸å…¥é¡Œç›®"></td></tr>
            <tr><th>ä¸»é¡Œå¥</th><td><textarea id="expandCustomTheme" rows="2" placeholder="è«‹è¼¸å…¥ä¸»é¡Œå¥"></textarea></td></tr>
            <tr><th>æŠ„éŒ„è³‡æ–™</th><td><textarea id="expandCustomData" rows="3" placeholder="è«‹è¼¸å…¥æŠ„éŒ„è³‡æ–™"></textarea></td></tr>
        </table>
        <button class="btn-icon-confirm" onclick="setExpandCustomTopic()" title="ç¢ºèªé¡Œç›®">
            <i class="fas fa-check"></i>
        </button>
    `;
    customTopicArea.style.display = "block";
}



// åˆ‡æ›è­°è«–åŠŸèƒ½
function toggleArgumentType() {

 clearAllTopicStates();

    const argumentType = document.getElementById("argumentType").value;
    const contentContainer = document.getElementById("argumentContentContainer");
    
    if (argumentType) {
        contentContainer.style.display = "block";
    } else {
        contentContainer.style.display = "none";
        return; // å¦‚æœæ²’æœ‰é¸æ“‡ï¼Œå‰‡åœæ­¢åŸ·è¡Œ
    }
    
    const outlineArea = document.getElementById("argumentOutlineArea");
    const writingArea = document.getElementById("argumentWritingArea");
    const guideArea = document.getElementById("argumentGuideArea");
    const topicSelectionArea = document.getElementById("argumentTopicSelectionArea");

    if (argumentType === "outline") {
        outlineArea.style.display = "block";
        writingArea.style.display = "none";
        guideArea.style.display = "none";
        topicSelectionArea.style.display = "block";
        generateArgumentOutlineTable();
    } else if (argumentType === "writing") {
        outlineArea.style.display = "none";
        writingArea.style.display = "block";
        guideArea.style.display = "none";
        topicSelectionArea.style.display = "block";
    } else if (argumentType === "guide") {
        outlineArea.style.display = "none";
        writingArea.style.display = "none";
        guideArea.style.display = "block";
        topicSelectionArea.style.display = "none";
    }
    toggleArgumentTopicInput();
}


// åˆ‡æ›é¡Œç›®è¼¸å…¥æ–¹å¼ï¼ˆè­°è«–ï¼‰
function toggleArgumentTopicInput() {
const option = document.getElementById("argumentTopicOption").value;
const customTopicArea = document.getElementById("argumentCustomTopicArea");
if (option === "generate") {
document.getElementById("argumentGenerateTopicArea").style.display = "block";
customTopicArea.style.display = "none";
document.getElementById("argumentTopicResult").innerHTML = "";
localStorage.removeItem("argumentCurrentTopic");
} else {
document.getElementById("argumentGenerateTopicArea").style.display = "none";
customTopicArea.style.display = "block";
document.getElementById("argumentTopicResult").innerHTML = "";
localStorage.removeItem("argumentCurrentTopic");
}
}

// ç”Ÿæˆè­°è«–é¡Œç›®
async function generateArgumentTopic(buttonElement) { // (1) å¢åŠ åƒæ•¸ buttonElement
    // (2) æ–°å¢é€™æ®µç¨‹å¼ç¢¼ä¾†æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
    if (buttonElement) {
        updateButtonActiveState(buttonElement);
    }

    const customTopicArea = document.getElementById("argumentCustomTopicArea");
    customTopicArea.style.display = "none";
    customTopicArea.innerHTML = "";

    const topicResult = document.getElementById("argumentTopicResult");
    topicResult.style.display = 'block';

    let selectedTopic;
    do {
        selectedTopic = argumentTopics[Math.floor(Math.random() * argumentTopics.length)];
    } while (selectedTopic === lastArgumentTopic && argumentTopics.length > 1);
    lastArgumentTopic = selectedTopic;
    
    localStorage.setItem("lastArgumentTopic", lastArgumentTopic);
    topicResult.innerHTML = "<strong>" + selectedTopic + "</strong>";
    localStorage.setItem("argumentCurrentTopic", selectedTopic);
}




// è¨­å®šè‡ªè¨‚é¡Œç›®ï¼ˆè­°è«–ï¼‰
function setArgumentCustomTopic() {
    const customTopic = document.getElementById("argumentCustomTopic").value.trim();
    if (!customTopic) {
        alert("è«‹è¼¸å…¥è‡ªè¨‚é¡Œç›®");
        return;
    }
    
    const topicResult = document.getElementById("argumentTopicResult");
    topicResult.innerHTML = "<strong>" + customTopic + "</strong>";
    localStorage.setItem("argumentCurrentTopic", customTopic);

    // ã€æ ¸å¿ƒä¿®è¨‚ã€‘å¼·åˆ¶è®“é¡Œç›®çµæœå€å¡Šé¡¯ç¤ºå‡ºä¾†
    topicResult.style.display = "block"; 
    
    // éš±è—ä¸¦æ¸…ç©ºè¼¸å…¥å€åŸŸ
    const customTopicArea = document.getElementById("argumentCustomTopicArea");
    customTopicArea.style.display = "none";
    customTopicArea.innerHTML = "";
}
// ç”Ÿæˆè­°è«–å¤§ç¶±è¡¨æ ¼
function generateArgumentOutlineTable() {
const savedData = localStorage.getItem("argumentOutlineData");
let outlineData = [];
if (savedData) {
try {
outlineData = JSON.parse(savedData);
} catch (e) {
console.error("Error parsing argumentOutlineData:", e);
}
}
if (outlineData.length === 0) {
outlineData = [
{ part: "èµ·", point: "", evidence: "" },
{ part: "çµæ§‹æ®µä¸€", point: "", evidence: "" },
{ part: "çµæ§‹æ®µäºŒ", point: "", evidence: "" },
{ part: "çµæ§‹æ®µä¸‰", point: "", evidence: "" },
{ part: "åˆ", point: "", evidence: "" }
];
}
let tableHTML = "<div class='table-container'><table id='argumentOutlineTable'><tr><th>éƒ¨ä»½</th><th>è«–é»</th><th>è«–æ“šåŠè«–è­‰</th></tr>";
outlineData.forEach((item, index) => {
tableHTML += `<tr><td>${item.part}</td><td><textarea id="argumentPoint${index}" rows="3">${item.point}</textarea></td><td><textarea id="argumentEvidence${index}" rows="3">${item.evidence}</textarea></td></tr>`;
});
tableHTML += "</table></div>";
document.getElementById("argumentOutlineTableArea").innerHTML = tableHTML;
}

function addArgumentStructureSegment() {
const table = document.getElementById("argumentOutlineTable");
const rows = table.rows;
let structureSegmentCount = 0;
for (let i = 1; i < rows.length - 1; i++) { // è·³éè¡¨é ­å’Œã€Œåˆã€
if (rows[i].cells[0].innerText.startsWith("çµæ§‹æ®µ")) {
structureSegmentCount++;
}
}
const newSegmentNumber = structureSegmentCount + 1;
const chineseNumbers = ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹", "å"];
const segmentName = `çµæ§‹æ®µ${chineseNumbers[newSegmentNumber - 1] || newSegmentNumber}`;
const newRowIndex = rows.length - 1; // åœ¨ã€Œåˆã€ä¹‹å‰æ’å…¥
const newRow = table.insertRow(newRowIndex);
const cell1 = newRow.insertCell(0);
const cell2 = newRow.insertCell(1);
const cell3 = newRow.insertCell(2);
cell1.innerText = segmentName;
cell2.innerHTML = `<textarea id="argumentPoint${newRowIndex - 1}" rows="3"></textarea>`;
cell3.innerHTML = `<textarea id="argumentEvidence${newRowIndex - 1}" rows="3"></textarea>`;
}

// ä¿å­˜è­°è«–å¤§ç¶±
function saveArgumentOutline() {
const table = document.getElementById("argumentOutlineTable");
const rows = table.rows;
const outlineData = [];
for (let i = 1; i < rows.length; i++) { // è·³éè¡¨é ­
const part = rows[i].cells[0].innerText;
const pointTextarea = rows[i].cells[1].querySelector("textarea");
const evidenceTextarea = rows[i].cells[2].querySelector("textarea");
const point = pointTextarea ? pointTextarea.value.trim() : "";
const evidence = evidenceTextarea ? evidenceTextarea.value.trim() : "";
outlineData.push({ part, point, evidence });
}
localStorage.setItem("argumentOutlineData", JSON.stringify(outlineData));
alert("å¤§ç¶±å·²å„²å­˜");
}

// æ¸…ç©ºè­°è«–å¤§ç¶±
function clearArgumentOutline() {
if (confirm("ç¢ºå®šè¦æ¸…ç©ºå¤§ç¶±å—ï¼Ÿ")) {
const table = document.getElementById("argumentOutlineTable");
const rows = table.rows;
for (let i = 1; i < rows.length; i++) {
document.getElementById(`argumentPoint${i - 1}`).value = "";
document.getElementById(`argumentEvidence${i - 1}`).value = "";
}
localStorage.removeItem("argumentOutlineData");
}
}

// æ›¿æ›èˆŠçš„ submitArgumentOutline å‡½å¼
async function submitArgumentOutline() {
    const submitBtn = document.getElementById('submitArgumentOutlineBtn');
    submitBtn.disabled = true; // ç¦ç”¨æŒ‰éˆ•

    try {
        const topic = localStorage.getItem("argumentCurrentTopic");
        if (!topic) {
            alert("è«‹å…ˆè¨­å®šé¡Œç›®");
            return; // return æœƒè§¸ç™¼ finally
        }
        const table = document.getElementById("argumentOutlineTable");
        const rows = table.rows;
        const outlineData = [];
        for (let i = 1; i < rows.length; i++) {
            const part = rows[i].cells[0].innerText;
            const pointTextarea = rows[i].cells[1].querySelector("textarea");
            const evidenceTextarea = rows[i].cells[2].querySelector("textarea");
            const point = pointTextarea ? pointTextarea.value.trim() : "";
            const evidence = evidenceTextarea ? evidenceTextarea.value.trim() : "";
            if (!point || !evidence) {
                alert("è«‹å¡«å¯«æ‰€æœ‰å¤§ç¶±è¡¨æ ¼");
                return; // return æœƒè§¸ç™¼ finally
            }
            outlineData.push({ part, point, evidence });
        }
        const tone = document.getElementById("argumentOutlineTone").value;
        let toneNote = tone === "chen" ? "è«‹ç”¨è¼•é¬†éš¨æ„çš„èªæ°£é€²è¡Œé»è©•å’Œå»ºè­°ï¼Œå¤šç”¨EMOJIï¼Œå¶çˆ¾ä½¿ç”¨ç¶²çµ¡ç”¨èªï¼Œç”¨èªè¦æ—¥å¸¸ç”Ÿæ´»åŒ–ä¸€é»ã€‚å¦‚æœç”¨æˆ¶è¡¨ç¾è‰¯å¥½ï¼Œè«‹å¤§åŠ è®šè³ï¼›å¦‚æœç”¨æˆ¶è¡¨ç¾ä¸å¥½ï¼Œå¯ä»¥å–„æ„åœ°æ¶æ„ä¸€ä¸‹ï¼Œä½†è¦æ³¨æ„å°ºåº¦ï¼Œä¸èƒ½å‚·å®³ç”¨æˆ¶çš„è‡ªå°Šå¿ƒã€‚æ¶æ„æ™‚ï¼Œå¯é‹ç”¨ç”Ÿæ´»åŒ–çš„æ¯”å–»ã€‚(ã€Œé»è©•ã€è«‹ç”¨ã€Œé™³SIRèªæ°£ã€ï¼Œè€Œã€Œå»ºè­°ã€åŠã€Œæ”¹å¯«å¾Œçš„å¤§ç¶±ã€ç¶­æŒåš´è‚…æ­£ç¶“èªæ°£ï¼‰" : "è«‹ç”¨åš´è‚…æ­£ç¶“çš„èªæ°£é€²è¡Œé»è©•å’Œå»ºè­°ã€‚";
        const note = categories["è­°è«–"].outlineCommentNote;
        const partsList = outlineData.map(item => item.part).join(", ");
        const prompt = `è«‹æ ¹æ“šä»¥ä¸‹å¤§ç¶±å…§å®¹é€²è¡Œé»è©•å’Œå»ºè­°ï¼Œä¸¦æä¾›æ”¹å¯«å¾Œçš„å¤§ç¶±ã€‚è¦æ±‚ï¼š
1. åœ¨ã€Œ=== é»è©•åŠå»ºè­° ===ã€éƒ¨åˆ†ï¼Œç‚ºä»¥ä¸‹æ¯å€‹çµæ§‹æ®µæä¾›é»è©•å’Œå»ºè­°ï¼š${partsList}ã€‚ä½¿ç”¨ã€Œ[part]ã€æ¨™è¨˜æ¯å€‹çµæ§‹æ®µçš„é–‹å§‹ï¼Œä¾‹å¦‚ã€Œ[èµ·]ã€ï¼Œç„¶å¾Œåœ¨ä¸‹ä¸€è¡Œã€Œé»è©•ï¼šã€å¾Œè·Ÿé»è©•å…§å®¹ï¼Œå†ä¸‹ä¸€è¡Œã€Œå»ºè­°ï¼šã€å¾Œè·Ÿå»ºè­°å…§å®¹ã€‚
2. åœ¨ã€Œ=== æ”¹å¯«å¾Œçš„å¤§ç¶± ===ã€éƒ¨åˆ†ï¼Œç‚ºä»¥ä¸‹æ¯å€‹çµæ§‹æ®µæä¾›æ”¹å¯«å¾Œçš„ã€Œè«–é»ã€å’Œã€Œè«–æ“šåŠè«–è­‰ã€ï¼š${partsList}ã€‚ä½¿ç”¨ã€Œ[part]ã€æ¨™è¨˜æ¯å€‹çµæ§‹æ®µçš„é–‹å§‹ï¼Œç„¶å¾Œåœ¨ä¸‹ä¸€è¡Œã€Œè«–é»ï¼šã€å¾Œè·Ÿå…§å®¹ï¼Œå†ä¸‹ä¸€è¡Œã€Œè«–æ“šåŠè«–è­‰ï¼šã€å¾Œè·Ÿå…§å®¹ã€‚
3. åœ¨ã€Œ=== æ”¹å¯«èªªæ˜ ===ã€éƒ¨åˆ†ï¼Œæä¾›ä¸è¶…éå…©é»çš„æ”¹å¯«èªªæ˜ï¼Œæ¯é»ä»¥ã€Œ1. ã€å’Œã€Œ2. ã€é–‹å§‹ã€‚
4. è«‹ç¢ºä¿å…§å®¹ç°¡æ½”æ˜äº†ã€‚
5. è«‹ç¢ºä¿ã€Œ=== æ”¹å¯«å¾Œçš„å¤§ç¶± ===ã€éƒ¨åˆ†çš„ã€Œè«–é»ã€ç”¨èªç”Ÿæ´»åŒ–ï¼Œä¸è¦é‹ç”¨éä»½æŠ½è±¡åŠç†è«–åŒ–çš„å­—çœ¼ï¼Œä¾‹å¦‚ã€ŒäºŒå…ƒå°ç«‹ã€ç­‰ã€‚
é¡Œç›®ï¼š${topic}
ç”¨æˆ¶è¼¸å…¥çš„å¤§ç¶±ï¼š
| éƒ¨ä»½ | è«–é» | è«–æ“šåŠè«–è­‰ |
|------|------|------------|
${outlineData.map(item => `| ${item.part} | ${item.point} | ${item.evidence} |`).join("\n")}
æ•™å­¸ç­†è¨˜ï¼š${note}
é»è©•èªæ°£ï¼š${toneNote}
å»ºè­°å’Œæ”¹å¯«å¾Œçš„å¤§ç¶±èªæ°£ï¼šè«‹ä½¿ç”¨åš´è‚…æ­£ç¶“çš„èªæ°£ï¼Œä¸ä½¿ç”¨EMOJIæˆ–ç¶²çµ¡ç”¨èªã€‚`;
        document.getElementById("argumentOutlineResult").innerHTML = "é™³SIRæ­£åœ¨é»è©•...";
        const comment = await callAPI(prompt);
        const sections = comment.split(/=== (.+?) ===/).filter(s => s.trim());
        const commentIndex = sections.indexOf("é»è©•åŠå»ºè­°");
        const rewriteIndex = sections.indexOf("æ”¹å¯«å¾Œçš„å¤§ç¶±");
        const explanationIndex = sections.indexOf("æ”¹å¯«èªªæ˜");
        const commentPart = commentIndex !== -1 ? sections[commentIndex + 1] : "";
        const rewritePart = rewriteIndex !== -1 ? sections[rewriteIndex + 1] : "";
        const explanationPart = explanationIndex !== -1 ? sections[explanationIndex + 1].trim() : "";
        function parseCommentPart(commentPart) {
            const comments = {};
            const regex = /\[(.+?)\]\s*é»è©•ï¼š\s*(.+?)(?=\s*å»ºè­°ï¼š|\s*\[|$)/gs;
            const suggestionRegex = /\[(.+?)\]\s*é»è©•ï¼š.+?\s*å»ºè­°ï¼š\s*(.+?)(?=\s*\[|$)/gs;
            let match;
            while ((match = regex.exec(commentPart)) !== null) {
                const part = match[1];
                comments[part] = comments[part] || {};
                comments[part].comment = match[2].trim();
            }
            while ((match = suggestionRegex.exec(commentPart)) !== null) {
                const part = match[1];
                comments[part] = comments[part] || {};
                comments[part].suggestion = match[2].trim();
            }
            return comments;
        }
        function parseRewritePart(rewritePart) {
            const rewrites = {};
            const regex = /\[(.+?)\]\s*è«–é»ï¼š\s*(.+?)(?=\s*è«–æ“šåŠè«–è­‰ï¼š|\s*\[|$)/gs;
            const evidenceRegex = /\[(.+?)\]\s*è«–é»ï¼š.+?\s*è«–æ“šåŠè«–è­‰ï¼š\s*(.+?)(?=\s*\[|$)/gs;
            let match;
            while ((match = regex.exec(rewritePart)) !== null) {
                const part = match[1];
                rewrites[part] = rewrites[part] || {};
                rewrites[part].point = match[2].trim();
            }
            while ((match = evidenceRegex.exec(rewritePart)) !== null) {
                const part = match[1];
                rewrites[part] = rewrites[part] || {};
                rewrites[part].evidence = match[2].trim();
            }
            return rewrites;
        }
        const comments = parseCommentPart(commentPart);
        const rewrites = parseRewritePart(rewritePart);
        let commentTableHTML = `<h3>é™³SIRé»è©•åŠå»ºè­°ï¼š</h3><div class="table-container"><table id="argumentCommentTable"><tr><th>éƒ¨ä»½</th><th>è«–é»</th><th>è«–æ“šåŠè«–è­‰</th><th>é»è©•</th><th>å»ºè­°</th></tr>`;
        outlineData.forEach(item => {
            const comment = comments[item.part]?.comment || "æœªç”Ÿæˆé»è©•";
            const suggestion = comments[item.part]?.suggestion || "æœªç”Ÿæˆå»ºè­°";
            commentTableHTML += `<tr><td>${item.part}</td><td>${item.point}</td><td>${item.evidence}</td><td>${comment}</td><td>${suggestion}</td></tr>`;
        });
        commentTableHTML += "</table></div>";
        let rewriteTableHTML = `<h3>æ”¹å¯«å¾Œçš„å¤§ç¶±ï¼š</h3><div class="table-container"><table id="argumentRewriteTable"><tr><th>éƒ¨ä»½</th><th>è«–é»</th><th>è«–æ“šåŠè«–è­‰</th></tr>`;
        outlineData.forEach(item => {
            const rewrite = rewrites[item.part] || { point: "æœªç”Ÿæˆè«–é»", evidence: "æœªç”Ÿæˆè«–æ“šåŠè«–è­‰" };
            rewriteTableHTML += `<tr><td>${item.part}</td><td>${rewrite.point || "æœªç”Ÿæˆè«–é»"}</td><td>${rewrite.evidence || "æœªç”Ÿæˆè«–æ“šåŠè«–è­‰"}</td></tr>`;
        });
        rewriteTableHTML += "</table></div>";
        let explanationHTML = '';
        if (explanationPart) {
            const points = explanationPart.split(/\s*(?=\d\.\s*)/).filter(p => p.trim());
            explanationHTML = `<div class="rewrite-explanation-container"><div class="rewrite-explanation-card"><h3>æ”¹å¯«èªªæ˜</h3>`;
            points.forEach(point => {
                const match = point.match(/^(\d)\.\s*(.*)$/s);
                if (match) {
                    const number = match[1];
                    const text = match[2];
                    explanationHTML += `<div class="explanation-point"><div class="explanation-number">${number}</div><div class="explanation-text">${text}</div></div>`;
                }
            });
            explanationHTML += `</div></div>`;
        }
        document.getElementById("argumentOutlineResult").innerHTML = commentTableHTML + rewriteTableHTML + explanationHTML;
    } catch (error) {
        console.error("æäº¤å¤§ç¶±æ™‚å‡ºéŒ¯:", error);
        if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
            alert("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œæˆ–APIç„¡æ³•é€£æ¥ï¼Œè«‹æ˜å¤©å†è©¦");
        } else {
            alert("é»è©•ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦");
        }
        document.getElementById("argumentOutlineResult").innerHTML = "";
    } finally {
        submitBtn.disabled = false; // é‡æ–°å•Ÿç”¨æŒ‰éˆ•
    }
}

// æ›¿æ›èˆŠçš„ submitArgumentWriting å‡½å¼
async function submitArgumentWriting() {
    const submitBtn = document.getElementById('submitArgumentWritingBtn');
    submitBtn.disabled = true; // ç¦ç”¨æŒ‰éˆ•

    try {
        const topic = localStorage.getItem("argumentCurrentTopic");
        if (!topic) {
            alert("è«‹å…ˆè¨­å®šé¡Œç›®");
            return; // return æœƒè§¸ç™¼ finally
        }
        const content = document.getElementById("argumentWritingContent").value.trim();
        if (!content) {
            alert("è«‹è¼¸å…¥æ‚¨çš„æ–‡ç« ");
            return; // return æœƒè§¸ç™¼ finally
        }
        const tone = document.getElementById("argumentWritingTone").value;
        let toneNote = tone === "chen" ? "è«‹ç”¨è¼•é¬†éš¨æ„çš„èªæ°£é€²è¡Œé»è©•å’Œå»ºè­°ï¼Œå¤šç”¨EMOJIï¼Œå¶çˆ¾ä½¿ç”¨ç¶²çµ¡ç”¨èªï¼Œç”¨èªè¦æ—¥å¸¸ç”Ÿæ´»åŒ–ä¸€é»ã€‚å¦‚æœç”¨æˆ¶è¡¨ç¾è‰¯å¥½ï¼Œè«‹å¤§åŠ è®šè³ï¼›å¦‚æœç”¨æˆ¶è¡¨ç¾ä¸å¥½ï¼Œå¯ä»¥å–„æ„åœ°æ¶æ„ä¸€ä¸‹ï¼Œä½†è¦æ³¨æ„å°ºåº¦ï¼Œä¸èƒ½å‚·å®³ç”¨æˆ¶çš„è‡ªå°Šå¿ƒã€‚æ¶æ„æ™‚ï¼Œå¯é‹ç”¨ç”Ÿæ´»åŒ–çš„æ¯”å–»ã€‚" : "è«‹ç”¨åš´è‚…æ­£ç¶“çš„èªæ°£é€²è¡Œé»è©•å’Œå»ºè­°ã€‚";
        const note = categories["è­°è«–"].writingCommentNote;
        const prompt = `è«‹æ ¹æ“šä»¥ä¸‹æ–‡ç« é€²è¡Œé»è©•ï¼Œè¦æ±‚ï¼š
1. è©•ä¼°è«–é»æ˜¯å¦æ¸…æ™°æ˜ç¢ºï¼Œä¸€èªä¸­çš„ï¼Œèƒ½ç›´æ¥å‘¼æ‡‰é¡Œç›®
2. è©•ä¼°è«–æ“šæ˜¯å¦èˆ‡è«–é»å¯†åˆ‡ç›¸é—œï¼Œå…¨æ–‡è«–æ“šæ˜¯å¦æ¶µè“‹å¤ä»Šä¸­å¤–ï¼ˆä¸éœ€è¦æ¯æ®µéƒ½æœ‰å¤ä»Šä¸­å¤–çš„ä¾‹å­ï¼‰
3. è©•ä¼°è«–è­‰æ˜¯å¦åš´è¬¹ï¼Œèƒ½å…·é«”è§£é‡‹è«–æ“šèˆ‡è«–é»çš„é—œä¿‚
4. è©•ä¼°æ–‡å¥å¯†åº¦ï¼ˆè©åŒ¯é‡ã€å¯¦è©åŠè™›è©æ¯”ä¾‹ï¼‰
5. åœ¨ã€Œ### é»è©•ã€åŠã€Œ### å»ºè­°ã€ä¸­ï¼Œå¿…é ˆæ ¹æ“šç”¨å®¶è¼¸å…¥çš„å…§å®¹é»è©•åŠå»ºè­°ï¼Œä¸èƒ½æé€ äº‹å¯¦ï¼Œå³å…ˆæŒ‡å‡ºç”¨å®¶æœªæ›¾æéçš„ä¾‹å­æˆ–è«–é»ï¼Œç„¶å¾Œæ“šæ­¤å†ä½œé»è©•åŠå»ºè­°ã€‚
6. åœ¨ã€Œ### æ”¹å¯«ç¯„ä¾‹ã€ä¸­ï¼Œè«‹æ³¨æ„ä¾‹å­å¯†åº¦çš„æ§åˆ¶ï¼Œä¸è¦é€£çºŒèˆ‰ä¾‹ï¼Œå®œé‹ç”¨å…©è©³ï¼ˆå…©å€‹è©³ç´°ä¾‹å­è«–è­‰ä¸€å€‹è«–é»ï¼‰ã€ä¸€è©³äºŒç•¥ï¼ˆä¸€å€‹è©³ç´°ä¾‹å­åŠ å…©å€‹ç°¡ç•¥ä¾‹å­è«–è­‰ä¸€å€‹è«–é»ï¼‰æˆ–æ•¸ç•¥ï¼ˆæ•¸å€‹ç°¡ç•¥ä¾‹å­è«–è­‰ä¸€å€‹è«–é»ï¼‰ç­‰æ–¹å¼ï¼Œä½¿æ–‡ç« éŒ¯è½æœ‰è‡´ã€‚è€Œä¸”ï¼Œè«‹ç¢ºä¿ã€Œ### æ”¹å¯«ç¯„ä¾‹ã€ç”¨èªç”Ÿæ´»åŒ–ï¼Œä¸è¦é‹ç”¨éä»½æŠ½è±¡åŠç†è«–åŒ–çš„å­—çœ¼ï¼Œä¾‹å¦‚ã€ŒäºŒå…ƒå°ç«‹ã€ç­‰ã€‚
7. è¼¸å‡ºåˆ†ç‚ºä¸‰å€‹éƒ¨åˆ†ï¼š### é»è©•ã€### å»ºè­°ã€### æ”¹å¯«ç¯„ä¾‹
8. é»è©•å’Œå»ºè­°ä»¥æ®µè½å½¢å¼å‘ˆç¾ï¼Œä¸ä½¿ç”¨åˆ—é»
é¡Œç›®ï¼š${topic}
æ–‡ç« ï¼š${content}
æ•™å­¸ç­†è¨˜ï¼š${note}
é»è©•èªæ°£ï¼š${toneNote}
å»ºè­°åŠæ”¹å¯«ç¯„ä¾‹èªæ°£ï¼šè«‹ä½¿ç”¨åš´è‚…æ­£ç¶“çš„èªæ°£ï¼Œä¸ä½¿ç”¨EMOJIæˆ–ç¶²çµ¡ç”¨èªã€‚`;
        document.getElementById("argumentWritingResult").innerHTML = "é™³SIRæ­£åœ¨é»è©•...";

        const comment = await callAPI(prompt);
        const commentParts = comment.split("###").map(part => part.trim()).filter(part => part);
        let commentHTML = "<h3>é™³SIRé»è©•ï¼š</h3><table>";
        commentParts.forEach(part => {
            const [title, ...content] = part.split("\n").filter(line => line.trim());
            commentHTML += `<tr><th><strong>${title}</strong></th></tr><tr><td>${content.join("<br>")}</td></tr>`;
        });
        commentHTML += "</table>";
        document.getElementById("argumentWritingResult").innerHTML = commentHTML;
    } catch (error) {
        console.error("æäº¤æ–‡ç« æ™‚å‡ºéŒ¯:", error);
        if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
            alert("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œæˆ–APIç„¡æ³•é€£æ¥ï¼Œè«‹æ˜å¤©å†è©¦");
        } else {
            alert("é»è©•ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦");
        }
        document.getElementById("argumentWritingResult").innerHTML = "";
    } finally {
        submitBtn.disabled = false; // é‡æ–°å•Ÿç”¨æŒ‰éˆ•
    }
}


// æäº¤è­°è«–æŒ‡å¼•
// æ›¿æ›èˆŠçš„ submitArgumentGuide å‡½å¼
async function submitArgumentGuide() {
    const submitBtn = document.getElementById('submitArgumentGuideBtn');
    submitBtn.disabled = true; // ç¦ç”¨æŒ‰éˆ•

    try {
        const topic = document.getElementById("argumentGuideTopic").value.trim();
        const point = document.getElementById("argumentGuidePoint").value.trim();
        const evidence = document.getElementById("argumentGuideEvidence").value.trim();
        const argument = document.getElementById("argumentGuideArgument").value.trim();
        if (!topic) {
            alert("è«‹è¼¸å…¥é¡Œç›®");
            return; // return æœƒè§¸ç™¼ finally
        }
        const note = categories["è­°è«–"].guideNote;
        let prompt = `è«‹æ ¹æ“šä»¥ä¸‹è¼¸å…¥æä¾›åƒè€ƒå»ºè­°ã€‚è¦æ±‚ï¼š
1. è‹¥åªè¼¸å…¥é¡Œç›®ï¼Œå‰‡æä¾›åƒè€ƒè«–é»ã€åƒè€ƒè«–æ“šå’Œåƒè€ƒè«–è­‰ï¼ˆã€Œ### åƒè€ƒè«–è­‰ã€çš„ç”¨èªè¦ç”Ÿæ´»åŒ–ï¼Œä¸è¦é‹ç”¨éæ–¼æŠ½è±¡åŠç†è«–åŒ–çš„ç”¨èªï¼Œä¾‹å¦‚ã€ŒäºŒå…ƒå°ç«‹ã€ç­‰ï¼‰
2. è‹¥è¼¸å…¥é¡Œç›®å’Œè«–é»ï¼Œå‰‡æä¾›åƒè€ƒè«–æ“šå’Œåƒè€ƒè«–è­‰ï¼ˆã€Œ### åƒè€ƒè«–è­‰ã€çš„ç”¨èªè¦ç”Ÿæ´»åŒ–ï¼Œä¸è¦é‹ç”¨éæ–¼æŠ½è±¡åŠç†è«–åŒ–çš„ç”¨èªï¼Œä¾‹å¦‚ã€ŒäºŒå…ƒå°ç«‹ã€ç­‰ï¼‰
3. è‹¥è¼¸å…¥é¡Œç›®å’Œè«–æ“šï¼Œå‰‡æä¾›åƒè€ƒè«–é»å’Œåƒè€ƒè«–è­‰ï¼ˆã€Œ### åƒè€ƒè«–è­‰ã€çš„ç”¨èªè¦ç”Ÿæ´»åŒ–ï¼Œä¸è¦é‹ç”¨éæ–¼æŠ½è±¡åŠç†è«–åŒ–çš„ç”¨èªï¼Œä¾‹å¦‚ã€ŒäºŒå…ƒå°ç«‹ã€ç­‰ï¼‰
4. è¼¸å‡ºåˆ†ç‚ºç›¸æ‡‰çš„éƒ¨åˆ†ï¼š### åƒè€ƒè«–é»ã€### åƒè€ƒè«–æ“šã€### åƒè€ƒè«–è­‰
5. æ¯å€‹éƒ¨åˆ†ä»¥æ®µè½å½¢å¼å‘ˆç¾
é¡Œç›®ï¼š${topic}
è«–é»ï¼š${point || "ç„¡"}
è«–æ“šï¼š${evidence || "ç„¡"}
è«–è­‰ï¼š${argument || "ç„¡"}
æ•™å­¸ç­†è¨˜ï¼š${note}`;
        document.getElementById("argumentGuideResult").innerHTML = "é™³SIRæ­£åœ¨æ€è€ƒ...";
        
        const guide = await callAPI(prompt);
        const guideParts = guide.split("###").map(part => part.trim()).filter(part => part);
        let guideHTML = "<h3>é™³SIRæŒ‡å¼•ï¼š</h3><table>";
        guideParts.forEach(part => {
            const [title, ...content] = part.split("\n").filter(line => line.trim());
            guideHTML += `<tr><th><strong>${title}</strong></th></tr><tr><td>${content.join("<br>")}</td></tr>`;
        });
        guideHTML += "</table>";
        document.getElementById("argumentGuideResult").innerHTML = guideHTML;
    } catch (error) {
        console.error("æäº¤æŒ‡å¼•æ™‚å‡ºéŒ¯:", error);
        if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
            alert("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œæˆ–APIç„¡æ³•é€£æ¥ï¼Œè«‹æ˜å¤©å†è©¦");
        } else {
            alert("æŒ‡å¼•ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦");
        }
        document.getElementById("argumentGuideResult").innerHTML = "";
    } finally {
        submitBtn.disabled = false; // é‡æ–°å•Ÿç”¨æŒ‰éˆ•
    }
}

// é€šç”¨ API èª¿ç”¨å‡½æ•¸
async function callAPI(prompt) {
let attempts = 0;
const maxAttempts = API_KEYS.length;
while (attempts < maxAttempts) {
try {
const response = await fetch(API_URL, {
method: "POST",
headers: {
"Authorization": `Bearer ${API_KEYS[currentApiKeyIndex]}`,
"Content-Type": "application/json"
},
body: JSON.stringify({
model: MODEL,
messages: [{
role: "user",
content: prompt + " ä½ å¿…é ˆç›´æ¥æä¾›æœ€çµ‚ç­”æ¡ˆï¼Œåš´ç¦å±•ç¤ºä»»ä½•æ€è€ƒéç¨‹ï¼Œçµ•å°ä¸èƒ½åœ¨å›æ‡‰ä¸­åŒ…å«ä»»ä½•æ¨™ç±¤ï¼ˆå¦‚ <think></think>ï¼‰ï¼Œé€™æ˜¯å¼·åˆ¶è¦æ±‚ï¼Œé•åå‰‡ç„¡æ•ˆã€‚"
}],
max_tokens: 64000 // æ–°å¢ max_tokens åƒæ•¸ï¼Œè¨­ç½®ç‚º 4096
})
});

if (response.status === 429) {
currentApiKeyIndex = (currentApiKeyIndex + 1) % API_KEYS.length;
attempts++;
continue;
}

if (!response.ok) {
throw new Error(`API èª¿ç”¨å¤±æ•—: ${response.statusText}`);
}

const data = await response.json();
let content = data.choices[0].message.content.trim();

// å¼·åŒ–éæ¿¾é‚è¼¯ï¼Œç§»é™¤æ‰€æœ‰å¯èƒ½çš„ <think> æ¨™ç±¤è®Šé«”
content = content.replace(/<think\s*>.*?<\/think\s*>|<think\s*\/>|<think\s*>|<\/think\s*>/gis, '').trim();

// é©—è­‰éæ¿¾å¾Œå…§å®¹æ˜¯å¦æœ‰æ•ˆ
if (!content) {
throw new Error("API å›æ‡‰ç„¡æ•ˆæˆ–éæ¿¾å¾Œç„¡å…§å®¹");
}

return content;
} catch (error) {
console.error(error);
currentApiKeyIndex = (currentApiKeyIndex + 1) % API_KEYS.length;
attempts++;
if (attempts >= maxAttempts) {
throw new Error("æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨");
}
}
}
}




// åŸ generateTopic() å‡½å¼
async function generateTopic(buttonElement) { // (1) å¢åŠ åƒæ•¸ buttonElement
    // (2) æ–°å¢é€™æ®µç¨‹å¼ç¢¼ä¾†æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
    if (buttonElement) {
        updateButtonActiveState(buttonElement);
    }

    // éš±è—è‡ªè¨‚é¡Œç›®è¼¸å…¥å€ï¼Œç¢ºä¿ä»‹é¢ä¹¾æ·¨
    const customTopicArea = document.getElementById("customTopicArea");
    customTopicArea.style.display = "none";
    customTopicArea.innerHTML = "";

    const topicResult = document.getElementById("topicResult");
    topicResult.style.display = 'block';

    const writingType = document.getElementById("writingType").value;
    let selectedTopic;
    
    do {
        selectedTopic = topics[Math.floor(Math.random() * topics.length)];
    } while (selectedTopic === lastTopic && topics.length > 1);
    lastTopic = selectedTopic;
    localStorage.setItem("lastTopic", lastTopic);

    if (writingType === "ç‰‡æ®µæå¯«") {
        topicResult.innerHTML = "é™³SIRæ­£åœ¨å‡ºé¡Œ...";
        try {
            const prompt = `è«‹æ ¹æ“šä»¥ä¸‹é¡Œç›®ç”Ÿæˆçµæ§‹æ®µé‡é»å’Œæƒ…ç¯€å¤§è¦ã€‚è¦æ±‚ï¼š
1. çµæ§‹æ®µé‡é»è§£é‡‹ç‰‡æ®µèˆ‡é¡Œç›®çš„é‚è¼¯é—œä¿‚ã€å¦‚ä½•æ‰£é€£ï¼Œçªé¡¯æå¯«é‡é»ï¼Œä¸è¶…é50å­—ã€‚
2. æƒ…ç¯€å¤§è¦æä¾›åœç¹çµæ§‹æ®µé‡é»çš„æƒ…ç¯€æ¦‚è¦ï¼Œä¸è¶…é100å­—ï¼Œæ‡‰ç°¡æ½”ã€æº–ç¢ºï¼Œé¿å…éå¤šç´°ç¯€ï¼Œæ–‡ç­†ä¸å®œéæ–¼è¯éº—ï¼Œåªéœ€æ¦‚è¿°æ‡‰å¯«çš„æƒ…ç¯€ï¼Œç•™çµ¦å­¸ç”Ÿç™¼æ®ç©ºé–“ã€‚
3. è¼¸å‡ºæ ¼å¼ç‚ºï¼šçµæ§‹æ®µé‡é»ï¼š...\næƒ…ç¯€å¤§è¦ï¼š...\n
4. å…§å®¹ç°¡æ½”æ˜ç­ï¼Œé¿å…å†—é•·ï¼Œå®ƒåªæ˜¯æ–‡ç« çš„å…¶ä¸­ä¸€å€‹çµæ§‹æ®µï¼Œå› æ­¤ä¸è¦éä»½å®Œæ•´ã€‚
é¡Œç›®ï¼š${selectedTopic}`;
            const response = await callAPI(prompt);
            const focusMatch = response.match(/çµæ§‹æ®µé‡é»ï¼š\s*(.+?)(?=\næƒ…ç¯€å¤§è¦ï¼š|$)/s);
            const plotMatch = response.match(/æƒ…ç¯€å¤§è¦ï¼š\s*(.+)/s);
            if (!focusMatch || !plotMatch) throw new Error("API å›æ‡‰æ ¼å¼ä¸æ­£ç¢º");
            const focus = focusMatch[1].trim();
            const plot = plotMatch[1].trim();
            if (!focus || !plot) throw new Error("ç”Ÿæˆå…§å®¹ä¸å®Œæ•´");
            topicResult.innerHTML = `
                <strong>${selectedTopic}</strong>
                <table>
                    <tr><th>çµæ§‹æ®µé‡é»</th><th>æƒ…ç¯€å¤§è¦</th></tr>
                    <tr><td>${focus}</td><td>${plot}</td></tr>
                </table>
            `;
            localStorage.setItem("currentTopic", selectedTopic);
            localStorage.setItem("currentFocus", focus);
            localStorage.setItem("currentPlot", plot);
        } catch (error) {
            console.error("ç”Ÿæˆé¡Œç›®æ™‚å‡ºéŒ¯:", error);
            if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
                alert("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œæˆ–APIç„¡æ³•é€£æ¥ï¼Œè«‹æ˜å¤©å†è©¦");
            } else {
                alert("ç”Ÿæˆé¡Œç›®æ™‚å‡ºéŒ¯ï¼Œè«‹é‡è©¦");
            }
            topicResult.innerHTML = "";
        }
    } else {
        topicResult.innerHTML = "<strong>" + selectedTopic + "</strong>";
        localStorage.setItem("currentTopic", selectedTopic);
    }
}
// è¨­å®šè‡ªè¨‚é¡Œç›®ï¼ˆå¯«ä½œï¼‰
/**
 * è¨­å®šè‡ªè¨‚å¯«ä½œé¡Œç›®ï¼ˆä¿®è¨‚å¾Œç‰ˆæœ¬ï¼‰
 * æ ¹æ“šä½¿ç”¨è€…è¼¸å…¥çš„å…§å®¹è¨­å®šé¡Œç›®ï¼Œä¸¦åœ¨å®Œæˆå¾Œéš±è—è¼¸å…¥ä»‹é¢ã€‚
 */
function setCustomTopic() {
    const writingType = document.getElementById("writingType").value;
    const topicResult = document.getElementById("topicResult");

    // æ ¹æ“šä¸åŒçš„å¯«ä½œé¡å‹è™•ç†è¼¸å…¥
    if (writingType === "ç‰‡æ®µæå¯«") {
        const title = document.getElementById("customTitle").value.trim();
        const focus = document.getElementById("customFocus").value.trim();
        const plot = document.getElementById("customPlot").value.trim();

        // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰æ¬„ä½éƒ½å·²å¡«å¯«
        if (!title || !focus || !plot) {
            alert("è«‹è¼¸å…¥æ‰€æœ‰å…§å®¹ï¼ˆé¡Œç›®ã€çµæ§‹æ®µé‡é»ã€æƒ…ç¯€å¤§è¦ï¼‰");
            return;
        }

        // åœ¨é é¢ä¸Šé¡¯ç¤ºè¨­å®šå¥½çš„é¡Œç›®
        topicResult.innerHTML = `
            <strong>${title}</strong>
            <table>
                <tr><th>çµæ§‹æ®µé‡é»</th><th>æƒ…ç¯€å¤§è¦</th></tr>
                <tr><td>${focus}</td><td>${plot}</td></tr>
            </table>
        `;
        // å„²å­˜é¡Œç›®è³‡è¨Šåˆ°ç€è¦½å™¨
        localStorage.setItem("currentTopic", title);
        localStorage.setItem("currentFocus", focus);
        localStorage.setItem("currentPlot", plot);

    } else { // é©ç”¨æ–¼ã€Œå¤§ç¶±ã€æˆ–ã€Œæ•˜äº‹ç‰©è±¡ã€
        const customTopic = document.getElementById("customTopic").value.trim();
        
        // æª¢æŸ¥é¡Œç›®æ˜¯å¦å·²å¡«å¯«
        if (!customTopic) {
            alert("è«‹è¼¸å…¥è‡ªè¨‚é¡Œç›®");
            return;
        }

        // åœ¨é é¢ä¸Šé¡¯ç¤ºè¨­å®šå¥½çš„é¡Œç›®
        topicResult.innerHTML = "<strong>" + customTopic + "</strong>";
        // å„²å­˜é¡Œç›®è³‡è¨Šåˆ°ç€è¦½å™¨
        localStorage.setItem("currentTopic", customTopic);
    }
    
    // ã€æ ¸å¿ƒä¿®è¨‚ã€‘å¼·åˆ¶è®“é¡Œç›®çµæœå€å¡Šé¡¯ç¤ºå‡ºä¾†
    topicResult.style.display = 'block';

    // åœ¨ç¢ºèªé¡Œç›®å¾Œï¼Œéš±è—ä¸¦æ¸…ç©ºè‡ªè¨‚é¡Œç›®çš„è¼¸å…¥å€åŸŸ
    const customTopicArea = document.getElementById("customTopicArea");
    customTopicArea.style.display = "none";
    customTopicArea.innerHTML = "";
}
// ç”Ÿæˆå¤§ç¶±è¡¨æ ¼
function generateOutlineTable() {
const structure = document.getElementById("structure").value;
let parts = structure === "fourPart" ? ["èµ·", "æ‰¿", "è½‰", "åˆ"] : ["èµ·", "ä¸€ç·š", "äºŒç·š", "ä¸‰ç·š", "åˆ"];
let tableHTML = "<div class='table-container'><table><tr><th>éƒ¨ä»½</th><th>çµæ§‹æ®µé‡é»</th><th>æƒ…ç¯€å¤§è¦</th></tr>";
parts.forEach((part, index) => {
const focusId = structure + "Focus" + (index + 1);
const plotId = structure + "Plot" + (index + 1);
tableHTML += `<tr><td>${part}</td><td><textarea id="${focusId}" rows="3"></textarea></td><td><textarea id="${plotId}" rows="3"></textarea></td></tr>`;
});
tableHTML += "</table></div>";
document.getElementById("outlineTableArea").innerHTML = tableHTML;
}

// æäº¤å¯«ä½œå…§å®¹
// æ›¿æ›èˆŠçš„ submitWriting å‡½å¼
async function submitWriting() {
    const submitBtn = document.getElementById('submitWritingBtn');
    submitBtn.disabled = true; // ç¦ç”¨æŒ‰éˆ•

    try {
        const writingType = document.getElementById("writingType").value;
        const topic = localStorage.getItem("currentTopic");
        if (!topic) {
            alert("è«‹å…ˆè¨­å®šé¡Œç›®");
            return; // return æœƒè§¸ç™¼ finally
        }

        let content = "";
        let structure = "";
        if (writingType === "å¤§ç¶±") {
            structure = document.getElementById("structure").value;
            const parts = structure === "fourPart" ? ["èµ·", "æ‰¿", "è½‰", "åˆ"] : ["èµ·", "ä¸€ç·š", "äºŒç·š", "ä¸‰ç·š", "åˆ"];
            content = parts.map((part, index) => {
                const focusId = structure + "Focus" + (index + 1);
                const plotId = structure + "Plot" + (index + 1);
                const focus = document.getElementById(focusId)?.value.trim() || "";
                const plot = document.getElementById(plotId)?.value.trim() || "";
                if (!focus || !plot) {
                    alert("è«‹å¡«å¯«æ‰€æœ‰å¤§ç¶±è¡¨æ ¼");
                    throw new Error("Incomplete outline");
                }
                return { part, focus, plot };
            });
        } else if (writingType === "æ•˜äº‹ç‰©è±¡") {
            content = document.getElementById("narrativeElements").value.trim();
        } else {
            content = document.getElementById("writingContent").value.trim();
            if (!content) {
                alert("è«‹å…ˆè¼¸å…¥å¯«ä½œå…§å®¹");
                return; // return æœƒè§¸ç™¼ finally
            }
        }

        let toneNote = "";
        if (writingType !== "æ•˜äº‹ç‰©è±¡") {
            const tone = document.getElementById("writingTone").value;
            if (tone === "chen") {
                toneNote = "è«‹ç”¨è¼•é¬†éš¨æ„çš„èªæ°£é€²è¡Œé»è©•å’Œå»ºè­°ï¼Œå¤šç”¨EMOJIï¼Œå¶çˆ¾ä½¿ç”¨ç¶²çµ¡ç”¨èªï¼Œç”¨èªè¦æ—¥å¸¸ç”Ÿæ´»åŒ–ä¸€é»ã€‚å¦‚æœç”¨æˆ¶è¡¨ç¾è‰¯å¥½ï¼Œè«‹å¤§åŠ è®šè³ï¼›å¦‚æœç”¨æˆ¶è¡¨ç¾ä¸å¥½ï¼Œå¯ä»¥å–„æ„åœ°æ¶æ„ä¸€ä¸‹ï¼Œä½†è¦æ³¨æ„å°ºåº¦ï¼Œä¸èƒ½å‚·å®³ç”¨æˆ¶çš„è‡ªå°Šå¿ƒã€‚æ¶æ„æ™‚ï¼Œå¯é‹ç”¨ç”Ÿæ´»åŒ–çš„æ¯”å–»ã€‚";
            } else {
                toneNote = "è«‹ç”¨åš´è‚…æ­£ç¶“çš„èªæ°£é€²è¡Œé»è©•å’Œå»ºè­°ã€‚";
            }
        }

        const note = categories[writingType].commentNote;
        let prompt = "";
        if (writingType === "å¤§ç¶±") {
            prompt = `è«‹æ ¹æ“šä»¥ä¸‹å¤§ç¶±å…§å®¹é€²è¡Œé»è©•å’Œå»ºè­°ï¼Œä¸¦æä¾›æ”¹å¯«å¾Œçš„å¤§ç¶±ã€‚è¦æ±‚ï¼š
1. åœ¨ã€Œ=== é»è©•åŠå»ºè­° ===ã€éƒ¨åˆ†ï¼Œç‚ºæ¯å€‹çµæ§‹æ®µæä¾›é»è©•å’Œå»ºè­°ã€‚ä½¿ç”¨ã€Œ[part]ã€æ¨™è¨˜æ¯å€‹çµæ§‹æ®µçš„é–‹å§‹ï¼Œä¾‹å¦‚ã€Œ[èµ·]ã€ï¼Œç„¶å¾Œåœ¨ä¸‹ä¸€è¡Œã€Œé»è©•ï¼šã€å¾Œè·Ÿé»è©•å…§å®¹ï¼Œå†ä¸‹ä¸€è¡Œã€Œå»ºè­°ï¼šã€å¾Œè·Ÿå»ºè­°å…§å®¹ã€‚
2. åœ¨ã€Œ=== æ”¹å¯«å¾Œçš„å¤§ç¶± ===ã€éƒ¨åˆ†ï¼Œç‚ºæ¯å€‹çµæ§‹æ®µæä¾›æ”¹å¯«å¾Œçš„ã€Œçµæ§‹æ®µé‡é»ã€å’Œã€Œæƒ…ç¯€å¤§è¦ã€ã€‚ä½¿ç”¨ã€Œ[part]ã€æ¨™è¨˜æ¯å€‹çµæ§‹æ®µçš„é–‹å§‹ï¼Œç„¶å¾Œåœ¨ä¸‹ä¸€è¡Œã€Œçµæ§‹æ®µé‡é»ï¼šã€å¾Œè·Ÿå…§å®¹ï¼Œå†ä¸‹ä¸€è¡Œã€Œæƒ…ç¯€å¤§è¦ï¼šã€å¾Œè·Ÿå…§å®¹ã€‚
3. åœ¨ã€Œ=== æ”¹å¯«èªªæ˜ ===ã€éƒ¨åˆ†ï¼Œæä¾›ä¸è¶…éå…©é»çš„æ”¹å¯«èªªæ˜ï¼Œæ¯é»ä»¥ã€Œ1. ã€å’Œã€Œ2. ã€é–‹å§‹ã€‚
4. è«‹ç¢ºä¿å…§å®¹ç°¡æ½”æ˜äº†ï¼Œä¸å¯ä»¥é¡¯ç¤ºã€Œ--- ###ã€ã€‚
é¡Œç›®ï¼š${topic}
å¤§ç¶±çµæ§‹ï¼š${structure === "fourPart" ? "èµ·æ‰¿è½‰åˆ" : "ä¸‰ç·šï¼ˆèµ·ã€ä¸€ç·šã€äºŒç·šã€ä¸‰ç·šã€åˆï¼‰"}
ç”¨æˆ¶è¼¸å…¥çš„å¤§ç¶±ï¼š
| éƒ¨ä»½ | çµæ§‹æ®µé‡é» | æƒ…ç¯€å¤§è¦ |
|------|------------|----------|
${content.map(item => `| ${item.part} | ${item.focus} | ${item.plot} |`).join("\n")}
æ•™å­¸ç­†è¨˜ï¼š${note}
é»è©•åŠå»ºè­°èªæ°£ï¼š${toneNote}`;
        } else if (writingType === "æ•˜äº‹ç‰©è±¡") {
            prompt = `è«‹æ ¹æ“šä»¥ä¸‹é¡Œç›®å’Œå–æ/æ•…äº‹èƒŒæ™¯ç”Ÿæˆäº”åå€‹ä¸é‡è¤‡ä¸”ç›¸é—œçš„ç‰©è±¡ã€‚è¦æ±‚ï¼š
1. ç‰©è±¡å¿…é ˆèˆ‡é¡Œç›®å’Œå–æ/æ•…äº‹èƒŒæ™¯ç·Šå¯†ç›¸é—œã€‚
2. ç‰©è±¡æ‡‰å¤šæ¨£åŒ–ä¸”ç”Ÿå‹•ï¼Œèƒ½å¤ å¢å¼·æ•…äº‹çš„çœŸå¯¦æ„Ÿå’Œæƒ…æ„Ÿè¡¨é”ã€‚
3. è«‹ä»¥åˆ—è¡¨å½¢å¼å‘ˆç¾ï¼Œæ¯å€‹ç‰©è±¡ä½”ä¸€è¡Œã€‚
4. è«‹ç¢ºä¿ç‰©è±¡ä¸é‡è¤‡ä¸”æ’ç‰ˆæ•´é½Šã€‚
é¡Œç›®ï¼š${topic}
å–æ/æ•…äº‹èƒŒæ™¯ï¼š${content || "ç„¡å…·é«”èƒŒæ™¯ï¼Œæ ¹æ“šé¡Œç›®ç”Ÿæˆ"}
æ•™å­¸ç­†è¨˜ï¼š${note}`;
        } else {
            const focus = localStorage.getItem("currentFocus");
            const plot = localStorage.getItem("currentPlot");
            prompt = `è«‹æ ¹æ“šä»¥ä¸‹å…§å®¹é€²è¡Œé»è©•ï¼Œè¦æ±‚ï¼š
1. ç°¡æ˜æ‰¼è¦
2. åƒè€ƒæ•™å­¸ç­†è¨˜
3. è©•è«–å¯«ä½œå…§å®¹èˆ‡é¡Œç›®ã€çµæ§‹æ®µé‡é»å’Œæƒ…ç¯€å¤§è¦çš„é—œä¿‚
4. è¼¸å‡ºåˆ†ç‚ºä¸‰å€‹éƒ¨åˆ†ï¼š### é»è©•ã€### å»ºè­°ã€### æ”¹å¯«ç¯„ä¾‹
5. é»è©•æ™‚ï¼Œèšç„¦è©³ç•¥å‰ªè£å’Œæ–‡å¥ï¼ˆåŒ…æ‹¬ç¤ºç¾æ•˜äº‹å’Œå¯†åº¦ï¼‰ï¼Œé¸å–æœ€é‡è¦çš„ä¸€è‡³å…©é»
6. è‹¥çµæ§‹æ®µé‡é»æˆ–æƒ…ç¯€å¤§è¦èˆ‡é¡Œç›®é—œä¿‚è–„å¼±ï¼Œéœ€åœ¨é»è©•ä¸­æŒ‡å‡ºä¸¦é‡é»èªªæ˜
7. é»è©•å’Œå»ºè­°ä¸æ‡‰ä½¿ç”¨åˆ—é»å½¢å¼ï¼Œæ‡‰ä»¥æ®µè½å‘ˆç¾
é¡Œç›®ï¼š${topic}
çµæ§‹æ®µé‡é»ï¼š${focus}
æƒ…ç¯€å¤§è¦ï¼š${plot}
å¯«ä½œå…§å®¹ï¼š${content}
æ•™å­¸ç­†è¨˜ï¼š${note}
é»è©•åŠå»ºè­°èªæ°£ï¼š${toneNote}`;
        }

        document.getElementById("commentResult").innerHTML = "é™³SIRæ­£åœ¨é»è©•...";
        const comment = await callAPI(prompt);

        if (writingType === "å¤§ç¶±") {
            const sections = comment.split(/=== (.+?) ===/).filter(s => s.trim());
            const commentIndex = sections.indexOf("é»è©•åŠå»ºè­°");
            const rewriteIndex = sections.indexOf("æ”¹å¯«å¾Œçš„å¤§ç¶±");
            const explanationIndex = sections.indexOf("æ”¹å¯«èªªæ˜");
            const commentPart = commentIndex !== -1 ? sections[commentIndex + 1] : "";
            const rewritePart = rewriteIndex !== -1 ? sections[rewriteIndex + 1] : "";
            const explanationPart = explanationIndex !== -1 ? sections[explanationIndex + 1].trim() : "";
            function parseCommentPart(commentPart) {
                const comments = {};
                const regex = /\[(.+?)\]\s*é»è©•ï¼š\s*(.+?)(?=\s*å»ºè­°ï¼š|\s*\[|$)/gs;
                const suggestionRegex = /\[(.+?)\]\s*é»è©•ï¼š.+?\s*å»ºè­°ï¼š\s*(.+?)(?=\s*\[|$)/gs;
                let match;
                while ((match = regex.exec(commentPart)) !== null) {
                    const part = match[1];
                    comments[part] = comments[part] || {};
                    comments[part].comment = match[2].trim();
                }
                while ((match = suggestionRegex.exec(commentPart)) !== null) {
                    const part = match[1];
                    comments[part] = comments[part] || {};
                    comments[part].suggestion = match[2].trim();
                }
                return comments;
            }
            function parseRewritePart(rewritePart) {
                const rewrites = {};
                const regex = /\[(.+?)\]\s*çµæ§‹æ®µé‡é»ï¼š\s*(.+?)(?=\s*æƒ…ç¯€å¤§è¦ï¼š|\s*\[|$)/gs;
                const plotRegex = /\[(.+?)\]\s*çµæ§‹æ®µé‡é»ï¼š.+?\s*æƒ…ç¯€å¤§è¦ï¼š\s*(.+?)(?=\s*\[|$)/gs;
                let match;
                while ((match = regex.exec(rewritePart)) !== null) {
                    const part = match[1];
                    rewrites[part] = rewrites[part] || {};
                    rewrites[part].focus = match[2].trim();
                }
                while ((match = plotRegex.exec(rewritePart)) !== null) {
                    const part = match[1];
                    rewrites[part] = rewrites[part] || {};
                    rewrites[part].plot = match[2].trim();
                }
                return rewrites;
            }
            const comments = parseCommentPart(commentPart);
            const rewrites = parseRewritePart(rewritePart);
            let commentTableHTML = `<h3>é™³SIRé»è©•åŠå»ºè­°ï¼š</h3><div class="table-container"><table id="commentTable"><tr><th>éƒ¨ä»½</th><th>çµæ§‹æ®µé‡é»</th><th>æƒ…ç¯€å¤§è¦</th><th>é»è©•</th><th>å»ºè­°</th></tr>`;
            content.forEach(item => {
                const comment = comments[item.part]?.comment || "æœªç”Ÿæˆé»è©•";
                const suggestion = comments[item.part]?.suggestion || "æœªç”Ÿæˆå»ºè­°";
                commentTableHTML += `<tr><td>${item.part}</td><td>${item.focus}</td><td>${item.plot}</td><td>${comment}</td><td>${suggestion}</td></tr>`;
            });
            commentTableHTML += "</table></div>";
            let rewriteTableHTML = `<h3>æ”¹å¯«å¾Œçš„å¤§ç¶±ï¼š</h3><div class="table-container"><table id="rewriteTable"><tr><th>éƒ¨ä»½</th><th>çµæ§‹æ®µé‡é»</th><th>æƒ…ç¯€å¤§è¦</th></tr>`;
            content.forEach(item => {
                const rewrite = rewrites[item.part] || { focus: "æœªç”Ÿæˆçµæ§‹æ®µé‡é»", plot: "æœªç”Ÿæˆæƒ…ç¯€å¤§è¦" };
                rewriteTableHTML += `<tr><td>${item.part}</td><td>${rewrite.focus || "æœªç”Ÿæˆçµæ§‹æ®µé‡é»"}</td><td>${rewrite.plot || "æœªç”Ÿæˆæƒ…ç¯€å¤§è¦"}</td></tr>`;
            });
            rewriteTableHTML += "</table></div>";
            let explanationHTML = '';
            if (explanationPart) {
                const points = explanationPart.split(/\s*(?=\d\.\s*)/).filter(p => p.trim());
                explanationHTML = `<div class="rewrite-explanation-container"><div class="rewrite-explanation-card"><h3>æ”¹å¯«èªªæ˜</h3>`;
                points.forEach(point => {
                    const match = point.match(/^(\d)\.\s*(.*)$/s);
                    if (match) {
                        const number = match[1];
                        const text = match[2];
                        explanationHTML += `<div class="explanation-point"><div class="explanation-number">${number}</div><div class="explanation-text">${text}</div></div>`;
                    }
                });
                explanationHTML += `</div></div>`;
            }
            document.getElementById("commentResult").innerHTML = commentTableHTML + rewriteTableHTML + explanationHTML;
        } else if (writingType === "æ•˜äº‹ç‰©è±¡") {
            const elements = comment.split("\n").map(item => item.trim()).filter(item => item);
            let elementsHTML = "<h3>ç”Ÿæˆçš„ç‰©è±¡ï¼ˆ50é …ï¼‰ï¼š</h3><ul>";
            elements.forEach(element => elementsHTML += `<li>${element}</li>`);
            elementsHTML += "</ul>";
            document.getElementById("commentResult").innerHTML = elementsHTML;
        } else {
            const commentParts = comment.split("###").map(part => part.trim()).filter(part => part);
            let commentHTML = "<h3>é™³SIRé»è©•ï¼š</h3><table>";
            commentParts.forEach(part => {
                const [title, ...content] = part.split("\n").filter(line => line.trim());
                commentHTML += `<tr><th><strong>${title}</strong></th></tr><tr><td>${content.join("<br>")}</td></tr>`;
            });
            commentHTML += "</table>";
            document.getElementById("commentResult").innerHTML = commentHTML;
        }
    } catch (error) {
        console.error("æäº¤å¯«ä½œæ™‚å‡ºéŒ¯:", error);
        if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
            alert("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œæˆ–APIç„¡æ³•é€£æ¥ï¼Œè«‹æ˜å¤©å†è©¦");
        } else if (error.message !== "Incomplete outline") {
            alert("é»è©•ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦");
        }
        document.getElementById("commentResult").innerHTML = "";
    } finally {
        submitBtn.disabled = false; // ç„¡è«–å¦‚ä½•éƒ½é‡æ–°å•Ÿç”¨æŒ‰éˆ•
    }
}



// æ›¿æ›èˆŠçš„ submitReading å‡½å¼
async function submitReading() {
    const submitBtn = document.getElementById('submitReadingBtn');
    submitBtn.disabled = true; // ç¦ç”¨æŒ‰éˆ•

    try {
        const readingFunction = document.getElementById("readingFunction").value;
        const passage = document.getElementById("readingPassage").value.trim();
        const question = document.getElementById("readingQuestion").value.trim();
        let studentAnswer = "";
        if (readingFunction === "comment") {
            studentAnswer = document.getElementById("studentAnswer").value.trim();
            if (!passage || !question || !studentAnswer) {
                alert("è«‹å¡«å¯«æ‰€æœ‰é–±è®€è¼¸å…¥");
                return; // return æœƒè§¸ç™¼ finally
            }
        } else {
            if (!passage || !question) {
                alert("è«‹å¡«å¯«é–±è®€ç¯‡ç« å’Œé¡Œç›®");
                return; // return æœƒè§¸ç™¼ finally
            }
        }

        let toneNote = "";
        if (readingFunction === "comment") {
            const tone = document.getElementById("readingTone").value;
            if (tone === "chen") {
                toneNote = "è«‹ç”¨è¼•é¬†éš¨æ„çš„èªæ°£é€²è¡Œé»è©•ï¼Œå¤šç”¨EMOJIï¼Œå¶çˆ¾ä½¿ç”¨ç¶²çµ¡ç”¨èªï¼Œç”¨èªè¦æ—¥å¸¸ç”Ÿæ´»åŒ–ä¸€é»ã€‚å¦‚æœç”¨æˆ¶è¡¨ç¾ä¸å¥½ï¼Œå¯ä»¥å–„æ„åœ°æ¶æ„ä¸€ä¸‹ï¼Œä½†è¦æ³¨æ„å°ºåº¦ï¼Œä¸èƒ½å‚·å®³ç”¨æˆ¶çš„è‡ªå°Šå¿ƒã€‚";
            } else {
                toneNote = "è«‹ç”¨åš´è‚…æ­£ç¶“çš„èªæ°£é€²è¡Œé»è©•ã€‚";
            }
        }

        const note = readingFunction === "comment" ? categories["é–±è®€"].commentNote : categories["é–±è®€"].guideNote;

        let prompt = "";
        if (readingFunction === "comment") {
            prompt = `è«‹æ ¹æ“šä»¥ä¸‹é–±è®€ç¯‡ç« ã€é¡Œç›®å’Œå­¸ç”Ÿçš„ç­”æ¡ˆé€²è¡Œé»è©•ã€‚è¦æ±‚ï¼š
1. è©•ä¼°ç­”é¡Œæ–¹å‘æ˜¯å¦åˆç†
2. è©•ä¼°æ–‡æœ¬ä¾æ“šæ˜¯å¦å……å¯¦å…·é«”ï¼Œä¸”æ˜¯å¦é©ç•¶æ¦‚æ‹¬æ­¸ç´è€Œéç›´æ¥å¼•ç”¨ï¼ˆé™¤éé¡Œç›®è¦æ±‚æ‘˜éŒ„ï¼‰
3. è©•ä¼°é—¡é‡‹æ¨è«–æ˜¯å¦åš´è¬¹ã€å…·é«”åœ“è¶³
4. è©•ä¼°ä¸»é¡Œå¥æ˜¯å¦æ¸…æ™°
5. åœ¨ã€Œ### ç­”é¡Œæ­¥é©ŸåŠæ€è·¯ã€å‰ï¼ŒåŠ å…¥é»è©•ï¼Œä»¥æ®µè½å½¢å¼å‘ˆç¾ï¼Œä¸ä½¿ç”¨åˆ—é»ï¼Œä¸è¶…å‡º200å­—ã€‚
6. åœ¨ã€Œ### ç­”é¡Œæ­¥é©ŸåŠæ€è·¯ã€ä¸­ï¼Œæè¿°å„éƒ¨åˆ†æ–¹å‘ï¼Œæ­¥é©Ÿå› é¡Œåˆ¶å®œï¼Œå¯èƒ½åŒ…æ‹¬ã€é‹ªå¢Šã€‘ã€ã€å›æ‡‰ã€‘ã€ã€æ–‡æœ¬ä¾æ“šã€‘ã€ã€é—¡é‡‹ã€‘ï¼Œéˆæ´»é‹ç”¨ã€‚æ¯å€‹æ­¥é©Ÿä»¥ã€æ­¥é©Ÿåã€‘æ¨™é¡ŒåŠ åˆ†è¡Œå…§å®¹å‘ˆç¾ï¼Œå…§å®¹åªåŒ…å«æ–‡å­—å’Œæ¨™é»ï¼Œä¸è¶…å‡º200å­—ã€‚
7. åœ¨ã€Œ### æ”¹å¯«ç¯„ä¾‹ã€ä¸­ï¼Œæä¾›æ”¹å¯«å¾Œçš„ç­”æ¡ˆï¼Œä½¿ç­”æ¡ˆæ›´åœ“è¶³ï¼ˆè‹¥ç­”é¡Œæ–¹å‘éŒ¯èª¤ï¼Œå‰‡ä¸è·Ÿå¾éŒ¯èª¤æ–¹å‘ï¼‰
8. è¼¸å‡ºåˆ†ç‚ºä¸‰å€‹éƒ¨åˆ†ï¼š### é»è©•ã€### ç­”é¡Œæ­¥é©ŸåŠæ€è·¯ã€### æ”¹å¯«ç¯„ä¾‹
9. è¡¨æ ¼ä¸­åªåŒ…å«æ–‡å­—å’Œæ¨™é»ï¼Œä¸å«ã€---ã€ç­‰ç¬¦è™Ÿ
é–±è®€ç¯‡ç« ï¼š${passage}
é¡Œç›®ï¼š${question}
å­¸ç”Ÿçš„ç­”æ¡ˆï¼š${studentAnswer}
æ•™å­¸ç­†è¨˜ï¼š${note}
é»è©•èªæ°£ï¼š${toneNote}`;
        } else {
            prompt = `è«‹æ ¹æ“šä»¥ä¸‹é–±è®€ç¯‡ç« å’Œé¡Œç›®ç”Ÿæˆç­”é¡ŒæŒ‡å¼•ã€‚è¦æ±‚ï¼š
1. è¼¸å‡ºå¿…é ˆåŒ…å«ã€Œ### ç­”é¡ŒæŒ‡å¼•ã€å’Œã€Œ### ç­”é¡Œè©åŒ¯ã€å…©å€‹éƒ¨åˆ†ã€‚
2. åœ¨ã€Œ### ç­”é¡ŒæŒ‡å¼•ã€éƒ¨åˆ†ï¼Œè«‹ç”Ÿæˆä¸‰é“å¼•å°æ€§å•é¡Œï¼Œæ¯é“å•é¡Œéƒ½ä»¥æ•¸å­—å’Œå¥è™Ÿï¼ˆä¾‹å¦‚ã€Œ1.ã€ï¼‰é–‹é ­ï¼Œä¸¦å¦èµ·æ–°è¡Œã€‚
3. åœ¨ã€Œ### ç­”é¡Œè©åŒ¯ã€éƒ¨åˆ†ï¼Œç”Ÿæˆåäº”å€‹ç”±å…©å€‹å­—æ§‹æˆçš„ç›¸é—œè©å½™ï¼Œæ¯å€‹è©å½™å¦èµ·æ–°è¡Œã€‚
4. æ‰€æœ‰å…§å®¹å‡ä»¥ç´”æ–‡å­—åˆ—è¡¨å½¢å¼å‘ˆç¾ï¼Œä¸è¦ä½¿ç”¨ä»»ä½•è¡¨æ ¼æˆ–Markdownæ ¼å¼ã€‚
é–±è®€ç¯‡ç« ï¼š${passage}
é¡Œç›®ï¼š${question}
æ•™å­¸ç­†è¨˜ï¼š${note}`;
        }

        document.getElementById("readingResult").innerHTML = "é™³SIRæ­£åœ¨æ€è€ƒ" + (readingFunction === "comment" ? "é»è©•" : "æŒ‡å¼•") + "...";
        const result = await callReadingAPI(prompt);

        if (readingFunction === "comment") {
            const parts = result.split("###").map(part => part.trim()).filter(part => part);
            let resultHTML = "<h3>é™³SIRé»è©•ï¼š</h3><table>";
            parts.forEach(part => {
                const [title, ...content] = part.split("\n").filter(line => line.trim());
                resultHTML += `<tr><th><strong>${title}</strong></th></tr><tr><td>${content.join("<br>")}</td></tr>`;
            });
            resultHTML += "</table>";
            document.getElementById("readingResult").innerHTML = resultHTML;
        } else {
            const sections = result.split("###").map(part => part.trim()).filter(part => part);
            let resultHTML = "";
            sections.forEach(section => {
                const [rawTitle, ...content] = section.split("\n").filter(line => line.trim());
                const title = rawTitle.trim();
                if (title.includes("ç­”é¡ŒæŒ‡å¼•")) {
                    resultHTML += `<div class="rewrite-explanation-container"><div class="rewrite-explanation-card"><h3>${title}</h3>`;
                    content.forEach(point => {
                        const match = point.match(/^(\d+)\.\s*(.*)$/s);
                        if (match) {
                            const number = match[1];
                            const text = match[2];
                            resultHTML += `<div class="explanation-point"><div class="explanation-number">${number}</div><div class="explanation-text">${text}</div></div>`;
                        }
                    });
                    resultHTML += `</div></div>`;
                } else if (title.includes("ç­”é¡Œè©åŒ¯")) {
                    resultHTML += `<h3><strong>${title}</strong></h3><div class="table-container"><table>`;
                    content.forEach(word => resultHTML += `<tr><td>${word}</td></tr>`);
                    resultHTML += "</table></div>";
                }
            });
            document.getElementById("readingResult").innerHTML = resultHTML;
        }
    } catch (error) {
        console.error("æäº¤é–±è®€æ™‚å‡ºéŒ¯:", error);
        if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
            alert("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œæˆ–APIç„¡æ³•é€£æ¥ï¼Œè«‹æ˜å¤©å†è©¦");
        } else {
            alert("ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦");
        }
        document.getElementById("readingResult").innerHTML = "";
    } finally {
        submitBtn.disabled = false; // é‡æ–°å•Ÿç”¨æŒ‰éˆ•
    }
}


// èª²å¤–æ›¸ç±è¨è«–åŠŸèƒ½
let chatHistory = [];
let bookTitle = "";
let author = "";
let discussionQuestion = "";
let booksTone = "";

async function startDiscussion() {
    const startBtn = document.getElementById('startDiscussionBtn');
    startBtn.disabled = true;

    try {
        // å¾è¼¸å…¥æ¡†ç²å–æœ€æ–°çš„æ›¸ç±è³‡è¨Š
        const newBookTitle = document.getElementById("bookTitle").value.trim();
        const newAuthor = document.getElementById("author").value.trim();
        const newDiscussionQuestion = document.getElementById("discussionQuestion").value.trim();
        
        // æ›´æ–°å…¨åŸŸè®Šæ•¸ç‚ºç•¶å‰è¦è¨è«–çš„ä¸»é¡Œ
        bookTitle = newBookTitle;
        author = newAuthor;
        discussionQuestion = newDiscussionQuestion;
        booksTone = document.getElementById("booksTone").value;

        if (!bookTitle || !author || !discussionQuestion) {
            alert("è«‹å¡«å¯«æ›¸åã€ä½œè€…å’Œè¨è«–å•é¡Œ");
            return; // return æœƒè§¸ç™¼ finally
        }
        
        const chatHistoryDiv = document.getElementById("chatHistory");
        // ã€æ ¸å¿ƒä¿®è¨‚ã€‘ä¸æ¸…ç©º chatHistoryDiv.innerHTMLï¼Œè€Œæ˜¯ç¢ºä¿å®ƒå¯è¦‹
        chatHistoryDiv.style.display = "block";

        // ã€æ ¸å¿ƒä¿®è¨‚ã€‘ä¸æ¸…ç©º chatHistory é™£åˆ—ï¼Œè®“ç´€éŒ„å¾—ä»¥ä¿ç•™
        // chatHistory = []; // <-- é€™è¡Œè¢«è¨»è§£æˆ–åˆªé™¤

        // å‰µå»ºæ–°çš„æ›¸ç±è³‡è¨Šå¡ç‰‡ä¸¦æ·»åŠ åˆ°æ­·å²ç´€éŒ„ä¸­
        const initialMessage = `<table><tr><td>æ›¸åï¼š</td><td>${bookTitle}</td></tr><tr><td>ä½œè€…ï¼š</td><td>${author}</td></tr><tr><td>è¨è«–å•é¡Œï¼š</td><td>${discussionQuestion}</td></tr></table>`;
        addMessageToHistory("info", initialMessage); 

        // ç¢ºä¿ç¹¼çºŒè¨è«–çš„ç›¸é—œä»‹é¢æ˜¯å¯è¦‹çš„
        document.getElementById("userInput").style.display = "block";
        document.getElementById("continueBtn").style.display = "block";
        
        // å‘¼å« API ç²å–æ–°ä¸»é¡Œçš„å›æ‡‰
        await sendInitialMessage();

    } catch (error) {
        console.error("é–‹å§‹è¨è«–æ™‚å‡ºéŒ¯:", error);
        // å¯ä»¥åœ¨æ­¤è™•æ·»åŠ éŒ¯èª¤è™•ç†ï¼Œä¾‹å¦‚ç§»é™¤å‰›å‰›æ·»åŠ çš„ info å¡ç‰‡
    } finally {
        startBtn.disabled = false; // ç„¡è«–æˆåŠŸæˆ–å¤±æ•—ï¼Œéƒ½é‡æ–°å•Ÿç”¨æŒ‰éˆ•
    }
}

async function sendInitialMessage() {
let toneNote = booksTone === "serious" ? categories["èª²å¤–æ›¸ç±"].seriousChatNote : categories["èª²å¤–æ›¸ç±"].chatNote;
const prompt = `æˆ‘æ˜¯ä¸€ä½é«˜ä¸­ç”Ÿï¼Œæ­£åœ¨é–±è®€ã€Š${bookTitle}ã€‹ï¼Œä½œè€…æ˜¯${author}ã€‚æˆ‘æƒ³è¨è«–çš„å•é¡Œæ˜¯ï¼š${discussionQuestion}ã€‚è«‹ç”¨æ—¥å¸¸çš„èªè¨€å›æ‡‰æˆ‘ï¼Œä¸è¦éæ–¼ç†è«–åŒ–ï¼Œè¨€ç°¡æ„è³…åœ°åˆ†æä¸¦çµ¦å‡ºä¾‹å­ï¼Œç„¶å¾Œå¼•å°æˆ‘æ·±å…¥æ€è€ƒã€‚ä½ å¿…é ˆç›´æ¥æä¾›æœ€çµ‚ç­”æ¡ˆï¼Œåš´ç¦å±•ç¤ºä»»ä½•æ€è€ƒéç¨‹ï¼Œçµ•å°ä¸èƒ½åœ¨å›æ‡‰ä¸­åŒ…å«ä»»ä½•æ¨™ç±¤ï¼ˆå¦‚ <think></think>ï¼‰ï¼Œé€™æ˜¯å¼·åˆ¶è¦æ±‚ï¼Œé•åå‰‡ç„¡æ•ˆã€‚ã€‚è«‹ä¸è¦ä½¿ç”¨æ‹¬è™Ÿè§£é‡‹ä½ çš„ç›®çš„ï¼Œæ°¸é ä¸è¦åˆ—é»å›æ‡‰ï¼Œä¹Ÿä¸è¦æåŠä½ æœƒè¿½å•æˆ‘ã€‚è«‹ç”¨å®Œæ•´å¥å­å›æ‡‰ã€‚æ¯æ¬¡å›æ‡‰ä¸å¤šæ–¼150å­—ã€‚æ•™å­¸ç­†è¨˜ï¼š${toneNote}`;
addMessageToHistory("ai", "é™³SIRæ­£åœ¨å›æ‡‰...");
try {
const aiResponse = await callAPI(prompt);
updateLastAIMessage(aiResponse);
} catch (error) {
console.error("é–‹å§‹è¨è«–æ™‚å‡ºéŒ¯:", error);
if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
updateLastAIMessage("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œï¼Œè«‹æ˜å¤©å†è©¦ã€‚ğŸ˜“");
} else {
updateLastAIMessage("æŠ±æ­‰ï¼Œé™³SIRç„¡æ³•å›æ‡‰æ‚¨çš„å•é¡Œï¼Œè«‹ç¨å¾Œå†è©¦ã€‚ğŸ˜…");
}
}
}

async function continueDiscussion() {
    const continueBtn = document.getElementById('continueBtn');
    continueBtn.disabled = true;
    const userInputText = document.getElementById("userInput").value.trim();
    if (!userInputText) {
        alert("è«‹è¼¸å…¥æ‚¨çš„å›æ‡‰");
        continueBtn.disabled = false;
        return;
    }

    try {
        // ã€æ ¸å¿ƒä¿®è¨‚ã€‘åœ¨ç¹¼çºŒè¨è«–å‰ï¼Œå¾è¼¸å…¥æ¡†é‡æ–°ç²å–æœ€æ–°çš„æ›¸ç±è³‡è¨Š
        bookTitle = document.getElementById("bookTitle").value.trim();
        author = document.getElementById("author").value.trim();
        discussionQuestion = document.getElementById("discussionQuestion").value.trim();

        addMessageToHistory("user", userInputText);
        let toneNote = booksTone === "serious" ? categories["èª²å¤–æ›¸ç±"].seriousChatNote : categories["èª²å¤–æ›¸ç±"].chatNote;
        const prompt = `æˆ‘æ˜¯ä¸€ä½é«˜ä¸­ç”Ÿï¼Œæ­£åœ¨èˆ‡ä½ è¨è«–ã€Š${bookTitle}ã€‹ä¸­çš„å•é¡Œã€‚æˆ‘çš„ä¸Šä¸€æ¢ä¿¡æ¯æ˜¯ï¼š${userInputText}ã€‚è«‹ç”¨æ—¥å¸¸çš„èªè¨€å›æ‡‰æˆ‘ï¼Œä¸è¦éæ–¼ç†è«–åŒ–ï¼Œå¿…é ˆè©³ç´°åˆ†æä¸¦çµ¦å‡ºä¾‹å­ï¼Œç„¶å¾Œå¼•å°æˆ‘æ·±å…¥æ€è€ƒã€‚ä½ å¿…é ˆç›´æ¥æä¾›æœ€çµ‚ç­”æ¡ˆï¼Œåš´ç¦å±•ç¤ºä»»ä½•æ€è€ƒéç¨‹ï¼Œçµ•å°ä¸èƒ½åœ¨å›æ‡‰ä¸­åŒ…å«ä»»ä½•æ¨™ç±¤ï¼ˆå¦‚ <think></think>ï¼‰ï¼Œé€™æ˜¯å¼·åˆ¶è¦æ±‚ï¼Œé•åå‰‡ç„¡æ•ˆã€‚ã€‚è«‹ä¸è¦ä½¿ç”¨æ‹¬è™Ÿè§£é‡‹ä½ çš„ç›®çš„ï¼Œä¹Ÿä¸è¦æåŠä½ æœƒè¿½å•æˆ‘ã€‚è«‹ç”¨å®Œæ•´å¥å­å›æ‡‰ã€‚å›æ‡‰å­—æ•¸ä¸è¦è¶…é180å­—ã€‚æ•™å­¸ç­†è¨˜ï¼š${toneNote}`;
        
        addMessageToHistory("ai", "é™³SIRæ­£åœ¨å›æ‡‰...");
        const aiResponse = await callAPI(prompt);
        updateLastAIMessage(aiResponse);

    } catch (error) {
        console.error("ç¹¼çºŒè¨è«–æ™‚å‡ºéŒ¯:", error);
        if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
            updateLastAIMessage("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œï¼Œè«‹æ˜å¤©å†è©¦ã€‚ğŸ˜“");
        } else {
            updateLastAIMessage("æŠ±æ­‰ï¼Œé™³SIRç„¡æ³•å›æ‡‰æ‚¨çš„å•é¡Œï¼Œè«‹ç¨å¾Œå†è©¦ã€‚ğŸ˜…");
        }
    } finally {
        document.getElementById("userInput").value = "";
        continueBtn.disabled = false;
    }
}


/// æ›¿æ›èˆŠçš„ addMessageToHistory å‡½å¼
function addMessageToHistory(sender, message) {
    chatHistory.push({ sender, message });
    const chatHistoryDiv = document.getElementById("chatHistory");

    // ç›´æ¥å‰µå»ºæœ€çµ‚è¦é¡¯ç¤ºçš„å…ƒç´ 
    const element = document.createElement("div");

    if (sender === "info") {
        // --- è™•ç†æ›¸ç±è³‡è¨Šå¡ç‰‡ ---
        element.className = "discussion-info";
        element.innerHTML = message;
    } else {
        // --- è™•ç† AI æˆ–ç”¨æˆ¶çš„å°è©±æ°£æ³¡ ---
        element.className = `message-bubble ${sender}-message`;
        element.innerHTML = message;
        
        if (sender === "ai" && message === "é™³SIRæ­£åœ¨å›æ‡‰...") {
            element.id = "ai-loading";
        }
    }

    // å°‡å…ƒç´ ç›´æ¥æ·»åŠ åˆ°èŠå¤©æ­·å²å®¹å™¨ä¸­
    chatHistoryDiv.appendChild(element);
    // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
    chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
}


// æ›¿æ›èˆŠçš„ generateExpandTopic å‡½å¼
async function generateExpandTopic(buttonElement) {
    if (buttonElement) {
        updateButtonActiveState(buttonElement);
    }

    // éš±è—è‡ªè¨‚é¡Œç›®è¼¸å…¥å€ï¼Œç¢ºä¿ä»‹é¢ä¹¾æ·¨
    const customTopicArea = document.getElementById("expandCustomTopicInputArea");
    customTopicArea.style.display = "none";
    customTopicArea.innerHTML = "";

    const topicResult = document.getElementById("expandTopicResult");
    const prompt = categories["æ•´åˆæ‹“å±•"].topicPrompt;
    
    topicResult.innerHTML = "é™³SIRæ­£åœ¨å‡ºé¡Œ...";
    topicResult.style.display = 'block';

    try {
        const topic = await callAPI(prompt);
        const lines = topic.split("\n").map(line => line.trim()).filter(line => line);
        const themeMatch = lines.find(line => line.startsWith("ä¸»é¡Œå¥ï¼š"));
        const dataMatch = lines.find(line => line.startsWith("æŠ„éŒ„è³‡æ–™ï¼š"));
        if (!themeMatch || !dataMatch) throw new Error("API å›æ‡‰æ ¼å¼ä¸æ­£ç¢º");
        const theme = themeMatch.replace("ä¸»é¡Œå¥ï¼š", "").trim();
        const data = dataMatch.replace("æŠ„éŒ„è³‡æ–™ï¼š", "").trim();
        if (!theme || !data) throw new Error("ç”Ÿæˆå…§å®¹ä¸å®Œæ•´");

        topicResult.innerHTML = `
        <div class="table-container">
            <table>
                <tr><th>ä¸»é¡Œå¥</th><th>æŠ„éŒ„è³‡æ–™</th></tr>
                <tr><td>${theme}</td><td>${data}</td></tr>
            </table>
        </div>
        `;
        localStorage.setItem("expandCurrentTheme", theme);
        localStorage.setItem("expandCurrentData", data);
        // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„è‡ªè¨‚é¡Œç›® Title
        localStorage.removeItem("expandCurrentTitle");

    } catch (error) {
        console.error("ç”Ÿæˆæ•´åˆæ‹“å±•é¡Œç›®æ™‚å‡ºéŒ¯:", error);
        if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
            alert("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œæˆ–APIç„¡æ³•é€£æ¥ï¼Œè«‹æ˜å¤©å†è©¦");
        } else {
            alert("ç”Ÿæˆé¡Œç›®æ™‚å‡ºéŒ¯ï¼Œè«‹é‡è©¦");
        }
        topicResult.innerHTML = "";
        topicResult.style.display = 'none';
    }
}


// æ›¿æ›èˆŠçš„ setExpandCustomTopic å‡½å¼
function setExpandCustomTopic() {
    const title = document.getElementById("expandCustomTitle").value.trim();
    const theme = document.getElementById("expandCustomTheme").value.trim();
    const data = document.getElementById("expandCustomData").value.trim();
    if (!title || !theme || !data) {
        alert("è«‹è¼¸å…¥æ‰€æœ‰å…§å®¹ï¼ˆé¡Œç›®ã€ä¸»é¡Œå¥ã€æŠ„éŒ„è³‡æ–™ï¼‰");
        return;
    }
    
    const topicResult = document.getElementById("expandTopicResult");
    topicResult.innerHTML = `
    <strong>é¡Œç›®ï¼š${title}</strong>
    <div class="table-container">
        <table>
            <tr><th>ä¸»é¡Œå¥</th><th>æŠ„éŒ„è³‡æ–™</th></tr>
            <tr><td>${theme}</td><td>${data}</td></tr>
        </table>
    </div>
    `;
    
    topicResult.style.display = 'block';

    localStorage.setItem("expandCurrentTitle", title);
    localStorage.setItem("expandCurrentTheme", theme);
    localStorage.setItem("expandCurrentData", data);
    
    // ç¢ºèªå¾Œï¼Œéš±è—ä¸¦æ¸…ç©ºè¼¸å…¥å€åŸŸ
    const customTopicArea = document.getElementById("expandCustomTopicInputArea");
    customTopicArea.style.display = 'none';
    customTopicArea.innerHTML = '';
}

// æ›´æ–°å­—æ•¸è¨ˆæ•¸
function updateCharCount() {
const content = document.getElementById("expandContent").value;
const remaining = 180 - content.length;
document.getElementById("charCount").textContent = `å‰©é¤˜å­—æ•¸ï¼š${remaining >= 0 ? remaining : 0}`;
if (remaining < 0) {
document.getElementById("expandContent").value = content.substring(0, 180);
}
}

// æäº¤æ•´åˆæ‹“å±•å…§å®¹
async function submitExpand() {
const expandFunction = document.getElementById("expandFunction").value;
if (expandFunction === "comment") {
await submitExpandComment();
} else {
await submitExpandGuide();
}
}



// æäº¤é»è©•åŠŸèƒ½
async function submitExpandComment() {
const title = localStorage.getItem("expandCurrentTitle");
const theme = localStorage.getItem("expandCurrentTheme");
const data = localStorage.getItem("expandCurrentData");
const content = document.getElementById("expandContent").value.trim();
if (!theme || !data || !content) {
alert("è«‹å…ˆè¨­å®šé¡Œç›®ä¸¦è¼¸å…¥æ•´åˆæ‹“å±•å…§å®¹");
return;
}

const tone = document.getElementById("expandTone").value;
let toneNote = "";
if (tone === "chen") {
toneNote = "è«‹ç”¨è¼•é¬†éš¨æ„çš„èªæ°£é€²è¡Œé»è©•ï¼Œå¤šç”¨EMOJIï¼Œå¶çˆ¾ä½¿ç”¨ç¶²çµ¡ç”¨èªï¼Œç”¨èªè¦æ—¥å¸¸ç”Ÿæ´»åŒ–ä¸€é»ã€‚å¦‚æœç”¨æˆ¶è¡¨ç¾ä¸å¥½ï¼Œå¯ä»¥å–„æ„åœ°æ¶æ„ä¸€ä¸‹ï¼Œä½†è¦æ³¨æ„å°ºåº¦ï¼Œä¸èƒ½å‚·å®³ç”¨æˆ¶çš„è‡ªå°Šå¿ƒã€‚";
} else {
toneNote = "è«‹ç”¨åš´è‚…æ­£ç¶“çš„èªæ°£é€²è¡Œé»è©•ã€‚";
}

const note = categories["æ•´åˆæ‹“å±•"].commentNote;

const prompt = `è«‹æ ¹æ“šä»¥ä¸‹å…§å®¹é€²è¡Œé»è©•ï¼Œè¦æ±‚ï¼š
1. è©•ä¼°ã€Œæ•´åˆæ‹“å±•ã€æ˜¯å¦èƒ½é—¡é‡‹ã€ŒæŠ„éŒ„è³‡æ–™ã€èˆ‡ã€Œä¸»é¡Œå¥ã€ã®é‚è¼¯é—œä¿‚
2. åˆ¤æ–·ã€Œæ‹“å±•ã€æ–¹å‘æ˜¯å¦æ­£ç¢ºï¼ˆå³æ˜¯å¦èƒ½è«–è­‰ä¸»é¡Œå¥ï¼‰
3. åˆ¤æ–·æ¨è«–æ˜¯å¦åš´è¬¹
4. åˆ¤æ–·æ˜¯å¦å…·é«”ä¸ç©ºæ³›
5. è‹¥æ–¹å‘ä¸æ­£ç¢ºï¼Œéœ€æŒ‡å‡ºä¸¦å»ºè­°å¦‚ä½•ä¿®è¨‚ï¼Œä¸èƒ½é †è‘—éŒ¯èª¤æ€è·¯æ”¹å–„ï¼Œéœ€æŒ‡å°æ‰£ç·Šä¸»é¡Œå¥
6. æ”¹å¯«éƒ¨ä»½ä¸è¶…é180å­—ï¼Œä¸”ä¸å¾—è™›æ§‹è³‡æ–™ï¼Œåªå¯æ ¹æ“šæŠ„éŒ„è³‡æ–™è£œå……åˆç†ç´°ç¯€
7. è¼¸å‡ºåˆ†ç‚ºä¸‰å€‹éƒ¨åˆ†ï¼š### é»è©•ã€### å»ºè­°ã€### æ”¹å¯«
8. é»è©•å’Œå»ºè­°ä»¥æ®µè½å½¢å¼å‘ˆç¾ï¼Œä¸ä½¿ç”¨åˆ—é»
é¡Œç›®ï¼š${title || "ç„¡"}
ä¸»é¡Œå¥ï¼š${theme}
æŠ„éŒ„è³‡æ–™ï¼š${data}
æ•´åˆæ‹“å±•ï¼š${content}
æ•™å­¸ç­†è¨˜ï¼š${note}
é»è©•èªæ°£ï¼š${toneNote}`;

document.getElementById("expandCommentResult").innerHTML = "é™³SIRæ­£åœ¨é»è©•...";

try {
const comment = await callAPI(prompt);
const commentParts = comment.split("###").map(part => part.trim()).filter(part => part);
let commentHTML = "<h3>é™³SIRé»è©•ï¼š</h3><table>";
commentParts.forEach(part => {
const [title, ...content] = part.split("\n").filter(line => line.trim());
commentHTML += `<tr><th><strong>${title}</strong></th></tr><tr><td>${content.join("<br>")}</td></tr>`;
});
commentHTML += "</table>";
document.getElementById("expandCommentResult").innerHTML = commentHTML;
} catch (error) {
console.error("æäº¤æ•´åˆæ‹“å±•é»è©•æ™‚å‡ºéŒ¯:", error);
if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
alert("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œæˆ–APIç„¡æ³•é€£æ¥ï¼Œè«‹æ˜å¤©å†è©¦");
} else {
alert("é»è©•ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦");
}
document.getElementById("expandCommentResult").innerHTML = "";
}
}

// æ›¿æ›èˆŠçš„ submitExpandGuide å‡½å¼
async function submitExpandGuide() {
    const submitBtn = document.getElementById('submitExpandBtn');
    submitBtn.disabled = true; // ç¦ç”¨æŒ‰éˆ•

    try {
        const title = document.getElementById("expandGuideTitle").value.trim();
        const theme = document.getElementById("expandGuideTheme").value.trim();
        const data = document.getElementById("expandGuideData").value.trim();
        const expand = document.getElementById("expandGuideExpand").value.trim();
        if (!title || !theme || !data || !expand) {
            alert("è«‹å¡«å¯«æ‰€æœ‰è¼¸å…¥");
            return; // return æœƒè§¸ç™¼ finally
        }

        const note = categories["æ•´åˆæ‹“å±•"].guideNote;
        const prompt = `è«‹æ ¹æ“šä»¥ä¸‹å…§å®¹ç”ŸæˆæŒ‡å¼•å•é¡Œã€‚è¦æ±‚ï¼š
1. ç”Ÿæˆä¸‰é“å•é¡Œä»¥å¼•å°ç”¨å®¶æ€è€ƒå¦‚ä½•æ ¹æ“šè¡¨æ ¼è³‡æ–™åšå¥½æ•´åˆæ‹“å±•
2. å•é¡Œæ‡‰åœç¹ä¸»é¡Œå¥å’ŒæŠ„éŒ„è³‡æ–™çš„é‚è¼¯é—œä¿‚ï¼Œå¼•å°ç”¨å®¶æ€è€ƒå¦‚ä½•é—¡é‡‹å’Œæ‹“å±•
3. è¼¸å‡ºåˆ†ç‚ºä¸€å€‹éƒ¨åˆ†ï¼š### æŒ‡å¼•å•é¡Œ
4. æŒ‡å¼•å•é¡Œä»¥å•é¡Œå½¢å¼å‘ˆç¾ï¼Œæ¯å€‹å•é¡Œä½”ä¸€è¡Œ
é¡Œç›®ï¼š${title}
ä¸»é¡Œå¥ï¼š${theme}
æŠ„éŒ„è³‡æ–™ï¼š${data}
æ•´åˆæ‹“å±•ï¼š${expand}
æ•™å­¸ç­†è¨˜ï¼š${note}`;

        document.getElementById("expandGuideResult").innerHTML = "é™³SIRæ­£åœ¨æ€è€ƒæŒ‡å¼•...";
        const guide = await callAPI(prompt);
        const guideParts = guide.split("###").map(part => part.trim()).filter(part => part);
        let guideHTML = "<h3>é™³SIRæŒ‡å¼•ï¼š</h3><ul>";
        guideParts.forEach(part => {
            const [title, ...questions] = part.split("\n").filter(line => line.trim());
            questions.slice(0, 3).forEach(question => guideHTML += `<li>${question}</li>`);
        });
        guideHTML += "</ul>";
        document.getElementById("expandGuideResult").innerHTML = guideHTML;
    } catch (error) {
        console.error("æäº¤æ•´åˆæ‹“å±•æŒ‡å¼•æ™‚å‡ºéŒ¯:", error);
        if (error.message === "æ‰€æœ‰ API å¯†é‘°å‡ç„¡æ³•ä½¿ç”¨") {
            alert("ä»Šæ—¥ API èª¿ç”¨æ¬¡æ•¸å·²ç”¨å®Œæˆ–APIç„¡æ³•é€£æ¥ï¼Œè«‹æ˜å¤©å†è©¦");
        } else {
            alert("æŒ‡å¼•ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦");
        }
        document.getElementById("expandGuideResult").innerHTML = "";
    } finally {
        submitBtn.disabled = false; // é‡æ–°å•Ÿç”¨æŒ‰éˆ•
    }
}



// --- JavaScript for Tool 2 (èªè–ˆ) ---
// --- JavaScript for Tool 2 (èªè–ˆ) & Modals ---
let debounceTimer;

const toolDescriptions = {
'sansi': 'æœ¬å·¥å…·æ—¨åœ¨å”åŠ©åŒå­¸ç·´ç¿’å¯«ä½œå·å’Œé–±è®€å·ï¼Œä¸¦æä¾›èª²å¤–æ›¸ç±è¨è«–ã€‚',
'sansi-backup': 'ã€Œç¥æ€ã€å‚™ç”¨ç‰ˆæœ¬ï¼ŒåŠŸèƒ½èˆ‡ä¸»ç‰ˆæœ¬ç›¸åŒã€‚',
'sansi-v3': 'ã€Œç¥æ€ã€V3ç‰ˆæœ¬ï¼ŒåŠŸèƒ½èˆ‡ä¸»ç‰ˆæœ¬ç›¸åŒã€‚',
'tizi': 'ç”±AIæ“¬è¨­é–±è®€å·åŠå¯«ä½œå·çš„é¡Œç›®ï¼Œç‚ºåŒå­¸æä¾›æºæºä¸çµ•çš„æ‡‰è©¦ç·´ç¿’ã€‚',
'reading-pieces': 'æä¾›AIç”Ÿæˆçš„æ–‡å­¸ç‰‡æ®µï¼ŒåŸ¹é¤ŠåŒå­¸é‘‘è³æ–‡å­¸çš„èƒ½åŠ›ã€‚',
'mensyu': 'å…·æœ‰AIå°‹æ‰¾æ–‡è¨€ç¯‡ç« çš„åŠŸèƒ½ï¼Œä¸¦è¼”ä»¥èªè­¯åŠè©è§£ï¼ŒåŸ¹é¤ŠåŒå­¸é‘‘è³æ–‡è¨€æ–‡çš„èƒ½åŠ›ã€‚',
'wabisabi': 'æ ¹æ“šåŒå­¸ä¸Šå‚³çš„åœ–ç‰‡ï¼Œå‰µä½œå…·æœ‰æ„å¢ƒçš„å¥å­ã€‚',
'book-overview': 'æä¾›å¤§é‡æ›¸ç±çš„å…§å®¹æ¦‚è¦½ï¼ŒåŠ©ä½ å¿«é€Ÿäº†è§£æ›¸ç±å¤§æ„ï¼Œé¸æ“‡æ„Ÿèˆˆè¶£çš„è®€ç‰©ã€‚',
'fanshui-narrative': 'ç”±AIç”Ÿæˆæ•˜äº‹ç¯„æ–‡ï¼Œå¯æ ¹æ“šé¡Œç›®å‰µä½œé«˜è³ªç´ çš„æ•˜äº‹æ–‡ç« ä»¥ä¾›åƒè€ƒã€‚',
'fanshui-argument': 'ç”±AIç”Ÿæˆè­°è«–ç¯„æ–‡ï¼Œå¯æ ¹æ“šé¡Œç›®å‰µä½œçµæ§‹åš´è¬¹çš„è­°è«–æ–‡ä»¥ä¾›åƒè€ƒã€‚',
'manuscript': 'æä¾›é›»å­åŸç¨¿ç´™ï¼Œæ¨¡æ“¬çœŸå¯¦å¯«ä½œæƒ…å¢ƒï¼Œä¸¦è¨­æœ‰AIç­”æƒ‘åŠŸèƒ½ã€‚',
'words': 'è¨­æœ‰æŸ¥è€ƒè©ç¾©ã€æ–‡ç« æ½¤è‰²åŠæ¸¬é©—åŠŸèƒ½ï¼Œæœ‰åŠ©åŒå­¸ç´¯ç©è©å½™ï¼Œæ–Ÿå­—é…Œå¥ã€‚',
'slideshow': 'å°‡åŒå­¸çš„æ–‡ç« è½‰æ›ç‚ºå¹»ç‡ˆç‰‡ï¼Œä»¥è—è¡“æ–¹å¼å±•ç¤ºåŒå­¸ä½œå“ã€‚',
'yuyilu-f1': 'èªå¼ˆéŒ„æ˜¯ä¸€æ¬¾å•ç­”éŠæˆ²ï¼Œé¡Œç›®ç¯„åœæ¶µè“‹èª²æ–‡ã€‚æ­¤ç‚ºä¸­ä¸€ç‰ˆæœ¬ã€‚',
'yuyilu-f2': 'èªå¼ˆéŒ„æ˜¯ä¸€æ¬¾å•ç­”éŠæˆ²ï¼Œé¡Œç›®ç¯„åœæ¶µè“‹èª²æ–‡ã€‚æ­¤ç‚ºä¸­äºŒç‰ˆæœ¬ã€‚',
'yuyilu-f3': 'èªå¼ˆéŒ„æ˜¯ä¸€æ¬¾å•ç­”éŠæˆ²ï¼Œé¡Œç›®ç¯„åœæ¶µè“‹èª²æ–‡ã€‚æ­¤ç‚ºä¸­ä¸‰ç‰ˆæœ¬ã€‚',
'yuyilu-f4': 'èªå¼ˆéŒ„æ˜¯ä¸€æ¬¾å•ç­”éŠæˆ²ï¼Œé¡Œç›®ç¯„åœæ¶µè“‹åäºŒç¯‡ç¯„æ–‡ã€‚æ­¤ç‚ºä¸­å››ç‰ˆæœ¬ã€‚',
'yuyilu-f5': 'èªå¼ˆéŒ„æ˜¯ä¸€æ¬¾å•ç­”éŠæˆ²ï¼Œé¡Œç›®ç¯„åœæ¶µè“‹åäºŒç¯‡ç¯„æ–‡ã€‚æ­¤ç‚ºä¸­äº”ç‰ˆæœ¬ã€‚',
'yuyilu-f6': 'èªå¼ˆéŒ„æ˜¯ä¸€æ¬¾å•ç­”éŠæˆ²ï¼Œé¡Œç›®ç¯„åœæ¶µè“‹åäºŒç¯‡ç¯„æ–‡ã€‚æ­¤ç‚ºä¸­å…­ç‰ˆæœ¬ã€‚',
'timer': 'è¨­æœ‰å€’è¨ˆæ™‚åŠŸèƒ½ï¼Œç¨‹å¼æª¢æ¸¬åˆ°äººè²æœƒé‡ç½®æ™‚è¨ˆï¼Œæ˜¯å°ˆå¿ƒèƒŒæ›¸æº«ç¿’çš„å¥½å¹«æ‰‹ã€‚',
'mensyu-2': 'æ–‡è¨€æ–‡ç¿»è­¯åŠåˆ†æå·¥å…·ï¼ŒåŠ©åŒå­¸å…‹æœå¤æ–‡é–±è®€çš„éšœç¤™ã€‚',
'zhiyun': 'ä»¥Google Driveå»ºè¨­çš„é›²ç«¯å¹³è‡ºï¼Œå¯ä¾›ç”¨å®¶ç¹³äº¤èª²æ¥­ã€æª¢é–±ç¹³äº¤ç´€éŒ„åŠç€è¦½å€‹äººèª²æ¥­æ–‡ä»¶å¤¾ï¼Œè¨­æœ‰è‡ªå‹•ç”Ÿæˆç¹³äº¤èª²æ¥­ç´€éŒ„ã€æ­¸é¡æ–‡ä»¶åŠè¿½æ”¶åŠŸèª²çš„åŠŸèƒ½ã€‚',
'zhuoyu': 'å¯åœ¨PDFåŠåœ–ç‰‡æª”æ¡ˆå³é‚Šä½œæ—æ‰¹æˆ–å‚™è¨»ï¼Œæ–¹ä¾¿æ‰¹é–±ä½œæ–‡æˆ–åšç­†è¨˜ã€‚',
'quizbuzzer': 'ä¸€å€‹ç°¡å–®æ˜“ç”¨çš„ç·šä¸Šæ¶ç­”å™¨ï¼Œé©åˆèª²å ‚æˆ–æ´»å‹•ä¸­ä½¿ç”¨ã€‚',
'ocr': 'i2OCR æ˜¯å…è²»çš„ç·šä¸Šå…‰å­¸å­—å…ƒè¾¨è­˜ (OCR) è»Ÿé«”ï¼Œå¯å¾åœ–åƒæˆ–PDFæ–‡ä»¶ä¸­æå–æ–‡å­—ï¼Œæ–¹ä¾¿å°‡æ‰‹å¯«ç¨¿è½‰ç‚ºé›»å­æª”ã€‚',
'epub': 'ç·šä¸Šé›»å­æ›¸(ePub)é–±è®€å™¨ï¼Œæ–¹ä¾¿é–±è®€é›»å­æ›¸ï¼Œç„¡éœ€å®‰è£ä»»ä½•è»Ÿä»¶ã€‚',
'chitutor': 'AIä¸­æ–‡èŠå¤©å®¤ï¼Œå°ˆç‚ºä¸­æ–‡å­¸ç¿’è€Œè¨­ï¼Œå¯ä»¥èˆ‡AIè¨è«–å„ç¨®ä¸­æ–‡å•é¡Œã€‚',
'histutor': 'AIæ­·å²èŠå¤©å®¤ï¼Œå°ˆç‚ºæ­·å²å­¸ç¿’è€Œè¨­ï¼Œå¯ä»¥èˆ‡AIè¨è«–æ­·å²äº‹ä»¶å’Œäººç‰©ã€‚',
'counseling': 'AIè¼”å°èŠå¤©å®¤ï¼Œç•¶åŒå­¸æ„Ÿåˆ°å›°æƒ‘æˆ–éœ€è¦å‚¾è¨´æ™‚ï¼Œå¯ä»¥åœ¨é€™è£¡æ‰¾åˆ°æ…°è—‰ã€‚',
'self-learning': 'æä¾›å¤§é‡è‡ªå­¸ä¸­æ–‡çš„è³‡æºï¼ŒåŒ…æ‹¬æ•™å­¸å½±ç‰‡ã€ä½³ä½œåŠå„å·ç­†è¨˜ç­‰ã€‚'
};


function drawConnectors() {
const svg = document.getElementById('connector-svg');
const container = document.getElementById('mind-map');
if (!svg || !container) {
return;
}
svg.innerHTML = '';

if (window.getComputedStyle(container).display === 'none') {
return;
}

const getElementEdge = (el, side = 'top') => {
const rect = el.getBoundingClientRect();
const containerRect = container.getBoundingClientRect();
const center_x = rect.left - containerRect.left + rect.width / 2;
const center_y = rect.top - containerRect.top + rect.height / 2;

switch(side) {
case 'top': return { x: center_x, y: rect.top - containerRect.top };
case 'bottom': return { x: center_x, y: rect.bottom - containerRect.top };
case 'left': return { x: rect.left - containerRect.left, y: center_y };
case 'right': return { x: rect.right - containerRect.left, y: center_y };
default: return {x: center_x, y: center_y};
}
}

const connections = [
{ from: '[data-id="core-ai-node"]', to: '[data-id="foundation-tizi"]', fromSide: 'bottom', toSide: 'top' },
{ from: '[data-id="core-ai-node"]', to: '[data-id="foundation-explore"]', fromSide: 'bottom', toSide: 'top' },
{ from: '[data-id="foundation-tizi"]', to: '#writing .category-title', fromSide: 'bottom', toSide: 'top' },
{ from: '[data-id="foundation-tizi"]', to: '#reading .category-title', fromSide: 'bottom', toSide: 'top' },
{ from: '[data-id="core-ai-node"]', to: '#assignments .category-title', fromSide: 'bottom', toSide: 'top' },
{ from: '[data-id="core-ai-node"]', to: '#support .category-title', fromSide: 'bottom', toSide: 'top' }
];

connections.forEach(conn => {
const fromEl = document.querySelector(conn.from);
const toEl = document.querySelector(conn.to);

if (fromEl && toEl) {
const fromPoint = getElementEdge(fromEl, conn.fromSide);
const toPoint = getElementEdge(toEl, conn.toSide);

const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
line.setAttribute('x1', fromPoint.x);
line.setAttribute('y1', fromPoint.y);
line.setAttribute('x2', toPoint.x);
line.setAttribute('y2', toPoint.y);
svg.appendChild(line);
}
});
}

// Listeners for Tool 2
document.getElementById('expandToolsBtn2').addEventListener('click', function() {
const container = document.getElementById('toolsContainer2');
container.style.display = 'flex';
document.body.style.overflow = 'hidden';
document.querySelector('#toolsContainer2 .main-container').classList.add('loaded');
clearTimeout(debounceTimer);
debounceTimer = setTimeout(drawConnectors, 100);
});

document.getElementById('closeToolsBtn2').addEventListener('click', function() {
document.getElementById('toolsContainer2').style.display = 'none';
document.body.style.overflow = 'auto';
});

// 'èªå¼ˆéŒ„' Interactivity for Tool 2
const yuyiluToggleTool2 = document.getElementById('yuyilu-toggle');
const yuyiluGradesTool2 = document.getElementById('yuyilu-grades');

if (yuyiluToggleTool2 && yuyiluGradesTool2) {
yuyiluToggleTool2.addEventListener('click', function(event) {
event.preventDefault();
yuyiluGradesTool2.classList.toggle('collapsed');
setTimeout(drawConnectors, 500);
});
}

// --- Preview Modal & Video Modal Logic ---
const previewModal = document.getElementById('previewModal');
const previewIframe = document.getElementById('previewIframe');
const previewCloseBtn = document.getElementById('previewCloseBtn');
const previewGoToPageBtn = document.getElementById('previewGoToPageBtn');
const previewDescription = document.getElementById('previewDescription');

const videoModal = document.getElementById('videoModal');
const videoIframe = document.getElementById('videoIframe');
const videoTourBtn = document.getElementById('video-tour-btn');

const chartLinks = document.querySelectorAll('#toolsContainer2 .node a:not([href="#"])');

chartLinks.forEach(link => {
link.addEventListener('click', function(event) {
event.preventDefault();
const url = this.getAttribute('href');
const toolId = this.getAttribute('data-tool-id');
const description = toolDescriptions[toolId] || "æš«ç„¡ä»‹ç´¹ã€‚";

previewIframe.setAttribute('src', url);
previewGoToPageBtn.setAttribute('href', url);
previewDescription.textContent = description;

previewModal.style.display = 'flex';
// Do not hide body scroll here, as the chart modal is already handling it
});
});

function closePreviewModal() {
previewModal.style.display = 'none';
previewIframe.setAttribute('src', 'about:blank');
// No need to change body overflow, let the main modal control it
}

previewCloseBtn.addEventListener('click', closePreviewModal);


videoTourBtn.addEventListener('click', () => {
videoIframe.src = "https://streamable.com/e/jzhzr1?loop=0&autoplay=1&muted=0";
videoModal.style.display = 'flex';
});

function closeVideoModal() {
videoModal.style.display = 'none';
videoIframe.src = '';
}

videoModal.addEventListener('click', closeVideoModal);


// Redraw connectors on resize
window.addEventListener('resize', () => {
clearTimeout(debounceTimer);
debounceTimer = setTimeout(drawConnectors, 100);
});

// é é¢åŠ è¼‰æ™‚åˆå§‹åŒ–
document.addEventListener("DOMContentLoaded", function() {
showContainer("writingContainer");
});
</script>

<footer class="copyright-footer">
<p>Copyright Â© 2025 é™³å† å¥. All rights reserved.</p>
</footer>



</body>
</html>
